<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>ET: Legacy: src/server/sv_demo.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ET: Legacy
   </div>
   <div id="projectbrief">Open-source team based FPS game compatible with Wolfenstein: Enemy Territoryâ„¢</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_075bb3ff235063c77951cd176d15a741.html">server</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">sv_demo.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="sv__demo_8c.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> * Wolfenstein: Enemy Territory GPL Source Code</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> * Copyright (C) 1999-2010 id Software LLC, a ZeniMax Media company.</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> * Copyright (C) 2012 Stephen Larroque &lt;lrq3000@gmail.com&gt;</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> * ET: Legacy</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> * Copyright (C) 2012-2018 ET:Legacy team &lt;mail@etlegacy.com&gt;</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> * This file is part of ET: Legacy - http://www.etlegacy.com</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> * ET: Legacy is free software: you can redistribute it and/or modify</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> * it under the terms of the GNU General Public License as published by</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> * the Free Software Foundation, either version 3 of the License, or</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> * (at your option) any later version.</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> * ET: Legacy is distributed in the hope that it will be useful,</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment"> * GNU General Public License for more details.</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment"> * You should have received a copy of the GNU General Public License</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment"> * along with ET: Legacy. If not, see &lt;http://www.gnu.org/licenses/&gt;.</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment"> * In addition, Wolfenstein: Enemy Territory GPL Source Code is also</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment"> * subject to certain additional terms. You should have received a copy</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment"> * of these additional terms immediately following the terms and conditions</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment"> * of the GNU General Public License which accompanied the source code.</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment"> * If not, please request a copy in writing from id Software at the address below.</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment"> * id Software LLC, c/o ZeniMax Media Inc., Suite 120, Rockville, Maryland 20850 USA.</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="server_8h.html">server.h</a>&quot;</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="comment">// static function decl</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="sv__demo_8c.html#aef7d3c63cf10e49a020339383214ce81">SV_DemoWriteClientConfigString</a>(<span class="keywordtype">int</span> clientNum, <span class="keyword">const</span> <span class="keywordtype">char</span> *cs_string);</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;</div><div class="line"><a name="l00041"></a><span class="lineno"><a class="line" href="sv__demo_8c.html#aa6c595b76b700169003ada70b27a546b">   41</a></span>&#160;<span class="preprocessor">#define Q_IsColorStringGameCommand(p)      ((p) &amp;&amp; *(p) == Q_COLOR_ESCAPE &amp;&amp; *((p) + 1)) // ^[anychar]</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="comment">//#define CEIL(VARIABLE) ((VARIABLE - (int)VARIABLE) == 0 ? (int)VARIABLE : (int)VARIABLE + 1) // UNUSED but can be useful</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="comment">/***********************************************</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="comment"> * VARIABLES</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="comment"> ***********************************************/</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment">// Headers/markers for demo messages (events)</span></div><div class="line"><a name="l00049"></a><span class="lineno"><a class="line" href="sv__demo_8c.html#af2bc2d94afb470315c0786124a2fdc31">   49</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">enum</span></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;{</div><div class="line"><a name="l00051"></a><span class="lineno"><a class="line" href="sv__demo_8c.html#af2bc2d94afb470315c0786124a2fdc31a21695c29e33235a31893db6f62f314d1">   51</a></span>&#160;    <a class="code" href="sv__demo_8c.html#af2bc2d94afb470315c0786124a2fdc31a21695c29e33235a31893db6f62f314d1">demo_endDemo</a>, <span class="comment">// end of demo (close the demo)</span></div><div class="line"><a name="l00052"></a><span class="lineno"><a class="line" href="sv__demo_8c.html#af2bc2d94afb470315c0786124a2fdc31af5d3dcaed9fee578e7a23fdaf39b3485">   52</a></span>&#160;    <a class="code" href="sv__demo_8c.html#af2bc2d94afb470315c0786124a2fdc31af5d3dcaed9fee578e7a23fdaf39b3485">demo_EOF</a>, <span class="comment">// end of file/flux (end of event, separator, notify the demo parser to iterate to the next event of the _same_ frame)</span></div><div class="line"><a name="l00053"></a><span class="lineno"><a class="line" href="sv__demo_8c.html#af2bc2d94afb470315c0786124a2fdc31a33f59650efb74b3a4305f11883698a02">   53</a></span>&#160;    <a class="code" href="sv__demo_8c.html#af2bc2d94afb470315c0786124a2fdc31a33f59650efb74b3a4305f11883698a02">demo_endFrame</a>, <span class="comment">// player and gentity state marker (recorded each end of frame, hence the name) - at the same time marks the end of the demo frame</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;</div><div class="line"><a name="l00055"></a><span class="lineno"><a class="line" href="sv__demo_8c.html#af2bc2d94afb470315c0786124a2fdc31a28877e13ad25c44d02526672a825b457">   55</a></span>&#160;    <a class="code" href="sv__demo_8c.html#af2bc2d94afb470315c0786124a2fdc31a28877e13ad25c44d02526672a825b457">demo_configString</a>, <span class="comment">// config string setting event</span></div><div class="line"><a name="l00056"></a><span class="lineno"><a class="line" href="sv__demo_8c.html#af2bc2d94afb470315c0786124a2fdc31ade02da1ed2771e05fc653410dabc7ee9">   56</a></span>&#160;    <a class="code" href="sv__demo_8c.html#af2bc2d94afb470315c0786124a2fdc31ade02da1ed2771e05fc653410dabc7ee9">demo_clientConfigString</a>, <span class="comment">// client config string setting event</span></div><div class="line"><a name="l00057"></a><span class="lineno"><a class="line" href="sv__demo_8c.html#af2bc2d94afb470315c0786124a2fdc31a4ae848aa842475d53d1bf51d11f5324c">   57</a></span>&#160;    <a class="code" href="sv__demo_8c.html#af2bc2d94afb470315c0786124a2fdc31a4ae848aa842475d53d1bf51d11f5324c">demo_clientCommand</a>, <span class="comment">// client command event</span></div><div class="line"><a name="l00058"></a><span class="lineno"><a class="line" href="sv__demo_8c.html#af2bc2d94afb470315c0786124a2fdc31a7a1cab03a80a4741e82f124d9e6fd8cc">   58</a></span>&#160;    <a class="code" href="sv__demo_8c.html#af2bc2d94afb470315c0786124a2fdc31a7a1cab03a80a4741e82f124d9e6fd8cc">demo_serverCommand</a>, <span class="comment">// server command event</span></div><div class="line"><a name="l00059"></a><span class="lineno"><a class="line" href="sv__demo_8c.html#af2bc2d94afb470315c0786124a2fdc31a8829120824b95d7ac3fd0b727d6d7550">   59</a></span>&#160;    <a class="code" href="sv__demo_8c.html#af2bc2d94afb470315c0786124a2fdc31a8829120824b95d7ac3fd0b727d6d7550">demo_gameCommand</a>, <span class="comment">// game command event</span></div><div class="line"><a name="l00060"></a><span class="lineno"><a class="line" href="sv__demo_8c.html#af2bc2d94afb470315c0786124a2fdc31a899deb9b820e7fddef38a0f8b9b02b84">   60</a></span>&#160;    <a class="code" href="sv__demo_8c.html#af2bc2d94afb470315c0786124a2fdc31a899deb9b820e7fddef38a0f8b9b02b84">demo_clientUserinfo</a>, <span class="comment">// client userinfo event (client_t management)</span></div><div class="line"><a name="l00061"></a><span class="lineno"><a class="line" href="sv__demo_8c.html#af2bc2d94afb470315c0786124a2fdc31aa376fd14cf5aa4417a120dae8db81167">   61</a></span>&#160;    <a class="code" href="sv__demo_8c.html#af2bc2d94afb470315c0786124a2fdc31aa376fd14cf5aa4417a120dae8db81167">demo_entityState</a>, <span class="comment">// gentity_t-&gt;entityState_t management</span></div><div class="line"><a name="l00062"></a><span class="lineno"><a class="line" href="sv__demo_8c.html#af2bc2d94afb470315c0786124a2fdc31a75fd01e2070256a0617c394331e5ee9f">   62</a></span>&#160;    <a class="code" href="sv__demo_8c.html#af2bc2d94afb470315c0786124a2fdc31a75fd01e2070256a0617c394331e5ee9f">demo_entityShared</a>, <span class="comment">// gentity_t-&gt;entityShared_t management</span></div><div class="line"><a name="l00063"></a><span class="lineno"><a class="line" href="sv__demo_8c.html#af2bc2d94afb470315c0786124a2fdc31a2408c8938e204b6ab01b8d830d5b1c2c">   63</a></span>&#160;    <a class="code" href="sv__demo_8c.html#af2bc2d94afb470315c0786124a2fdc31a2408c8938e204b6ab01b8d830d5b1c2c">demo_playerState</a>, <span class="comment">// players game state event (playerState_t management)</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <span class="comment">//demo_clientUsercmd, // players commands/movements packets (usercmd_t management)</span></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;} <a class="code" href="sv__demo_8c.html#af2bc2d94afb470315c0786124a2fdc31">demo_ops_e</a>;</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="comment">/*** STATIC VARIABLES ***/</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="comment">// We set them as static so that they are global only for this file, this limit a bit the side-effect</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="comment">// Big fat buffer to store all our stuff</span></div><div class="line"><a name="l00072"></a><span class="lineno"><a class="line" href="sv__demo_8c.html#a1756d9ddc463d7bca9539c8546a7c1b0">   72</a></span>&#160;<span class="keyword">static</span> <a class="code" href="q__shared_8h.html#a0c8186d9b9b7880309c27230bbb5e69d">byte</a> <a class="code" href="sv__demo_8c.html#a1756d9ddc463d7bca9539c8546a7c1b0">buf</a>[0x400000];</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="comment">// Save maxclients and democlients and restore them after the demo</span></div><div class="line"><a name="l00075"></a><span class="lineno"><a class="line" href="sv__demo_8c.html#a96ab40d64e830462b4c50916b4ee960a">   75</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="sv__demo_8c.html#a96ab40d64e830462b4c50916b4ee960a">savedMaxClients</a> = -1;</div><div class="line"><a name="l00076"></a><span class="lineno"><a class="line" href="sv__demo_8c.html#a2aef5c150509941d274951dd9ad0065f">   76</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="sv__demo_8c.html#a2aef5c150509941d274951dd9ad0065f">savedFPS</a>        = -1;</div><div class="line"><a name="l00077"></a><span class="lineno"><a class="line" href="sv__demo_8c.html#a6e1988af3068dd6e5579127c4580998f">   77</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="sv__demo_8c.html#a6e1988af3068dd6e5579127c4580998f">savedGametype</a>   = -1;</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;</div><div class="line"><a name="l00079"></a><span class="lineno"><a class="line" href="sv__demo_8c.html#aa21691af03d57b54abf4a87f05afc9b6">   79</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="sv__demo_8c.html#aa21691af03d57b54abf4a87f05afc9b6">savedDoWarmup</a>  = -1;</div><div class="line"><a name="l00080"></a><span class="lineno"><a class="line" href="sv__demo_8c.html#af3e78672f89264c08f7d2dc2a8b43bac">   80</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="sv__demo_8c.html#af3e78672f89264c08f7d2dc2a8b43bac">savedAllowVote</a> = -1;</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;</div><div class="line"><a name="l00082"></a><span class="lineno"><a class="line" href="sv__demo_8c.html#a3f3666cfadf0a34792d803d256675d20">   82</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="sv__demo_8c.html#a3f3666cfadf0a34792d803d256675d20">savedTimelimit</a>    = -1;</div><div class="line"><a name="l00083"></a><span class="lineno"><a class="line" href="sv__demo_8c.html#a85e89000c3c7d3a6a54bda8b7f157c5e">   83</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="sv__demo_8c.html#a85e89000c3c7d3a6a54bda8b7f157c5e">savedFraglimit</a>    = -1;</div><div class="line"><a name="l00084"></a><span class="lineno"><a class="line" href="sv__demo_8c.html#a3be8030f70d69bd57596786aaf19b572">   84</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="sv__demo_8c.html#a3be8030f70d69bd57596786aaf19b572">savedCapturelimit</a> = -1;</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;</div><div class="line"><a name="l00086"></a><span class="lineno"><a class="line" href="sv__demo_8c.html#a969169e99a911b6986af6c45ace955ff">   86</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> <a class="code" href="sv__demo_8c.html#a969169e99a911b6986af6c45ace955ff">savedFsGameVal</a>[<a class="code" href="q__shared_8h.html#abd4ae30fcfdcbbff51bbf3f4e6daeee7">MAX_QPATH</a>] = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l00087"></a><span class="lineno"><a class="line" href="sv__demo_8c.html#a97d4db4d6cb8217fdd4b8b641aebcea4">   87</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="sv__demo_8c.html#a97d4db4d6cb8217fdd4b8b641aebcea4">savedFsGame</a>              = <a class="code" href="sv__demo_8c.html#a969169e99a911b6986af6c45ace955ff">savedFsGameVal</a>;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;</div><div class="line"><a name="l00089"></a><span class="lineno"><a class="line" href="sv__demo_8c.html#a95c238fae64c45718ef4e2ec2dbcb7cb">   89</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> <a class="code" href="sv__demo_8c.html#a95c238fae64c45718ef4e2ec2dbcb7cb">savedPlaybackDemonameVal</a>[<a class="code" href="q__shared_8h.html#abd4ae30fcfdcbbff51bbf3f4e6daeee7">MAX_QPATH</a>] = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l00090"></a><span class="lineno"><a class="line" href="sv__demo_8c.html#a91118323f8771a34cc42f63aa7fe3cc9">   90</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="sv__demo_8c.html#a91118323f8771a34cc42f63aa7fe3cc9">savedPlaybackDemoname</a>              = <a class="code" href="sv__demo_8c.html#a95c238fae64c45718ef4e2ec2dbcb7cb">savedPlaybackDemonameVal</a>;</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;</div><div class="line"><a name="l00092"></a><span class="lineno"><a class="line" href="sv__demo_8c.html#ae69d0c0b6524cde1bb78650a3627b9ad">   92</a></span>&#160;<span class="keyword">static</span> <a class="code" href="q__shared_8h.html#a110846a9664bbd925f955266e60e9136">qboolean</a> <a class="code" href="sv__demo_8c.html#ae69d0c0b6524cde1bb78650a3627b9ad">keepSaved</a> = <a class="code" href="q__shared_8h.html#a110846a9664bbd925f955266e60e9136a0e538a5d43e68d2de4eb96c77855de40">qfalse</a>; <span class="comment">// var that memorizes if we keep the new maxclients and democlients values (in the case that we restart the map/server for these cvars to be affected since they are latched, we need to stop the playback meanwhile we restart, and using this var we can know if the stop is a restart procedure or a real demo end) or if we can restore them (at the end of the demo)</span></div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;</div><div class="line"><a name="l00097"></a><span class="lineno"><a class="line" href="sv__demo_8c.html#a88fbc53658b1f8c0833176451c609a67">   97</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="sv__demo_8c.html#a88fbc53658b1f8c0833176451c609a67">SV_DemoCvarsRestore</a>()</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;{</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    <span class="comment">// Restore initial cvars of the server that were modified by the demo playback</span></div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    <span class="comment">// Note: must do it before the map_restart! so that latched values such as sv_maxclients takes effect</span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="sv__demo_8c.html#ae69d0c0b6524cde1bb78650a3627b9ad">keepSaved</a>)</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    {</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;        <a class="code" href="cvar_8c.html#abbb41791f156730b8af8e3e0a7fac820">Cvar_SetValue</a>(<span class="stringliteral">&quot;sv_democlients&quot;</span>, 0);</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="sv__demo_8c.html#a96ab40d64e830462b4c50916b4ee960a">savedMaxClients</a> &gt;= 0)</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;        {</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;            <a class="code" href="cvar_8c.html#a950a656c1889d681b4a28c82439031d1">Cvar_SetLatched</a>(<span class="stringliteral">&quot;sv_maxclients&quot;</span>, <a class="code" href="dl__local_8h.html#a2f2251d7d64d4c9ec69520b953f68bb9">va</a>(<span class="stringliteral">&quot;%i&quot;</span>, <a class="code" href="sv__demo_8c.html#a96ab40d64e830462b4c50916b4ee960a">savedMaxClients</a>));</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;            <a class="code" href="sv__demo_8c.html#a96ab40d64e830462b4c50916b4ee960a">savedMaxClients</a> = -1;</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;        }</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="sv__demo_8c.html#a2aef5c150509941d274951dd9ad0065f">savedFPS</a> &gt; 0)</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        {</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;            <a class="code" href="cvar_8c.html#abbb41791f156730b8af8e3e0a7fac820">Cvar_SetValue</a>(<span class="stringliteral">&quot;sv_fps&quot;</span>, <a class="code" href="sv__demo_8c.html#a2aef5c150509941d274951dd9ad0065f">savedFPS</a>);</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;            <a class="code" href="sv__demo_8c.html#a2aef5c150509941d274951dd9ad0065f">savedFPS</a> = -1;</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;        }</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="sv__demo_8c.html#aa21691af03d57b54abf4a87f05afc9b6">savedDoWarmup</a> &gt;= 0)</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;        {</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;            <a class="code" href="cvar_8c.html#abbb41791f156730b8af8e3e0a7fac820">Cvar_SetValue</a>(<span class="stringliteral">&quot;g_doWarmup&quot;</span>, <a class="code" href="sv__demo_8c.html#aa21691af03d57b54abf4a87f05afc9b6">savedDoWarmup</a>);</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;            <a class="code" href="sv__demo_8c.html#aa21691af03d57b54abf4a87f05afc9b6">savedDoWarmup</a> = -1;</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;        }</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="sv__demo_8c.html#af3e78672f89264c08f7d2dc2a8b43bac">savedAllowVote</a> &gt;= 0)</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;        {</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;            <a class="code" href="cvar_8c.html#abbb41791f156730b8af8e3e0a7fac820">Cvar_SetValue</a>(<span class="stringliteral">&quot;g_allowVote&quot;</span>, <a class="code" href="sv__demo_8c.html#af3e78672f89264c08f7d2dc2a8b43bac">savedAllowVote</a>);</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;            <a class="code" href="sv__demo_8c.html#af3e78672f89264c08f7d2dc2a8b43bac">savedAllowVote</a> = -1;</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;        }</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="sv__demo_8c.html#a3f3666cfadf0a34792d803d256675d20">savedTimelimit</a> &gt;= 0)</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;        {</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;            <a class="code" href="cvar_8c.html#abbb41791f156730b8af8e3e0a7fac820">Cvar_SetValue</a>(<span class="stringliteral">&quot;timelimit&quot;</span>, <a class="code" href="sv__demo_8c.html#a3f3666cfadf0a34792d803d256675d20">savedTimelimit</a>);</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;            <a class="code" href="sv__demo_8c.html#a3f3666cfadf0a34792d803d256675d20">savedTimelimit</a> = -1;</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;        }</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="sv__demo_8c.html#a85e89000c3c7d3a6a54bda8b7f157c5e">savedFraglimit</a> &gt;= 0)</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;        {</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;            <a class="code" href="cvar_8c.html#abbb41791f156730b8af8e3e0a7fac820">Cvar_SetValue</a>(<span class="stringliteral">&quot;fraglimit&quot;</span>, <a class="code" href="sv__demo_8c.html#a85e89000c3c7d3a6a54bda8b7f157c5e">savedFraglimit</a>);</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;            <a class="code" href="sv__demo_8c.html#a85e89000c3c7d3a6a54bda8b7f157c5e">savedFraglimit</a> = -1;</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;        }</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="sv__demo_8c.html#a3be8030f70d69bd57596786aaf19b572">savedCapturelimit</a> &gt;= 0)</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;        {</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;            <a class="code" href="cvar_8c.html#abbb41791f156730b8af8e3e0a7fac820">Cvar_SetValue</a>(<span class="stringliteral">&quot;capturelimit&quot;</span>, <a class="code" href="sv__demo_8c.html#a3be8030f70d69bd57596786aaf19b572">savedCapturelimit</a>);</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;            <a class="code" href="sv__demo_8c.html#a3be8030f70d69bd57596786aaf19b572">savedCapturelimit</a> = -1;</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;        }</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;        <span class="keywordflow">if</span> (strlen(<a class="code" href="sv__demo_8c.html#a97d4db4d6cb8217fdd4b8b641aebcea4">savedFsGame</a>))</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;        {</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;            <span class="comment">// After setting all the other vars, we switch back the mod if necessary (it must be done only AFTER all the other cvars are set, else cvars set after won&#39;t take effect!)</span></div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;            <a class="code" href="cmd_8c.html#a64f2928056fbc22633bf72cadc92e16a">Cbuf_AddText</a>(<a class="code" href="dl__local_8h.html#a2f2251d7d64d4c9ec69520b953f68bb9">va</a>(<span class="stringliteral">&quot;game_restart %s\n&quot;</span>, <a class="code" href="sv__demo_8c.html#a97d4db4d6cb8217fdd4b8b641aebcea4">savedFsGame</a>));</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;            <a class="code" href="q__shared_8c.html#a70a2b0d67ad6af400d513cf1136af8dc">Q_strncpyz</a>(<a class="code" href="sv__demo_8c.html#a97d4db4d6cb8217fdd4b8b641aebcea4">savedFsGame</a>, <span class="stringliteral">&quot;&quot;</span>, <a class="code" href="q__shared_8h.html#abd4ae30fcfdcbbff51bbf3f4e6daeee7">MAX_QPATH</a>);</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;        }</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="sv__demo_8c.html#a6e1988af3068dd6e5579127c4580998f">savedGametype</a> &gt;= 0)</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;        {</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;            <a class="code" href="cvar_8c.html#a950a656c1889d681b4a28c82439031d1">Cvar_SetLatched</a>(<span class="stringliteral">&quot;g_gametype&quot;</span>, <a class="code" href="dl__local_8h.html#a2f2251d7d64d4c9ec69520b953f68bb9">va</a>(<span class="stringliteral">&quot;%i&quot;</span>, <a class="code" href="sv__demo_8c.html#a6e1988af3068dd6e5579127c4580998f">savedGametype</a>));</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;            <a class="code" href="cmd_8c.html#a64f2928056fbc22633bf72cadc92e16a">Cbuf_AddText</a>(<a class="code" href="dl__local_8h.html#a2f2251d7d64d4c9ec69520b953f68bb9">va</a>(<span class="stringliteral">&quot;g_gametype %i\n&quot;</span>, <a class="code" href="sv__demo_8c.html#a6e1988af3068dd6e5579127c4580998f">savedGametype</a>)); <span class="comment">// force gametype switching (NOTE: must be AFTER game_restart to work!)</span></div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;            <a class="code" href="sv__demo_8c.html#a6e1988af3068dd6e5579127c4580998f">savedGametype</a> = -1;</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;        }</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        <a class="code" href="cg__main_8c.html#ac5a47034a0c2a1c1eba5f1acd22987a2">Com_Printf</a>(<span class="stringliteral">&quot;Demo changed CVARs restored.\n&quot;</span>);</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    }</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;}</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;<span class="comment">/***********************************************</span></div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;<span class="comment">* AUXILIARY FUNCTIONS: CHECKING, FILTERING AND CLEANING</span></div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;<span class="comment">* Functions used to either trim unnecessary or privacy concerned data, or to just check if the data should be written in the demo, relayed to a more specialized function or just dropped.</span></div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;<span class="comment">***********************************************/</span></div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;</div><div class="line"><a name="l00177"></a><span class="lineno"><a class="line" href="sv__demo_8c.html#aba97b9ff4cc466abde57e33ab63649dc">  177</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="sv__demo_8c.html#aba97b9ff4cc466abde57e33ab63649dc">SV_CleanStrCmd</a>(<span class="keywordtype">char</span> *<span class="keywordtype">string</span>)</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;{</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    <span class="keywordtype">char</span> *d = string;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    <span class="keywordtype">char</span> *s = string;</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    <span class="keywordtype">int</span>  c;</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    <span class="keywordflow">while</span> ((c = *s) != 0)</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    {</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="sv__demo_8c.html#aa6c595b76b700169003ada70b27a546b">Q_IsColorStringGameCommand</a>(s))</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;        {</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;            s++;</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;        }</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c &gt;= 0x20 &amp;&amp; c &lt;= 0x7E)</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;        {</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;            *d++ = c;</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;        }</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;        s++;</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    }</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    *d = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    <span class="keywordflow">return</span> string;</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;}</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;</div><div class="line"><a name="l00208"></a><span class="lineno"><a class="line" href="sv__demo_8c.html#ae40ba076ac619b2c265145f7b7e5fc1a">  208</a></span>&#160;<span class="keyword">static</span> <a class="code" href="q__shared_8h.html#a110846a9664bbd925f955266e60e9136">qboolean</a> <a class="code" href="sv__demo_8c.html#ae40ba076ac619b2c265145f7b7e5fc1a">SV_CheckClientCommand</a>(<a class="code" href="structclient__s.html">client_t</a> *client, <span class="keyword">const</span> <span class="keywordtype">char</span> *cmd)</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;{</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    <span class="comment">// If that&#39;s a userinfo command, we directly handle that with a specialized function (and we check that it contains at least 10 characters so that when we copy the string we don&#39;t end up copying a random address in memory)</span></div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    <span class="keywordflow">if</span> (strlen(cmd) &gt; 9 &amp;&amp; !<a class="code" href="q__shared_8c.html#a91cce8a6e4157761794c0c88f3396945">Q_strncmp</a>(cmd, <span class="stringliteral">&quot;userinfo&quot;</span>, 8))</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    {</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;        <span class="keywordtype">char</span> userinfo[<a class="code" href="q__shared_8h.html#a0eafe8f648a704333f11e9b825d01896">MAX_INFO_STRING</a>];</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;        <a class="code" href="q__shared_8h.html#a331d56054b8d2cc3b4be5aaa79f9258c">Com_Memset</a>(userinfo, 0, <a class="code" href="q__shared_8h.html#a0eafe8f648a704333f11e9b825d01896">MAX_INFO_STRING</a>);</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;        <a class="code" href="q__shared_8c.html#a70a2b0d67ad6af400d513cf1136af8dc">Q_strncpyz</a>(userinfo, cmd + 9, <a class="code" href="q__shared_8h.html#a0eafe8f648a704333f11e9b825d01896">MAX_INFO_STRING</a>); <span class="comment">// trimming out the &quot;userinfo &quot; substring (because we only need the userinfo string)</span></div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;        <a class="code" href="sv__demo_8c.html#ab15813f230fc9470cd6236c2f4c0cba2">SV_DemoWriteClientUserinfo</a>(client, (<span class="keyword">const</span> <span class="keywordtype">char</span> *)userinfo); <span class="comment">// passing relay to the specialized function for this job</span></div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="q__shared_8h.html#a110846a9664bbd925f955266e60e9136a0e538a5d43e68d2de4eb96c77855de40">qfalse</a>; <span class="comment">// we return false if the check wasn&#39;t right (meaning that this function does not need to process anything)</span></div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    }</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="q__shared_8c.html#a91cce8a6e4157761794c0c88f3396945">Q_strncmp</a>(cmd, <span class="stringliteral">&quot;say_team&quot;</span>, 8))</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    {</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;        <span class="comment">// Privacy check: if the command is say_team, we just drop it</span></div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="q__shared_8h.html#a110846a9664bbd925f955266e60e9136a0e538a5d43e68d2de4eb96c77855de40">qfalse</a>;</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    }</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="q__shared_8h.html#a110846a9664bbd925f955266e60e9136a9a60e3a3b7123e30c470bd5823cde09d">qtrue</a>; <span class="comment">// else, the check is OK and we continue to process with the original function</span></div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;}</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;</div><div class="line"><a name="l00236"></a><span class="lineno"><a class="line" href="sv__demo_8c.html#ab22110bbf964d536640bb88547523025">  236</a></span>&#160;<span class="keyword">static</span> <a class="code" href="q__shared_8h.html#a110846a9664bbd925f955266e60e9136">qboolean</a> <a class="code" href="sv__demo_8c.html#ab22110bbf964d536640bb88547523025">SV_CheckServerCommand</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *cmd)</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;{</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="q__shared_8c.html#a91cce8a6e4157761794c0c88f3396945">Q_strncmp</a>(cmd, <span class="stringliteral">&quot;print&quot;</span>, 5) || !<a class="code" href="q__shared_8c.html#a91cce8a6e4157761794c0c88f3396945">Q_strncmp</a>(cmd, <span class="stringliteral">&quot;cp&quot;</span>, 2) || !<a class="code" href="q__shared_8c.html#a91cce8a6e4157761794c0c88f3396945">Q_strncmp</a>(cmd, <span class="stringliteral">&quot;disconnect&quot;</span>, 10))</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    {</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;        <span class="comment">// If that&#39;s a print/cp command, it&#39;s already handled by gameCommand (here it&#39;s a redundancy).</span></div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;        <span class="comment">// FIXME? possibly some print/cp are not handled by gameCommand? From my tests it was ok,</span></div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;        <span class="comment">// but if someday a few prints are missing, try to delete this check...</span></div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;        <span class="comment">// For security, we also drop disconnect (even if it should not be recorded anyway in the first place),</span></div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;        <span class="comment">// because server commands will be sent to every connected clients, and so it will disconnect everyone.</span></div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="q__shared_8h.html#a110846a9664bbd925f955266e60e9136a0e538a5d43e68d2de4eb96c77855de40">qfalse</a>; <span class="comment">// we return false if the check wasn&#39;t right</span></div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    }</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="q__shared_8h.html#a110846a9664bbd925f955266e60e9136a9a60e3a3b7123e30c470bd5823cde09d">qtrue</a>; <span class="comment">// else, the check is OK and we continue to process with the original function</span></div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;}</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;</div><div class="line"><a name="l00258"></a><span class="lineno"><a class="line" href="sv__demo_8c.html#a556c369cb3706595a0068e2de9e9d7db">  258</a></span>&#160;<a class="code" href="q__shared_8h.html#a110846a9664bbd925f955266e60e9136">qboolean</a> <a class="code" href="sv__demo_8c.html#a556c369cb3706595a0068e2de9e9d7db">SV_CheckLastCmd</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *cmd, <a class="code" href="q__shared_8h.html#a110846a9664bbd925f955266e60e9136">qboolean</a> onlyStore)</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;{</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    <span class="keyword">static</span> <span class="keywordtype">char</span> prevcmddata[<a class="code" href="q__shared_8h.html#adf9097a01af0067c10d749471dbdbe34">MAX_STRING_CHARS</a>];</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    <span class="keyword">static</span> <span class="keywordtype">char</span> *prevcmd = prevcmddata;</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    <span class="keywordtype">char</span>        cleanedprevcmd[<a class="code" href="q__shared_8h.html#adf9097a01af0067c10d749471dbdbe34">MAX_STRING_CHARS</a>];</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    <span class="keywordtype">char</span>        cleanedcmd[<a class="code" href="q__shared_8h.html#adf9097a01af0067c10d749471dbdbe34">MAX_STRING_CHARS</a>];</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    <a class="code" href="q__shared_8h.html#a331d56054b8d2cc3b4be5aaa79f9258c">Com_Memset</a>(cleanedprevcmd, 0, <a class="code" href="q__shared_8h.html#adf9097a01af0067c10d749471dbdbe34">MAX_STRING_CHARS</a>);</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    <a class="code" href="q__shared_8h.html#a331d56054b8d2cc3b4be5aaa79f9258c">Com_Memset</a>(cleanedcmd, 0, <a class="code" href="q__shared_8h.html#adf9097a01af0067c10d749471dbdbe34">MAX_STRING_CHARS</a>);</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    <a class="code" href="q__shared_8c.html#a70a2b0d67ad6af400d513cf1136af8dc">Q_strncpyz</a>(cleanedprevcmd, <a class="code" href="sv__demo_8c.html#aba97b9ff4cc466abde57e33ab63649dc">SV_CleanStrCmd</a>(<a class="code" href="dl__local_8h.html#a2f2251d7d64d4c9ec69520b953f68bb9">va</a>(<span class="stringliteral">&quot;%s&quot;</span>, prevcmd)), <a class="code" href="q__shared_8h.html#adf9097a01af0067c10d749471dbdbe34">MAX_STRING_CHARS</a>);</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    <a class="code" href="q__shared_8c.html#a70a2b0d67ad6af400d513cf1136af8dc">Q_strncpyz</a>(cleanedcmd, <a class="code" href="sv__demo_8c.html#aba97b9ff4cc466abde57e33ab63649dc">SV_CleanStrCmd</a>(<a class="code" href="dl__local_8h.html#a2f2251d7d64d4c9ec69520b953f68bb9">va</a>(<span class="stringliteral">&quot;%s&quot;</span>, cmd)), <a class="code" href="q__shared_8h.html#adf9097a01af0067c10d749471dbdbe34">MAX_STRING_CHARS</a>);</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    <span class="comment">// if we only want to store, we skip any checking</span></div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    <span class="keywordflow">if</span> (!onlyStore &amp;&amp; strlen(prevcmd) &gt; 0 &amp;&amp; !<a class="code" href="dl__local_8h.html#a74f39535654af88006aa56dca7615bc5">Q_stricmp</a>(cleanedprevcmd, cleanedcmd))</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    {</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;        <span class="comment">// check that the previous cmd was different from the current cmd.</span></div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="q__shared_8h.html#a110846a9664bbd925f955266e60e9136a0e538a5d43e68d2de4eb96c77855de40">qfalse</a>; <span class="comment">// drop this command, it&#39;s a repetition of the previous one</span></div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    }</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    {</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;        <a class="code" href="q__shared_8c.html#a70a2b0d67ad6af400d513cf1136af8dc">Q_strncpyz</a>(prevcmd, cmd, <a class="code" href="q__shared_8h.html#adf9097a01af0067c10d749471dbdbe34">MAX_STRING_CHARS</a>); <span class="comment">// memorize the current cmd for the next check (clean the cmd before, because sometimes the same string is issued by the engine with some empty colors?)</span></div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="q__shared_8h.html#a110846a9664bbd925f955266e60e9136a9a60e3a3b7123e30c470bd5823cde09d">qtrue</a>;</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    }</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;}</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;</div><div class="line"><a name="l00289"></a><span class="lineno"><a class="line" href="sv__demo_8c.html#a29cb789f1bf3fd818cbd9f621016c9cb">  289</a></span>&#160;<span class="keyword">static</span> <a class="code" href="q__shared_8h.html#a110846a9664bbd925f955266e60e9136">qboolean</a> <a class="code" href="sv__demo_8c.html#a29cb789f1bf3fd818cbd9f621016c9cb">SV_CheckGameCommand</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *cmd)</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;{</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="sv__demo_8c.html#a556c369cb3706595a0068e2de9e9d7db">SV_CheckLastCmd</a>(cmd, <a class="code" href="q__shared_8h.html#a110846a9664bbd925f955266e60e9136a0e538a5d43e68d2de4eb96c77855de40">qfalse</a>))</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    {</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;        <span class="comment">// check that the previous cmd was different from the current cmd. The engine may send the same command to every client by their cid (one command per client) instead of just sending one command to all using NULL or -1.</span></div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="q__shared_8h.html#a110846a9664bbd925f955266e60e9136a0e538a5d43e68d2de4eb96c77855de40">qfalse</a>; <span class="comment">// drop this command, it&#39;s a repetition of the previous one</span></div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    }</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    {</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;        <span class="comment">// we filter out the chat and tchat commands which are recorded and handled directly by clientCommand (which is easier to manage because it makes a difference between say, say_team and tell, which we don&#39;t have here in gamecommands: we either have chat(for say and tell) or tchat (for say_team) and the other difference is that chat/tchat messages directly contain the name of the player, while clientCommand only contains the clientid, so that it itself fetch the name from client-&gt;name</span></div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="q__shared_8c.html#a91cce8a6e4157761794c0c88f3396945">Q_strncmp</a>(cmd, <span class="stringliteral">&quot;chat&quot;</span>, 4) || !<a class="code" href="q__shared_8c.html#a91cce8a6e4157761794c0c88f3396945">Q_strncmp</a>(cmd, <span class="stringliteral">&quot;tchat&quot;</span>, 5))</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;        {</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="q__shared_8h.html#a110846a9664bbd925f955266e60e9136a0e538a5d43e68d2de4eb96c77855de40">qfalse</a>; <span class="comment">// we return false if the check wasn&#39;t right</span></div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;        }</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="q__shared_8c.html#a91cce8a6e4157761794c0c88f3396945">Q_strncmp</a>(cmd, <span class="stringliteral">&quot;cs&quot;</span>, 2))</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;        {</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;            <span class="comment">// if it&#39;s a configstring command, we handle that with the specialized function</span></div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;            <a class="code" href="cmd_8c.html#a25002ad2a0030da75a2030d646bcbc75">Cmd_TokenizeString</a>(cmd);</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;            <a class="code" href="sv__demo_8c.html#a8615b363043f307f54f6462a3fa072cb">SV_DemoWriteConfigString</a>(atoi(<a class="code" href="cmd_8c.html#a1734574e90e7819673500355d4758877">Cmd_Argv</a>(1)), <a class="code" href="cmd_8c.html#a1734574e90e7819673500355d4758877">Cmd_Argv</a>(2)); <span class="comment">// relay to the specialized write configstring function</span></div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="q__shared_8h.html#a110846a9664bbd925f955266e60e9136a0e538a5d43e68d2de4eb96c77855de40">qfalse</a>; <span class="comment">// drop it with the processing of the game command</span></div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;        }</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="q__shared_8h.html#a110846a9664bbd925f955266e60e9136a9a60e3a3b7123e30c470bd5823cde09d">qtrue</a>; <span class="comment">// else, the check is OK and we continue to process with the original function</span></div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    }</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;}</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;</div><div class="line"><a name="l00321"></a><span class="lineno"><a class="line" href="sv__demo_8c.html#a1d1939204445abada2986c14f21b0ffa">  321</a></span>&#160;<span class="keyword">static</span> <a class="code" href="q__shared_8h.html#a110846a9664bbd925f955266e60e9136">qboolean</a> <a class="code" href="sv__demo_8c.html#a1d1939204445abada2986c14f21b0ffa">SV_CheckConfigString</a>(<span class="keywordtype">int</span> cs_index, <span class="keyword">const</span> <span class="keywordtype">char</span> *cs_string)</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;{</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    <span class="comment">// if this is a player, we save the configstring as a clientconfigstring</span></div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;    <span class="keywordflow">if</span> (cs_index &gt;= <a class="code" href="group__lua__etvars.html#ga3c4270e8cb68ad1ff315b9ec7dbd2ef1">CS_PLAYERS</a> &amp;&amp; cs_index &lt; CS_PLAYERS + sv_maxclients-&gt;integer)</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    {</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;        <a class="code" href="sv__demo_8c.html#aef7d3c63cf10e49a020339383214ce81">SV_DemoWriteClientConfigString</a>(cs_index - <a class="code" href="group__lua__etvars.html#ga3c4270e8cb68ad1ff315b9ec7dbd2ef1">CS_PLAYERS</a>, cs_string);</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;        <span class="comment">// we return false if the check wasn&#39;t right (meaning that we stop the normal configstring processing since the clientconfigstring function will handle that)</span></div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="q__shared_8h.html#a110846a9664bbd925f955266e60e9136a0e538a5d43e68d2de4eb96c77855de40">qfalse</a>;</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    }</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cs_index &lt; <a class="code" href="group__lua__etvars.html#ga51cad0ce7f4368abb921a976fcdaacce">CS_MOTD</a>)</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    {</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;        <span class="comment">// if the configstring index is below 4 (the motd), we don&#39;t save it (these are systems configstrings and will make an infinite loop for real clients at connection when the demo is played back, their management must be left to the system even at replaying)</span></div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;        <span class="comment">// just drop this configstring</span></div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="q__shared_8h.html#a110846a9664bbd925f955266e60e9136a0e538a5d43e68d2de4eb96c77855de40">qfalse</a>;</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    }</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    <span class="comment">// else, the check is OK and we continue to process to save it as a normal configstring (for capture scores CS_SCORES1/2, for CS_FLAGSTATUS, etc..)</span></div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="q__shared_8h.html#a110846a9664bbd925f955266e60e9136a9a60e3a3b7123e30c470bd5823cde09d">qtrue</a>;</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;}</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;</div><div class="line"><a name="l00345"></a><span class="lineno"><a class="line" href="sv__demo_8c.html#a21441f49ae53a7b13498ec69122910a1">  345</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="sv__demo_8c.html#a21441f49ae53a7b13498ec69122910a1">SV_DemoFilterClientUserinfo</a>(<span class="keywordtype">char</span> *userinfo)</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;{</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    <a class="code" href="q__shared_8c.html#af4759dc8f041fd3cdccdaed72ac7f694">Info_RemoveKey</a>(userinfo, <span class="stringliteral">&quot;cl_guid&quot;</span>);</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    <a class="code" href="q__shared_8c.html#af4759dc8f041fd3cdccdaed72ac7f694">Info_RemoveKey</a>(userinfo, <span class="stringliteral">&quot;ip&quot;</span>);</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    <span class="comment">//Info_SetValueForKey(userinfo, &quot;cl_voip&quot;, &quot;0&quot;);</span></div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;}</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;</div><div class="line"><a name="l00357"></a><span class="lineno"><a class="line" href="sv__demo_8c.html#a51a1815a96e037da4d5107c9560aafd5">  357</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="sv__demo_8c.html#a51a1815a96e037da4d5107c9560aafd5">SV_CleanFilename</a>(<span class="keywordtype">char</span> *<span class="keywordtype">string</span>)</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;{</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    <span class="keywordtype">char</span> *d = string;</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    <span class="keywordtype">char</span> *s = string;</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    <span class="keywordtype">int</span>  c;</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    <span class="keywordflow">while</span> ((c = *s) != 0)</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    {</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="q__math_8h.html#a73886d8f4ab1397c17793450d24fe806">Q_IsColorString</a>(s))</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;        {</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;            s++; <span class="comment">// skip if it&#39;s a color</span></div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;        }</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c == 0x2D || c == 0x2E || c == 0x5F ||  <span class="comment">// - . _</span></div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;                 (c &gt;= 0x30 &amp;&amp; c &lt;= 0x39) || <span class="comment">// numbers</span></div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;                 (c &gt;= 0x41 &amp;&amp; c &lt;= 0x5A) || <span class="comment">// uppercase letters</span></div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;                 (c &gt;= 0x61 &amp;&amp; c &lt;= 0x7A) <span class="comment">// lowercase letters</span></div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;                 )</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;        {</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;            *d++ = c; <span class="comment">// keep if this character is not forbidden (contained inside the above whitelist)</span></div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;        }</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;        s++; <span class="comment">// go to next character</span></div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    }</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    *d = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    <span class="keywordflow">return</span> string;</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;}</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;</div><div class="line"><a name="l00390"></a><span class="lineno"><a class="line" href="sv__demo_8c.html#a5cdd1376828a792eeab1ac9e0f3fb945">  390</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="sv__demo_8c.html#a5cdd1376828a792eeab1ac9e0f3fb945">SV_GenerateDateTime</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;{</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    <span class="comment">// Current local time</span></div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    <a class="code" href="structqtime__s.html">qtime_t</a>   now;</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    time_t    utcnow = time(<a class="code" href="q__shared_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    <span class="keyword">struct </span>tm tnow   = *gmtime(&amp;utcnow);</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    <span class="keywordtype">char</span>      buff[1024];</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    <a class="code" href="common_8c.html#a0ab92ecafc08cdd812d6c273f39fc49e">Com_RealTime</a>(&amp;now);</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    strftime(buff, <span class="keyword">sizeof</span> buff, <span class="stringliteral">&quot;timezone %Z (UTC timezone: %Y-%m-%d %H:%M:%S W%W)&quot;</span>, &amp;tnow);</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    <span class="comment">// Return local time and utc time</span></div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="dl__local_8h.html#a2f2251d7d64d4c9ec69520b953f68bb9">va</a>(<span class="stringliteral">&quot;%04d-%02d-%02d %02d:%02d:%02d %s&quot;</span>,</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;              1900 + now.<a class="code" href="structqtime__s.html#aef644b9b87a78a1e9ce0837e96ac7b21">tm_year</a>,</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;              1 + now.<a class="code" href="structqtime__s.html#ab8334f68a3eb928a8611902455880ca3">tm_mon</a>,</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;              now.<a class="code" href="structqtime__s.html#a86d4d9b3464d9cba2fc41a80646857cc">tm_mday</a>,</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;              now.<a class="code" href="structqtime__s.html#a05160c537b35b038e828cc3259f119df">tm_hour</a>,</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;              now.<a class="code" href="structqtime__s.html#a53c431dc2e4ec3fe75e5709c39537d2e">tm_min</a>,</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;              now.<a class="code" href="structqtime__s.html#abd9401c798760d8a96b760e8584a9f35">tm_sec</a>,</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;              buff);</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;}</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;<span class="comment">/***********************************************</span></div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;<span class="comment">* DEMO WRITING FUNCTIONS</span></div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;<span class="comment">* Functions used to construct and write demo events</span></div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;<span class="comment">***********************************************/</span></div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;</div><div class="line"><a name="l00422"></a><span class="lineno"><a class="line" href="sv__demo_8c.html#aca7339ca663e4f8f7bf4218dd9a714c5">  422</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="sv__demo_8c.html#aca7339ca663e4f8f7bf4218dd9a714c5">SV_DemoWriteMessage</a>(<a class="code" href="structmsg__t.html">msg_t</a> *msg)</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;{</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    <span class="keywordtype">int</span> len;</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    <span class="comment">// Write the entire message to the file, prefixed by the length</span></div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    <a class="code" href="msg_8c.html#aea0b2ab8f35e176632549e6b4f1bfc5b">MSG_WriteByte</a>(msg, <a class="code" href="sv__demo_8c.html#af2bc2d94afb470315c0786124a2fdc31af5d3dcaed9fee578e7a23fdaf39b3485">demo_EOF</a>); <span class="comment">// append EOF (end-of-file or rather end-of-flux) to the message so that it will tell the demo parser when the demo will be read that the message ends here, and that it can proceed to the next message</span></div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    len = LittleLong(msg-&gt;<a class="code" href="structmsg__t.html#ad79ecd5d9636d0e96bedd3a8b1be24a8">cursize</a>);</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    (void) <a class="code" href="files_8c.html#af2f02a32d713bda5d8907bb011c22b75">FS_Write</a>(&amp;len, 4, <a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#af6dffe71c8e672577be691d5b32bd8d3">demoFile</a>);</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;    (void) <a class="code" href="files_8c.html#af2f02a32d713bda5d8907bb011c22b75">FS_Write</a>(msg-&gt;<a class="code" href="structmsg__t.html#ab12d572562d7fb2fd9c3a450786e5c33">data</a>, msg-&gt;<a class="code" href="structmsg__t.html#ad79ecd5d9636d0e96bedd3a8b1be24a8">cursize</a>, <a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#af6dffe71c8e672577be691d5b32bd8d3">demoFile</a>);</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    <a class="code" href="msg_8c.html#a7931ab57b8c77c161cb63c76155f92ec">MSG_Clear</a>(msg);</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;}</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;</div><div class="line"><a name="l00439"></a><span class="lineno"><a class="line" href="sv__demo_8c.html#aa2f17f6a5cd4b5c16c474cf33de888ff">  439</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="sv__demo_8c.html#aa2f17f6a5cd4b5c16c474cf33de888ff">SV_DemoWriteClientCommand</a>(<a class="code" href="structclient__s.html">client_t</a> *client, <span class="keyword">const</span> <span class="keywordtype">char</span> *cmd)</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;{</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    <a class="code" href="structmsg__t.html">msg_t</a> msg;</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="sv__demo_8c.html#ae40ba076ac619b2c265145f7b7e5fc1a">SV_CheckClientCommand</a>(client, cmd))</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;    {</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;        <span class="comment">// check that this function really needs to store the command (or if another more specialized function should do it instead, eg: userinfo)</span></div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    }</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    <a class="code" href="msg_8c.html#a4bba3ea21116c996f3e630414895b183">MSG_Init</a>(&amp;msg, <a class="code" href="sv__demo_8c.html#a1756d9ddc463d7bca9539c8546a7c1b0">buf</a>, <span class="keyword">sizeof</span>(<a class="code" href="sv__demo_8c.html#a1756d9ddc463d7bca9539c8546a7c1b0">buf</a>));</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    <a class="code" href="msg_8c.html#aea0b2ab8f35e176632549e6b4f1bfc5b">MSG_WriteByte</a>(&amp;msg, <a class="code" href="sv__demo_8c.html#af2bc2d94afb470315c0786124a2fdc31a4ae848aa842475d53d1bf51d11f5324c">demo_clientCommand</a>);</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    <a class="code" href="msg_8c.html#aea0b2ab8f35e176632549e6b4f1bfc5b">MSG_WriteByte</a>(&amp;msg, client - <a class="code" href="server_8h.html#a698d5b1998898dad31ebfeb8983f8746">svs</a>.<a class="code" href="structserverStatic__t.html#a7cafb183964315009682fc02b30613d9">clients</a>);</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    <a class="code" href="msg_8c.html#ae9560f9b420c88d5da72ff14c004bac0">MSG_WriteString</a>(&amp;msg, cmd);</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    <a class="code" href="sv__demo_8c.html#aca7339ca663e4f8f7bf4218dd9a714c5">SV_DemoWriteMessage</a>(&amp;msg);</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;}</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;</div><div class="line"><a name="l00462"></a><span class="lineno"><a class="line" href="sv__demo_8c.html#aa45515709ea25cc3192f80c86351dc02">  462</a></span>&#160;<a class="code" href="q__shared_8h.html#a110846a9664bbd925f955266e60e9136">qboolean</a> <a class="code" href="sv__demo_8c.html#aa45515709ea25cc3192f80c86351dc02">SV_DemoClientCommandCapture</a>(<a class="code" href="structclient__s.html">client_t</a> *client, <span class="keyword">const</span> <span class="keywordtype">char</span> *msg)</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;{</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#a66e3cb8a5905f2e1e9d8c89fcc2b2dc9">demoState</a> == <a class="code" href="q__shared_8h.html#aeaa898bef6b376f572e5e59d943d78b2a56f619bf31320371483bd356ba300028">DS_RECORDING</a>)     <span class="comment">// if demo is recording, we store this command and clientid</span></div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;    {</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;        <a class="code" href="sv__demo_8c.html#aa2f17f6a5cd4b5c16c474cf33de888ff">SV_DemoWriteClientCommand</a>(client, msg);</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;    }</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#a66e3cb8a5905f2e1e9d8c89fcc2b2dc9">demoState</a> == <a class="code" href="q__shared_8h.html#aeaa898bef6b376f572e5e59d943d78b2a92cbb6b682e745d51527236bad2a6011">DS_PLAYBACK</a> &amp;&amp;</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;             ((client - <a class="code" href="server_8h.html#a698d5b1998898dad31ebfeb8983f8746">svs</a>.<a class="code" href="structserverStatic__t.html#a7cafb183964315009682fc02b30613d9">clients</a>) &gt;= <a class="code" href="server_8h.html#a8d79a0b5f456061ad33642f11f4b7d17">sv_democlients</a>-&gt;<a class="code" href="structcvar__s.html#ae873b26596ff98802364d80bbb71c72a">integer</a>) &amp;&amp; ((client - <a class="code" href="server_8h.html#a698d5b1998898dad31ebfeb8983f8746">svs</a>.<a class="code" href="structserverStatic__t.html#a7cafb183964315009682fc02b30613d9">clients</a>) &lt; <a class="code" href="server_8h.html#a0bc03a0e709716a4965c0324f23b8977">sv_maxclients</a>-&gt;<a class="code" href="structcvar__s.html#ae873b26596ff98802364d80bbb71c72a">integer</a>) &amp;&amp; <span class="comment">// preventing only real clients commands (not democlients commands replayed)</span></div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;             (!<a class="code" href="dl__local_8h.html#a74f39535654af88006aa56dca7615bc5">Q_stricmp</a>(<a class="code" href="cmd_8c.html#a1734574e90e7819673500355d4758877">Cmd_Argv</a>(0), <span class="stringliteral">&quot;team&quot;</span>) &amp;&amp; <a class="code" href="dl__local_8h.html#a74f39535654af88006aa56dca7615bc5">Q_stricmp</a>(<a class="code" href="cmd_8c.html#a1734574e90e7819673500355d4758877">Cmd_Argv</a>(1), <span class="stringliteral">&quot;s&quot;</span>) &amp;&amp; <a class="code" href="dl__local_8h.html#a74f39535654af88006aa56dca7615bc5">Q_stricmp</a>(<a class="code" href="cmd_8c.html#a1734574e90e7819673500355d4758877">Cmd_Argv</a>(1), <span class="stringliteral">&quot;spectator&quot;</span>))) <span class="comment">// if there is a demo playback, we prevent any real client from doing a team change, if so, we issue a chat messsage (except if the player join team spectator again)</span></div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    {</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;        <span class="comment">// issue a chat message only to the player trying to join a team</span></div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;        <a class="code" href="server_8h.html#ade5a29e7abfb559177a66c7af35baf0f">SV_SendServerCommand</a>(client, <span class="stringliteral">&quot;chat \&quot;^3Can&#39;t join a team when a demo is replaying!\&quot;&quot;</span>);</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;        <span class="comment">// issue a chat message only to the player trying to join a team</span></div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;        <a class="code" href="server_8h.html#ade5a29e7abfb559177a66c7af35baf0f">SV_SendServerCommand</a>(client, <span class="stringliteral">&quot;cp \&quot;^3Can&#39;t join a team when a demo is replaying!\&quot;&quot;</span>);</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="q__shared_8h.html#a110846a9664bbd925f955266e60e9136a0e538a5d43e68d2de4eb96c77855de40">qfalse</a>;</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    }</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="q__shared_8h.html#a110846a9664bbd925f955266e60e9136a9a60e3a3b7123e30c470bd5823cde09d">qtrue</a>;</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;}</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;</div><div class="line"><a name="l00491"></a><span class="lineno"><a class="line" href="sv__demo_8c.html#aa6adb04c0f453de369768eb1cddd9f4a">  491</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="sv__demo_8c.html#aa6adb04c0f453de369768eb1cddd9f4a">SV_DemoWriteServerCommand</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *cmd)</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;{</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    <a class="code" href="structmsg__t.html">msg_t</a> msg;</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="sv__demo_8c.html#ab22110bbf964d536640bb88547523025">SV_CheckServerCommand</a>(cmd))</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;    {</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;        <span class="comment">// check that this function really needs to store the command</span></div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;    }</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;    <a class="code" href="msg_8c.html#a4bba3ea21116c996f3e630414895b183">MSG_Init</a>(&amp;msg, <a class="code" href="sv__demo_8c.html#a1756d9ddc463d7bca9539c8546a7c1b0">buf</a>, <span class="keyword">sizeof</span>(<a class="code" href="sv__demo_8c.html#a1756d9ddc463d7bca9539c8546a7c1b0">buf</a>));</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    <a class="code" href="msg_8c.html#aea0b2ab8f35e176632549e6b4f1bfc5b">MSG_WriteByte</a>(&amp;msg, <a class="code" href="sv__demo_8c.html#af2bc2d94afb470315c0786124a2fdc31a7a1cab03a80a4741e82f124d9e6fd8cc">demo_serverCommand</a>);</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    <a class="code" href="msg_8c.html#ae9560f9b420c88d5da72ff14c004bac0">MSG_WriteString</a>(&amp;msg, cmd);</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;    <a class="code" href="sv__demo_8c.html#aca7339ca663e4f8f7bf4218dd9a714c5">SV_DemoWriteMessage</a>(&amp;msg);</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;}</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;</div><div class="line"><a name="l00517"></a><span class="lineno"><a class="line" href="sv__demo_8c.html#a2c7dac2240c5973fef1fdc91ef5da9a0">  517</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="sv__demo_8c.html#a2c7dac2240c5973fef1fdc91ef5da9a0">SV_DemoWriteGameCommand</a>(<span class="keywordtype">int</span> clientNum, <span class="keyword">const</span> <span class="keywordtype">char</span> *cmd)</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;{</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;    <a class="code" href="structmsg__t.html">msg_t</a> msg;</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="sv__demo_8c.html#a29cb789f1bf3fd818cbd9f621016c9cb">SV_CheckGameCommand</a>(cmd))</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;    {</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;        <span class="comment">// check that this function really needs to store the command</span></div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;    }</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;    <a class="code" href="msg_8c.html#a4bba3ea21116c996f3e630414895b183">MSG_Init</a>(&amp;msg, <a class="code" href="sv__demo_8c.html#a1756d9ddc463d7bca9539c8546a7c1b0">buf</a>, <span class="keyword">sizeof</span>(<a class="code" href="sv__demo_8c.html#a1756d9ddc463d7bca9539c8546a7c1b0">buf</a>));</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;    <a class="code" href="msg_8c.html#aea0b2ab8f35e176632549e6b4f1bfc5b">MSG_WriteByte</a>(&amp;msg, <a class="code" href="sv__demo_8c.html#af2bc2d94afb470315c0786124a2fdc31a8829120824b95d7ac3fd0b727d6d7550">demo_gameCommand</a>);</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;    <a class="code" href="msg_8c.html#aea0b2ab8f35e176632549e6b4f1bfc5b">MSG_WriteByte</a>(&amp;msg, clientNum);</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;    <a class="code" href="msg_8c.html#ae9560f9b420c88d5da72ff14c004bac0">MSG_WriteString</a>(&amp;msg, cmd);</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;    <a class="code" href="sv__demo_8c.html#aca7339ca663e4f8f7bf4218dd9a714c5">SV_DemoWriteMessage</a>(&amp;msg);</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;}</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;</div><div class="line"><a name="l00544"></a><span class="lineno"><a class="line" href="sv__demo_8c.html#a8615b363043f307f54f6462a3fa072cb">  544</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="sv__demo_8c.html#a8615b363043f307f54f6462a3fa072cb">SV_DemoWriteConfigString</a>(<span class="keywordtype">int</span> cs_index, <span class="keyword">const</span> <span class="keywordtype">char</span> *cs_string)</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;{</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;    <a class="code" href="structmsg__t.html">msg_t</a> msg;</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;    <span class="keywordtype">char</span>  cindex[<a class="code" href="q__shared_8h.html#a711f5c43166bc15a6a6adc8bacb0684a">MAX_CONFIGSTRINGS</a>];</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="sv__demo_8c.html#a1d1939204445abada2986c14f21b0ffa">SV_CheckConfigString</a>(cs_index, cs_string))</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;    {</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;        <span class="comment">// check that this function really needs to store the configstring (or if it&#39;s a client configstring we relay to the specialized function)</span></div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;    } <span class="comment">// else we save it below as a normal configstring (for capture scores CS_SCORES1/2, for CS_FLAGSTATUS, etc..)</span></div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;    <a class="code" href="msg_8c.html#a4bba3ea21116c996f3e630414895b183">MSG_Init</a>(&amp;msg, <a class="code" href="sv__demo_8c.html#a1756d9ddc463d7bca9539c8546a7c1b0">buf</a>, <span class="keyword">sizeof</span>(<a class="code" href="sv__demo_8c.html#a1756d9ddc463d7bca9539c8546a7c1b0">buf</a>));</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    <a class="code" href="msg_8c.html#aea0b2ab8f35e176632549e6b4f1bfc5b">MSG_WriteByte</a>(&amp;msg, <a class="code" href="sv__demo_8c.html#af2bc2d94afb470315c0786124a2fdc31a28877e13ad25c44d02526672a825b457">demo_configString</a>);</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;    <a class="code" href="q__shared_8c.html#aad4e641649a5bcf8bb21fbe7a815ee98">Com_sprintf</a>(cindex, <span class="keyword">sizeof</span>(cindex), <span class="stringliteral">&quot;%i&quot;</span>, cs_index); <span class="comment">// convert index to a string since we don&#39;t have any other way to store values that are greater than a byte (and max_configstrings is 1024 currently)</span></div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;                                                         <span class="comment">// FIXME: try to replace by a WriteLong instead of WriteString? Or WriteData (with length! and it uses WriteByte)</span></div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;    <a class="code" href="msg_8c.html#ae9560f9b420c88d5da72ff14c004bac0">MSG_WriteString</a>(&amp;msg, (<span class="keyword">const</span> <span class="keywordtype">char</span> *)cindex);</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;    <a class="code" href="msg_8c.html#ae9560f9b420c88d5da72ff14c004bac0">MSG_WriteString</a>(&amp;msg, cs_string);</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;    <a class="code" href="sv__demo_8c.html#aca7339ca663e4f8f7bf4218dd9a714c5">SV_DemoWriteMessage</a>(&amp;msg);</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;}</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;</div><div class="line"><a name="l00574"></a><span class="lineno"><a class="line" href="sv__demo_8c.html#aef7d3c63cf10e49a020339383214ce81">  574</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="sv__demo_8c.html#aef7d3c63cf10e49a020339383214ce81">SV_DemoWriteClientConfigString</a>(<span class="keywordtype">int</span> clientNum, <span class="keyword">const</span> <span class="keywordtype">char</span> *cs_string)</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;{</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;    <a class="code" href="structmsg__t.html">msg_t</a> msg;</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;    <a class="code" href="msg_8c.html#a4bba3ea21116c996f3e630414895b183">MSG_Init</a>(&amp;msg, <a class="code" href="sv__demo_8c.html#a1756d9ddc463d7bca9539c8546a7c1b0">buf</a>, <span class="keyword">sizeof</span>(<a class="code" href="sv__demo_8c.html#a1756d9ddc463d7bca9539c8546a7c1b0">buf</a>));</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;    <a class="code" href="msg_8c.html#aea0b2ab8f35e176632549e6b4f1bfc5b">MSG_WriteByte</a>(&amp;msg, <a class="code" href="sv__demo_8c.html#af2bc2d94afb470315c0786124a2fdc31ade02da1ed2771e05fc653410dabc7ee9">demo_clientConfigString</a>);</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;    <a class="code" href="msg_8c.html#aea0b2ab8f35e176632549e6b4f1bfc5b">MSG_WriteByte</a>(&amp;msg, clientNum);</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;    <a class="code" href="msg_8c.html#ae9560f9b420c88d5da72ff14c004bac0">MSG_WriteString</a>(&amp;msg, cs_string);</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;    <a class="code" href="sv__demo_8c.html#aca7339ca663e4f8f7bf4218dd9a714c5">SV_DemoWriteMessage</a>(&amp;msg);</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;}</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;</div><div class="line"><a name="l00592"></a><span class="lineno"><a class="line" href="sv__demo_8c.html#ab15813f230fc9470cd6236c2f4c0cba2">  592</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="sv__demo_8c.html#ab15813f230fc9470cd6236c2f4c0cba2">SV_DemoWriteClientUserinfo</a>(<a class="code" href="structclient__s.html">client_t</a> *client, <span class="keyword">const</span> <span class="keywordtype">char</span> *userinfo)</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;{</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;    <a class="code" href="structmsg__t.html">msg_t</a>       msg;</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;    <span class="keyword">static</span> <span class="keywordtype">char</span> fuserinfodata[<a class="code" href="q__shared_8h.html#adf9097a01af0067c10d749471dbdbe34">MAX_STRING_CHARS</a>];</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;    <span class="keyword">static</span> <span class="keywordtype">char</span> *fuserinfo = fuserinfodata;</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;    <a class="code" href="q__shared_8c.html#a70a2b0d67ad6af400d513cf1136af8dc">Q_strncpyz</a>(fuserinfo, userinfo, <span class="keyword">sizeof</span>(fuserinfodata)); <span class="comment">// copy the client&#39;s userinfo to another storage var, so that we don&#39;t modify the client&#39;s userinfo (else the filtering will clean its infos such as cl_guid and ip, and next map change the client will be disconnected because of a wrong guid/ip!)</span></div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    <span class="keywordflow">if</span> (strlen(userinfo) &gt; 0)</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;    {</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;        <span class="comment">// do the filtering only if the string is not empty</span></div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;        <a class="code" href="sv__demo_8c.html#a21441f49ae53a7b13498ec69122910a1">SV_DemoFilterClientUserinfo</a>(fuserinfo);   <span class="comment">// filters out privacy keys such as ip, cl_guid, (cl_voip)</span></div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;    }</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;    <a class="code" href="msg_8c.html#a4bba3ea21116c996f3e630414895b183">MSG_Init</a>(&amp;msg, <a class="code" href="sv__demo_8c.html#a1756d9ddc463d7bca9539c8546a7c1b0">buf</a>, <span class="keyword">sizeof</span>(<a class="code" href="sv__demo_8c.html#a1756d9ddc463d7bca9539c8546a7c1b0">buf</a>));</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;    <a class="code" href="msg_8c.html#aea0b2ab8f35e176632549e6b4f1bfc5b">MSG_WriteByte</a>(&amp;msg, <a class="code" href="sv__demo_8c.html#af2bc2d94afb470315c0786124a2fdc31a899deb9b820e7fddef38a0f8b9b02b84">demo_clientUserinfo</a>); <span class="comment">// write the event marker</span></div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;    <a class="code" href="msg_8c.html#aea0b2ab8f35e176632549e6b4f1bfc5b">MSG_WriteByte</a>(&amp;msg, client - <a class="code" href="server_8h.html#a698d5b1998898dad31ebfeb8983f8746">svs</a>.<a class="code" href="structserverStatic__t.html#a7cafb183964315009682fc02b30613d9">clients</a>); <span class="comment">// write the client number (client_t - svs.clients = client num int)</span></div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;    <a class="code" href="msg_8c.html#ae9560f9b420c88d5da72ff14c004bac0">MSG_WriteString</a>(&amp;msg, fuserinfo); <span class="comment">// write the (filtered) userinfo string</span></div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;    <a class="code" href="sv__demo_8c.html#aca7339ca663e4f8f7bf4218dd9a714c5">SV_DemoWriteMessage</a>(&amp;msg); <span class="comment">// commit this demo event in the demo file</span></div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;}</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;<span class="comment"> * @brief Write a client usercmd_t for the current packet (called from sv_client.c SV_UserMove) which contains the movements commands for the player</span></div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;<span class="comment"> * @param[in] cl</span></div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;<span class="comment"> * @param[in] delta</span></div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;<span class="comment"> * @param[in] cmdCount</span></div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;<span class="comment"> * @param[in] cmds</span></div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;<span class="comment"> * @param[in] key</span></div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;<span class="comment"> * @note Note: this is unnecessary to make players move, this is handled by entities management.</span></div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;<span class="comment"> * This is only used to add more data to the dama for data analysis AND avoid inactivity timer activation</span></div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;<span class="comment"> * @note Enabling this feature will use a LOT more storage space, so enable it only if you will really use it.</span></div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;<span class="comment"> * Generally, you&#39;re probably better off leaving it disabled.</span></div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;<span class="comment">void SV_DemoWriteClientUsercmd( client_t *cl, qboolean delta, int cmdCount, usercmd_t *cmds, int key )</span></div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;<span class="comment">{</span></div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;<span class="comment">    msg_t msg;</span></div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;<span class="comment">    usercmd_t nullcmd;</span></div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;<span class="comment">    usercmd_t *cmd, *oldcmd;</span></div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;<span class="comment">    int i;</span></div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;<span class="comment">    //Com_Printf(&quot;DebugGBOWriteusercmd: %i\n&quot;, cl - svs.clients);</span></div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;<span class="comment">    MSG_Init(&amp;msg, buf, sizeof(buf));</span></div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;<span class="comment">    MSG_WriteByte(&amp;msg, demo_clientUsercmd);</span></div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;<span class="comment">    MSG_WriteByte(&amp;msg, cl - svs.clients);</span></div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;<span class="comment">    if (delta)</span></div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;<span class="comment">    MSG_WriteByte(&amp;msg, 1);</span></div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;<span class="comment">    else</span></div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;<span class="comment">    MSG_WriteByte(&amp;msg, 0);</span></div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;<span class="comment">    MSG_WriteByte(&amp;msg, cmdCount);</span></div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;<span class="comment">    Com_Memset( &amp;nullcmd, 0, sizeof(nullcmd) );</span></div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;<span class="comment">    oldcmd = &amp;nullcmd;</span></div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;<span class="comment">    for ( i = 0 ; i &lt; cmdCount ; i++ )</span></div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;<span class="comment">    {</span></div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;<span class="comment">        cmd = &amp;cmds[i];</span></div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;<span class="comment">        MSG_WriteDeltaUsercmdKey( &amp;msg, key, oldcmd, cmd );</span></div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;<span class="comment">        oldcmd = cmd;</span></div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;<span class="comment">    }</span></div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;<span class="comment">    SV_DemoWriteMessage(&amp;msg);</span></div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;<span class="comment">}</span></div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;</div><div class="line"><a name="l00665"></a><span class="lineno"><a class="line" href="sv__demo_8c.html#ab4edf5c3717b68024df01aabcf4e261c">  665</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="sv__demo_8c.html#ab4edf5c3717b68024df01aabcf4e261c">SV_DemoWriteAllPlayerState</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;{</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;    <a class="code" href="structmsg__t.html">msg_t</a>         msg;</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;    <a class="code" href="structplayerState__s.html">playerState_t</a> *player;</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;    <span class="keywordtype">int</span>           i;</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;    <span class="comment">// Initiliaze msg</span></div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;    <a class="code" href="msg_8c.html#a4bba3ea21116c996f3e630414895b183">MSG_Init</a>(&amp;msg, <a class="code" href="sv__demo_8c.html#a1756d9ddc463d7bca9539c8546a7c1b0">buf</a>, <span class="keyword">sizeof</span>(<a class="code" href="sv__demo_8c.html#a1756d9ddc463d7bca9539c8546a7c1b0">buf</a>));</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;    <span class="comment">// Write clients playerState (playerState_t)</span></div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="server_8h.html#a0bc03a0e709716a4965c0324f23b8977">sv_maxclients</a>-&gt;<a class="code" href="structcvar__s.html#ae873b26596ff98802364d80bbb71c72a">integer</a>; i++)</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;    {</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="server_8h.html#a698d5b1998898dad31ebfeb8983f8746">svs</a>.<a class="code" href="structserverStatic__t.html#a7cafb183964315009682fc02b30613d9">clients</a>[i].<a class="code" href="structclient__s.html#aea178e2c587a3c7eacdeaa92488a5f0d">state</a> &lt; <a class="code" href="server_8h.html#a89d33b2529a2789787b365237a7319d4a8d7d62e14bc073c3c05b3cd8de118134">CS_ACTIVE</a>)</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;        {</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;        }</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;        player = <a class="code" href="server_8h.html#a7f1a538eff9cab28ecafcf036f68e49d">SV_GameClientNum</a>(i);</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;        <a class="code" href="msg_8c.html#aea0b2ab8f35e176632549e6b4f1bfc5b">MSG_WriteByte</a>(&amp;msg, <a class="code" href="sv__demo_8c.html#af2bc2d94afb470315c0786124a2fdc31a2408c8938e204b6ab01b8d830d5b1c2c">demo_playerState</a>);</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;        <a class="code" href="msg_8c.html#aea0b2ab8f35e176632549e6b4f1bfc5b">MSG_WriteByte</a>(&amp;msg, i);</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;        <a class="code" href="msg_8c.html#a8d1735f59100643283a0c721bb3a021a">MSG_WriteDeltaPlayerstate</a>(&amp;msg, &amp;<a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#a4132ec967ed2e26499e7c93b84e70915">demoPlayerStates</a>[i], player);</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;        <a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#a4132ec967ed2e26499e7c93b84e70915">demoPlayerStates</a>[i] = *player;</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;    }</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;    <span class="comment">// Commit all these datas to the demo file</span></div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;    <a class="code" href="sv__demo_8c.html#aca7339ca663e4f8f7bf4218dd9a714c5">SV_DemoWriteMessage</a>(&amp;msg);</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;}</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;</div><div class="line"><a name="l00701"></a><span class="lineno"><a class="line" href="sv__demo_8c.html#a3bcd6680e0d399f46b044dc7d23f6208">  701</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="sv__demo_8c.html#a3bcd6680e0d399f46b044dc7d23f6208">SV_DemoWriteAllEntityState</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;{</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;    <a class="code" href="structmsg__t.html">msg_t</a>          msg;</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;    <a class="code" href="structsharedEntity__t.html">sharedEntity_t</a> *entity;</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;    <span class="keywordtype">int</span>            i;</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;    <span class="comment">// Initiliaze msg</span></div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;    <a class="code" href="msg_8c.html#a4bba3ea21116c996f3e630414895b183">MSG_Init</a>(&amp;msg, <a class="code" href="sv__demo_8c.html#a1756d9ddc463d7bca9539c8546a7c1b0">buf</a>, <span class="keyword">sizeof</span>(<a class="code" href="sv__demo_8c.html#a1756d9ddc463d7bca9539c8546a7c1b0">buf</a>));</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;    <span class="comment">// Write entities (gentity_t-&gt;entityState_t or concretely sv.gentities[num].s, in gamecode level. instead of sv.)</span></div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;    <a class="code" href="msg_8c.html#aea0b2ab8f35e176632549e6b4f1bfc5b">MSG_WriteByte</a>(&amp;msg, <a class="code" href="sv__demo_8c.html#af2bc2d94afb470315c0786124a2fdc31aa376fd14cf5aa4417a120dae8db81167">demo_entityState</a>);</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#aecc2bc627e3d7df7e58c8c39d22c10eb">num_entities</a>; i++)</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;    {</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;        <span class="keywordflow">if</span> (i &gt;= <a class="code" href="server_8h.html#a0bc03a0e709716a4965c0324f23b8977">sv_maxclients</a>-&gt;<a class="code" href="structcvar__s.html#ae873b26596ff98802364d80bbb71c72a">integer</a> &amp;&amp; i &lt; <a class="code" href="q__shared_8h.html#a0a8f91f93d75a07f0ae45077db45b3eb">MAX_CLIENTS</a>)</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;        {</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;        }</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;        entity           = <a class="code" href="server_8h.html#a20f9c6bea9d6c49b1e7f2e00ecafb273">SV_GentityNum</a>(i);</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;        entity-&gt;<a class="code" href="structsharedEntity__t.html#a89773b8fde222ad9577e8d9b3504141a">s</a>.<a class="code" href="structentityState__s.html#a5d4361c5a7fbb819946a271304d950cb">number</a> = i;</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;        <a class="code" href="msg_8c.html#aa29f5e1e2e54f0a0d72a9bcc692dfae5">MSG_WriteDeltaEntity</a>(&amp;msg, &amp;<a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#a75f2b31ea80a25242aa46b8dd3d70d1b">demoEntities</a>[i].<a class="code" href="structsharedEntity__t.html#a89773b8fde222ad9577e8d9b3504141a">s</a>, &amp;entity-&gt;<a class="code" href="structsharedEntity__t.html#a89773b8fde222ad9577e8d9b3504141a">s</a>, <a class="code" href="q__shared_8h.html#a110846a9664bbd925f955266e60e9136a0e538a5d43e68d2de4eb96c77855de40">qfalse</a>);</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;        <a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#a75f2b31ea80a25242aa46b8dd3d70d1b">demoEntities</a>[i].<a class="code" href="structsharedEntity__t.html#a89773b8fde222ad9577e8d9b3504141a">s</a> = entity-&gt;<a class="code" href="structsharedEntity__t.html#a89773b8fde222ad9577e8d9b3504141a">s</a>;</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;    }</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;    <a class="code" href="msg_8c.html#aa68d315a2d71b5c63ce607ab1aa57e23">MSG_WriteBits</a>(&amp;msg, <a class="code" href="q__shared_8h.html#aa684040d7aebb90b780e2169fbe326e9">ENTITYNUM_NONE</a>, <a class="code" href="q__shared_8h.html#a674763dac6c5d9defd5165e2d196b7a4">GENTITYNUM_BITS</a>); <span class="comment">// End marker/Condition to break: since we don&#39;t know prior how many entities we store, when reading  the demo we will use an empty entity to break from our while loop</span></div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;    <span class="comment">// Commit all these datas to the demo file</span></div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;    <a class="code" href="sv__demo_8c.html#aca7339ca663e4f8f7bf4218dd9a714c5">SV_DemoWriteMessage</a>(&amp;msg);</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;}</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;</div><div class="line"><a name="l00738"></a><span class="lineno"><a class="line" href="sv__demo_8c.html#aba182f107f0549b75f5a815795be0815">  738</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="sv__demo_8c.html#aba182f107f0549b75f5a815795be0815">SV_DemoWriteAllEntityShared</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;{</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;    <a class="code" href="structmsg__t.html">msg_t</a>          msg;</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;    <a class="code" href="structsharedEntity__t.html">sharedEntity_t</a> *entity;</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;    <span class="keywordtype">int</span>            i;</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;    <span class="comment">// Initiliaze msg</span></div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;    <a class="code" href="msg_8c.html#a4bba3ea21116c996f3e630414895b183">MSG_Init</a>(&amp;msg, <a class="code" href="sv__demo_8c.html#a1756d9ddc463d7bca9539c8546a7c1b0">buf</a>, <span class="keyword">sizeof</span>(<a class="code" href="sv__demo_8c.html#a1756d9ddc463d7bca9539c8546a7c1b0">buf</a>));</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;    <span class="comment">// Write entities (gentity_t-&gt;entityShared_t or concretely sv.gentities[num].r, in gamecode level. instead of sv.)</span></div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;    <a class="code" href="msg_8c.html#aea0b2ab8f35e176632549e6b4f1bfc5b">MSG_WriteByte</a>(&amp;msg, <a class="code" href="sv__demo_8c.html#af2bc2d94afb470315c0786124a2fdc31a75fd01e2070256a0617c394331e5ee9f">demo_entityShared</a>);</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#aecc2bc627e3d7df7e58c8c39d22c10eb">num_entities</a>; i++)</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;    {</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;        <span class="keywordflow">if</span> (i &gt;= <a class="code" href="server_8h.html#a0bc03a0e709716a4965c0324f23b8977">sv_maxclients</a>-&gt;<a class="code" href="structcvar__s.html#ae873b26596ff98802364d80bbb71c72a">integer</a> &amp;&amp; i &lt; <a class="code" href="q__shared_8h.html#a0a8f91f93d75a07f0ae45077db45b3eb">MAX_CLIENTS</a>)</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;        {</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;        }</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;        entity = <a class="code" href="server_8h.html#a20f9c6bea9d6c49b1e7f2e00ecafb273">SV_GentityNum</a>(i);</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;        <a class="code" href="msg_8c.html#a13c7a8df0da3cbc3be9ca3372b11aed5">MSG_WriteDeltaSharedEntity</a>(&amp;msg, &amp;<a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#a75f2b31ea80a25242aa46b8dd3d70d1b">demoEntities</a>[i].<a class="code" href="structsharedEntity__t.html#a465868be7e097c59e30eb820fb890822">r</a>, &amp;entity-&gt;<a class="code" href="structsharedEntity__t.html#a465868be7e097c59e30eb820fb890822">r</a>, <a class="code" href="q__shared_8h.html#a110846a9664bbd925f955266e60e9136a0e538a5d43e68d2de4eb96c77855de40">qfalse</a>, i);</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;        <a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#a75f2b31ea80a25242aa46b8dd3d70d1b">demoEntities</a>[i].<a class="code" href="structsharedEntity__t.html#a465868be7e097c59e30eb820fb890822">r</a> = entity-&gt;<a class="code" href="structsharedEntity__t.html#a465868be7e097c59e30eb820fb890822">r</a>;</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;    }</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;    <a class="code" href="msg_8c.html#aa68d315a2d71b5c63ce607ab1aa57e23">MSG_WriteBits</a>(&amp;msg, <a class="code" href="q__shared_8h.html#aa684040d7aebb90b780e2169fbe326e9">ENTITYNUM_NONE</a>, <a class="code" href="q__shared_8h.html#a674763dac6c5d9defd5165e2d196b7a4">GENTITYNUM_BITS</a>); <span class="comment">// End marker/Condition to break: since we don&#39;t know prior how many entities we store, when reading  the demo we will use an empty entity to break from our while loop</span></div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;    <span class="comment">// Commit all these datas to the demo file</span></div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;    <a class="code" href="sv__demo_8c.html#aca7339ca663e4f8f7bf4218dd9a714c5">SV_DemoWriteMessage</a>(&amp;msg);</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;}</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;</div><div class="line"><a name="l00776"></a><span class="lineno"><a class="line" href="sv__demo_8c.html#aecf518b2e15f81a605d80713408c161b">  776</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="sv__demo_8c.html#aecf518b2e15f81a605d80713408c161b">SV_DemoWriteFrame</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;{</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;    <a class="code" href="structmsg__t.html">msg_t</a> msg;</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;    <span class="comment">// STEP1: write all entities states at the end of the frame</span></div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;    <span class="comment">// Write entities (gentity_t-&gt;entityState_t or concretely sv.gentities[num].s, in gamecode level. instead of sv.)</span></div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;    <a class="code" href="sv__demo_8c.html#a3bcd6680e0d399f46b044dc7d23f6208">SV_DemoWriteAllEntityState</a>();</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;    <span class="comment">// Write entities (gentity_t-&gt;entityShared_t or concretely sv.gentities[num].r, in gamecode level. instead of sv.)</span></div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;    <a class="code" href="sv__demo_8c.html#aba182f107f0549b75f5a815795be0815">SV_DemoWriteAllEntityShared</a>();</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;    <span class="comment">// Write clients playerState (playerState_t)</span></div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;    <a class="code" href="sv__demo_8c.html#ab4edf5c3717b68024df01aabcf4e261c">SV_DemoWriteAllPlayerState</a>();</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;    <span class="comment">//-----------------------------------------------------</span></div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;    <span class="comment">// STEP2: write the endFrame marker and server time</span></div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;    <a class="code" href="msg_8c.html#a4bba3ea21116c996f3e630414895b183">MSG_Init</a>(&amp;msg, <a class="code" href="sv__demo_8c.html#a1756d9ddc463d7bca9539c8546a7c1b0">buf</a>, <span class="keyword">sizeof</span>(<a class="code" href="sv__demo_8c.html#a1756d9ddc463d7bca9539c8546a7c1b0">buf</a>));</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;    <span class="comment">// Write end of frame marker: this will commit every demo entity change (and it&#39;s done at the very end of every server frame to overwrite any change the gamecode/engine may have done)</span></div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;    <a class="code" href="msg_8c.html#aea0b2ab8f35e176632549e6b4f1bfc5b">MSG_WriteByte</a>(&amp;msg, <a class="code" href="sv__demo_8c.html#af2bc2d94afb470315c0786124a2fdc31a33f59650efb74b3a4305f11883698a02">demo_endFrame</a>);</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;    <span class="comment">// Write server time (will overwrite the server time every end of frame)</span></div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;    <a class="code" href="msg_8c.html#a68ffe035e640c51060ff51147112d015">MSG_WriteLong</a>(&amp;msg, <a class="code" href="server_8h.html#a698d5b1998898dad31ebfeb8983f8746">svs</a>.<a class="code" href="structserverStatic__t.html#a7f46475a8a4d8c8c140b9022d6476041">time</a>);</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;    <span class="comment">// Commit data to the demo file</span></div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;    <a class="code" href="sv__demo_8c.html#aca7339ca663e4f8f7bf4218dd9a714c5">SV_DemoWriteMessage</a>(&amp;msg);</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;}</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;<span class="comment">/***********************************************</span></div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;<span class="comment">* DEMO MANAGEMENT FUNCTIONS</span></div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;<span class="comment">* Functions to start/stop the recording/playback of a demo file</span></div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;<span class="comment">***********************************************/</span></div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;</div><div class="line"><a name="l00823"></a><span class="lineno"><a class="line" href="sv__demo_8c.html#addf956cd63c8c1f85f1272fc1f2fecba">  823</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="sv__demo_8c.html#addf956cd63c8c1f85f1272fc1f2fecba">SV_DemoAutoDemoRecord</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;{</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;    <a class="code" href="structqtime__s.html">qtime_t</a> now;</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;    <span class="keywordtype">char</span>    demoname[<a class="code" href="q__shared_8h.html#abd4ae30fcfdcbbff51bbf3f4e6daeee7">MAX_QPATH</a>];</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;    <a class="code" href="q__shared_8h.html#a331d56054b8d2cc3b4be5aaa79f9258c">Com_Memset</a>(demoname, 0, <a class="code" href="q__shared_8h.html#abd4ae30fcfdcbbff51bbf3f4e6daeee7">MAX_QPATH</a>);</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;    <span class="comment">// break if a demo is already being recorded</span></div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;    <span class="comment">// this should not happen, this is a failsafe but if it&#39;s used it means there are redundant calls that we can maybe remove</span></div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#a66e3cb8a5905f2e1e9d8c89fcc2b2dc9">demoState</a> == <a class="code" href="q__shared_8h.html#aeaa898bef6b376f572e5e59d943d78b2a56f619bf31320371483bd356ba300028">DS_RECORDING</a>)</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;    {</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;        <a class="code" href="cg__main_8c.html#ac5a47034a0c2a1c1eba5f1acd22987a2">Com_Printf</a>(<span class="stringliteral">&quot;SV_DemoAutoDemoRecord: already recording a demo!\n&quot;</span>);</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;    }</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;    <a class="code" href="common_8c.html#a0ab92ecafc08cdd812d6c273f39fc49e">Com_RealTime</a>(&amp;now);</div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;    <a class="code" href="q__shared_8c.html#a70a2b0d67ad6af400d513cf1136af8dc">Q_strncpyz</a>(demoname, <a class="code" href="dl__local_8h.html#a2f2251d7d64d4c9ec69520b953f68bb9">va</a>(<span class="stringliteral">&quot;%s_%04d-%02d-%02d-%02d-%02d-%02d_%s&quot;</span>,</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;                            <a class="code" href="sv__demo_8c.html#a51a1815a96e037da4d5107c9560aafd5">SV_CleanFilename</a>(<a class="code" href="dl__local_8h.html#a2f2251d7d64d4c9ec69520b953f68bb9">va</a>(<span class="stringliteral">&quot;%s&quot;</span>, <a class="code" href="server_8h.html#af99c33a2388290021601a4b4f192876e">sv_hostname</a>-&gt;<a class="code" href="structcvar__s.html#adb4a4f5cdd70988e14780b79a6e32e0a">string</a>)),</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;                            1900 + now.<a class="code" href="structqtime__s.html#aef644b9b87a78a1e9ce0837e96ac7b21">tm_year</a>,</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;                            1 + now.<a class="code" href="structqtime__s.html#ab8334f68a3eb928a8611902455880ca3">tm_mon</a>,</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;                            now.<a class="code" href="structqtime__s.html#a86d4d9b3464d9cba2fc41a80646857cc">tm_mday</a>,</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;                            now.<a class="code" href="structqtime__s.html#a05160c537b35b038e828cc3259f119df">tm_hour</a>,</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;                            now.<a class="code" href="structqtime__s.html#a53c431dc2e4ec3fe75e5709c39537d2e">tm_min</a>,</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;                            now.<a class="code" href="structqtime__s.html#abd9401c798760d8a96b760e8584a9f35">tm_sec</a>,</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;                            <a class="code" href="sv__demo_8c.html#a51a1815a96e037da4d5107c9560aafd5">SV_CleanFilename</a>(<a class="code" href="cvar_8c.html#a47803524e8f002b6540d91b8cccc7e0e">Cvar_VariableString</a>(<span class="stringliteral">&quot;mapname&quot;</span>))),</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;               <a class="code" href="q__shared_8h.html#abd4ae30fcfdcbbff51bbf3f4e6daeee7">MAX_QPATH</a>);</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;    <span class="comment">// print a message</span></div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;    <a class="code" href="cg__main_8c.html#ac5a47034a0c2a1c1eba5f1acd22987a2">Com_Printf</a>(<span class="stringliteral">&quot;DEMO: recording a server-side demo to: %s/svdemos/%s.%s%d\n&quot;</span>, strlen(<a class="code" href="cvar_8c.html#a47803524e8f002b6540d91b8cccc7e0e">Cvar_VariableString</a>(<span class="stringliteral">&quot;fs_game&quot;</span>)) ? <a class="code" href="cvar_8c.html#a47803524e8f002b6540d91b8cccc7e0e">Cvar_VariableString</a>(<span class="stringliteral">&quot;fs_game&quot;</span>) : <a class="code" href="qcommon_8h.html#a7be3e8ed0151b858862dac2259654d01">BASEGAME</a>, demoname, <a class="code" href="q__shared_8h.html#ace81fe40472a49aacabe17f75dc443ee">SVDEMOEXT</a>, <a class="code" href="qcommon_8h.html#a277f7abca2044f354abe265252cb9252">PROTOCOL_VERSION</a>);</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;    <span class="comment">// launch the demo recording</span></div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;    <a class="code" href="cmd_8c.html#a64f2928056fbc22633bf72cadc92e16a">Cbuf_AddText</a>(<a class="code" href="dl__local_8h.html#a2f2251d7d64d4c9ec69520b953f68bb9">va</a>(<span class="stringliteral">&quot;demo_record %s\n&quot;</span>, demoname));</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;}</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;</div><div class="line"><a name="l00860"></a><span class="lineno"><a class="line" href="sv__demo_8c.html#af40b5e1ed925afb7b86a9ad0c20bcbe2">  860</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="sv__demo_8c.html#af40b5e1ed925afb7b86a9ad0c20bcbe2">SV_DemoStopPlayback</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;{</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;    <span class="keywordtype">int</span> olddemostate = <a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#a66e3cb8a5905f2e1e9d8c89fcc2b2dc9">demoState</a>;</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;    <span class="comment">// Clear client configstrings</span></div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;    <span class="keywordflow">if</span> (olddemostate == <a class="code" href="q__shared_8h.html#aeaa898bef6b376f572e5e59d943d78b2a92cbb6b682e745d51527236bad2a6011">DS_PLAYBACK</a>)</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;    {</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;        <span class="keywordtype">int</span> i;</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;        <span class="comment">// unload democlients only if we were replaying a demo (if not it will produce an error!)</span></div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;        <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="server_8h.html#a8d79a0b5f456061ad33642f11f4b7d17">sv_democlients</a>-&gt;<a class="code" href="structcvar__s.html#ae873b26596ff98802364d80bbb71c72a">integer</a>; i++)</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;        {</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;            <a class="code" href="server_8h.html#aec9788a4410ed7f82b60651c4e23e383">SV_SetConfigstring</a>(<a class="code" href="group__lua__etvars.html#ga3c4270e8cb68ad1ff315b9ec7dbd2ef1">CS_PLAYERS</a> + i, <a class="code" href="q__shared_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;        }</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;    }</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;    <span class="comment">// Close demo file after playback</span></div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;    <a class="code" href="files_8c.html#a3c4ec3bde86c3cb7549952febebbbc9b">FS_FCloseFile</a>(<a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#af6dffe71c8e672577be691d5b32bd8d3">demoFile</a>);</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;    <a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#a66e3cb8a5905f2e1e9d8c89fcc2b2dc9">demoState</a> = <a class="code" href="q__shared_8h.html#aeaa898bef6b376f572e5e59d943d78b2a7c568dd37665684d045c4d40b0553a9c">DS_NONE</a>;</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;    <a class="code" href="cvar_8c.html#abbb41791f156730b8af8e3e0a7fac820">Cvar_SetValue</a>(<span class="stringliteral">&quot;sv_demoState&quot;</span>, <a class="code" href="q__shared_8h.html#aeaa898bef6b376f572e5e59d943d78b2a7c568dd37665684d045c4d40b0553a9c">DS_NONE</a>);</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;    <a class="code" href="cg__main_8c.html#ac5a47034a0c2a1c1eba5f1acd22987a2">Com_Printf</a>(<span class="stringliteral">&quot;DEMO: End of demo. Stopped playing demo %s.\n&quot;</span>, <a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#ae9a4f1d1b8296da77a74cf2da28a528c">demoName</a>);</div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;    <a class="code" href="sv__demo_8c.html#a88fbc53658b1f8c0833176451c609a67">SV_DemoCvarsRestore</a>();</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;    <span class="comment">// LAST RELOAD (to reinit all vars)</span></div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;    <span class="comment">// demo hasn&#39;t actually started yet</span></div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;    <span class="keywordflow">if</span> (olddemostate == <a class="code" href="q__shared_8h.html#aeaa898bef6b376f572e5e59d943d78b2a7c568dd37665684d045c4d40b0553a9c">DS_NONE</a> &amp;&amp; !<a class="code" href="sv__demo_8c.html#ae69d0c0b6524cde1bb78650a3627b9ad">keepSaved</a>)</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;    {</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;        <span class="comment">// If keepSaved is true, then this restart procedure is totally normal (and that&#39;s why we keep values saved), else it is not normal and probably an error happened</span></div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;<span class="preprocessor">#ifdef DEDICATED</span></div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;        <a class="code" href="cg__main_8c.html#ac5a47034a0c2a1c1eba5f1acd22987a2">Com_Printf</a>(<span class="stringliteral">&quot;DEMOERROR: An error happened while playing/recording the demo, please check the log for more info\n&quot;</span>); <span class="comment">// if server, don&#39;t crash it if an error happens, just print a message</span></div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;        <a class="code" href="cvar_8c.html#abbb41791f156730b8af8e3e0a7fac820">Cvar_SetValue</a>(<span class="stringliteral">&quot;sv_killserver&quot;</span>, 1); <span class="comment">// do we have to do this for our listen sever? - we do Com_Error after ...</span></div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;        <a class="code" href="cg__main_8c.html#ab77f32d4cdc361616b0daa01e5f709da">Com_Error</a>(<a class="code" href="q__shared_8h.html#aae573e3e6a2cbf05f3485f215403c9c2a1c6bf755d394a50c551150ea2135c551">ERR_DROP</a>, <span class="stringliteral">&quot;An error happened while replaying the demo, please check the log for more info.&quot;</span>);</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;    }</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (olddemostate == <a class="code" href="q__shared_8h.html#aeaa898bef6b376f572e5e59d943d78b2a92cbb6b682e745d51527236bad2a6011">DS_PLAYBACK</a>)</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;    {</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;        <span class="comment">// set a special state to say that we are waiting to stop (SV_DemoChangeMaxClients() will set to DS_NONE after moving the real clients to their correct slots)</span></div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;        <a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#a66e3cb8a5905f2e1e9d8c89fcc2b2dc9">demoState</a> = <a class="code" href="q__shared_8h.html#aeaa898bef6b376f572e5e59d943d78b2af75400ba282421573f07b01908d9f4a4">DS_WAITINGSTOP</a>;</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;        <a class="code" href="cvar_8c.html#abbb41791f156730b8af8e3e0a7fac820">Cvar_SetValue</a>(<span class="stringliteral">&quot;sv_demoState&quot;</span>, <a class="code" href="q__shared_8h.html#aeaa898bef6b376f572e5e59d943d78b2af75400ba282421573f07b01908d9f4a4">DS_WAITINGSTOP</a>);</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;<span class="preprocessor">#ifdef DEDICATED</span></div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;        <a class="code" href="cmd_8c.html#a64f2928056fbc22633bf72cadc92e16a">Cbuf_AddText</a>(<a class="code" href="dl__local_8h.html#a2f2251d7d64d4c9ec69520b953f68bb9">va</a>(<span class="stringliteral">&quot;map %s\n&quot;</span>, <a class="code" href="cvar_8c.html#a47803524e8f002b6540d91b8cccc7e0e">Cvar_VariableString</a>(<span class="stringliteral">&quot;mapname&quot;</span>)));   <span class="comment">// better to do a map command rather than map_restart if we do a mod switching with game_restart, map_restart will point to no map (because the config is completely unloaded)</span></div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;        <span class="comment">// Update sv_maxclients latched value (since we will kill the server because it&#39;s not a dedicated server, we won&#39;t restart the map, so latched values won&#39;t be affected unless we force the refresh)</span></div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;        <a class="code" href="cvar_8c.html#a961fe6ab129eda303da513bb4d0ece22">Cvar_Get</a>(<span class="stringliteral">&quot;sv_maxclients&quot;</span>, <span class="stringliteral">&quot;20&quot;</span>, 0);   <span class="comment">// FIXME: Restore sv_maxclients value (force latched values to commit)</span></div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;                                              <span class="comment">// set to 20 clients (ETL default value)</span></div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;        <a class="code" href="server_8h.html#a0bc03a0e709716a4965c0324f23b8977">sv_maxclients</a>-&gt;<a class="code" href="structcvar__s.html#a5f1df4d8bd348465e156d90ff061cf48">modified</a> = <a class="code" href="q__shared_8h.html#a110846a9664bbd925f955266e60e9136a0e538a5d43e68d2de4eb96c77855de40">qfalse</a>; <span class="comment">// Set modified to false // FIXME: this is more than ugly</span></div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;        <span class="comment">// Kill the local server</span></div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;        <a class="code" href="cvar_8c.html#abbb41791f156730b8af8e3e0a7fac820">Cvar_SetValue</a>(<span class="stringliteral">&quot;sv_killserver&quot;</span>, 1); <span class="comment">// instead of sending a Cbuf_AddText(&quot;killserver&quot;) command, we here just set a special cvar which will kill the server at the next SV_Frame() iteration (smoother than force killing)</span></div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;    }</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;}</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;</div><div class="line"><a name="l00918"></a><span class="lineno"><a class="line" href="sv__demo_8c.html#a13d0409732f14929c72828f0c9db0343">  918</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="sv__demo_8c.html#a13d0409732f14929c72828f0c9db0343">SV_DemoPlaybackError</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *message)</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;{</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;    <span class="comment">// FIXME: reset static vars?!</span></div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;    <a class="code" href="sv__demo_8c.html#af40b5e1ed925afb7b86a9ad0c20bcbe2">SV_DemoStopPlayback</a>();</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;    <a class="code" href="cg__main_8c.html#ab77f32d4cdc361616b0daa01e5f709da">Com_Error</a>(<a class="code" href="q__shared_8h.html#aae573e3e6a2cbf05f3485f215403c9c2a1c6bf755d394a50c551150ea2135c551">ERR_DROP</a>, <span class="stringliteral">&quot;SV_DemoPlaybackError: %s\n&quot;</span>, message);</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;}</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;</div><div class="line"><a name="l00930"></a><span class="lineno"><a class="line" href="sv__demo_8c.html#a6db2f44e47b43048736f323110f37995">  930</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="sv__demo_8c.html#a6db2f44e47b43048736f323110f37995">SV_DemoRestartPlayback</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;{</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;    <span class="keywordflow">if</span> (strlen(<a class="code" href="sv__demo_8c.html#a91118323f8771a34cc42f63aa7fe3cc9">savedPlaybackDemoname</a>))</div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;    {</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;        <span class="comment">// Set the demoState from DS_WAITINGPLAYBACK to DS_NONE (this avoids the engine to repeatedly restart the playback until it gets done, here we just launch it once) - this fix messages bug and accelerate the loading of the demo when switching mods</span></div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;        <a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#a66e3cb8a5905f2e1e9d8c89fcc2b2dc9">demoState</a> = <a class="code" href="q__shared_8h.html#aeaa898bef6b376f572e5e59d943d78b2a7c568dd37665684d045c4d40b0553a9c">DS_NONE</a>;</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;        <a class="code" href="cvar_8c.html#abbb41791f156730b8af8e3e0a7fac820">Cvar_SetValue</a>(<span class="stringliteral">&quot;sv_demoState&quot;</span>, <a class="code" href="q__shared_8h.html#aeaa898bef6b376f572e5e59d943d78b2a7c568dd37665684d045c4d40b0553a9c">DS_NONE</a>);</div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;        <span class="comment">// Restart the playback (reissue the demo_play command and the demo filename)</span></div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;        <a class="code" href="cmd_8c.html#a64f2928056fbc22633bf72cadc92e16a">Cbuf_AddText</a>(<a class="code" href="dl__local_8h.html#a2f2251d7d64d4c9ec69520b953f68bb9">va</a>(<span class="stringliteral">&quot;%s\n&quot;</span>, <a class="code" href="sv__demo_8c.html#a91118323f8771a34cc42f63aa7fe3cc9">savedPlaybackDemoname</a>));</div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;    }</div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;}</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;</div><div class="line"><a name="l00954"></a><span class="lineno"><a class="line" href="sv__demo_8c.html#afdffb6076d624c8106be5546856c442c">  954</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="sv__demo_8c.html#afdffb6076d624c8106be5546856c442c">SV_DemoStartPlayback</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;{</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;    <a class="code" href="structmsg__t.html">msg_t</a> msg;</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;    <span class="keywordtype">int</span>   r, time = 400, i, clients = 0, fps = 0, gametype = 0, timelimit = 0, fraglimit = 0, capturelimit = 0;</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;    <span class="keywordtype">char</span>  map[<a class="code" href="q__shared_8h.html#abd4ae30fcfdcbbff51bbf3f4e6daeee7">MAX_QPATH</a>];</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;    <span class="keywordtype">char</span>  fs[<a class="code" href="q__shared_8h.html#abd4ae30fcfdcbbff51bbf3f4e6daeee7">MAX_QPATH</a>]; <span class="comment">// FIXME:  MAX_QPATH - only 64 chars ?!!!</span></div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;    <span class="keywordtype">char</span>  hostname[<a class="code" href="q__shared_8h.html#a0c397a708cec89c74029582574516b30">MAX_NAME_LENGTH</a>];</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;    <span class="keywordtype">char</span>  datetime[1024]; <span class="comment">// there&#39;s no limit in the whole engine specifically designed for dates and time...</span></div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;    <span class="keywordtype">char</span>  *metadata; <span class="comment">// used to store the current metadata index</span></div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;</div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;    <a class="code" href="q__shared_8h.html#a331d56054b8d2cc3b4be5aaa79f9258c">Com_Memset</a>(map, 0, <a class="code" href="q__shared_8h.html#abd4ae30fcfdcbbff51bbf3f4e6daeee7">MAX_QPATH</a>);</div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;    <a class="code" href="q__shared_8h.html#a331d56054b8d2cc3b4be5aaa79f9258c">Com_Memset</a>(fs, 0, <a class="code" href="q__shared_8h.html#abd4ae30fcfdcbbff51bbf3f4e6daeee7">MAX_QPATH</a>);</div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;    <a class="code" href="q__shared_8h.html#a331d56054b8d2cc3b4be5aaa79f9258c">Com_Memset</a>(hostname, 0, <a class="code" href="q__shared_8h.html#a0c397a708cec89c74029582574516b30">MAX_NAME_LENGTH</a>);</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;    <a class="code" href="q__shared_8h.html#a331d56054b8d2cc3b4be5aaa79f9258c">Com_Memset</a>(datetime, 0, 1024);</div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;</div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;    <span class="comment">// Initialize the demo message buffer</span></div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;    <a class="code" href="msg_8c.html#a4bba3ea21116c996f3e630414895b183">MSG_Init</a>(&amp;msg, <a class="code" href="sv__demo_8c.html#a1756d9ddc463d7bca9539c8546a7c1b0">buf</a>, <span class="keyword">sizeof</span>(<a class="code" href="sv__demo_8c.html#a1756d9ddc463d7bca9539c8546a7c1b0">buf</a>));</div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;    <span class="comment">// Get the demo header</span></div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;    r = <a class="code" href="files_8c.html#a4e635a7a368bbd1ef3dbd99140c69e39">FS_Read</a>(&amp;msg.<a class="code" href="structmsg__t.html#ad79ecd5d9636d0e96bedd3a8b1be24a8">cursize</a>, 4, <a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#af6dffe71c8e672577be691d5b32bd8d3">demoFile</a>);</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;    <span class="keywordflow">if</span> (r != 4)</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;    {</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;        <a class="code" href="sv__demo_8c.html#a13d0409732f14929c72828f0c9db0343">SV_DemoPlaybackError</a>(<span class="stringliteral">&quot;DEMOERROR: SV_DemoReadFrame: demo is corrupted (not initialized correctly!)&quot;</span>);</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;    }</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;    msg.<a class="code" href="structmsg__t.html#ad79ecd5d9636d0e96bedd3a8b1be24a8">cursize</a> = LittleLong(msg.<a class="code" href="structmsg__t.html#ad79ecd5d9636d0e96bedd3a8b1be24a8">cursize</a>);</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;    <span class="keywordflow">if</span> (msg.<a class="code" href="structmsg__t.html#ad79ecd5d9636d0e96bedd3a8b1be24a8">cursize</a> == -1)</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;    {</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;        <a class="code" href="sv__demo_8c.html#a13d0409732f14929c72828f0c9db0343">SV_DemoPlaybackError</a>(<span class="stringliteral">&quot;DEMOERROR: SV_DemoReadFrame: demo is corrupted (demo file is empty?)&quot;</span>);</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;    }</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;</div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;    <span class="keywordflow">if</span> (msg.<a class="code" href="structmsg__t.html#ad79ecd5d9636d0e96bedd3a8b1be24a8">cursize</a> &gt; msg.<a class="code" href="structmsg__t.html#a7b8927986fe254f74101628ef88df26c">maxsize</a>)</div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;    {</div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;        <a class="code" href="sv__demo_8c.html#a13d0409732f14929c72828f0c9db0343">SV_DemoPlaybackError</a>(<span class="stringliteral">&quot;DEMOERROR: SV_DemoReadFrame: demo message too long&quot;</span>);</div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;    }</div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;</div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;    r = <a class="code" href="files_8c.html#a4e635a7a368bbd1ef3dbd99140c69e39">FS_Read</a>(msg.<a class="code" href="structmsg__t.html#ab12d572562d7fb2fd9c3a450786e5c33">data</a>, msg.<a class="code" href="structmsg__t.html#ad79ecd5d9636d0e96bedd3a8b1be24a8">cursize</a>, <a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#af6dffe71c8e672577be691d5b32bd8d3">demoFile</a>);</div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;    <span class="keywordflow">if</span> (r != msg.<a class="code" href="structmsg__t.html#ad79ecd5d9636d0e96bedd3a8b1be24a8">cursize</a>)</div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;    {</div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;        <a class="code" href="sv__demo_8c.html#a13d0409732f14929c72828f0c9db0343">SV_DemoPlaybackError</a>(<span class="stringliteral">&quot;DEMOERROR: Demo file was truncated.\n&quot;</span>);</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;    }</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;    <span class="comment">// Reading meta-data (infos about the demo)</span></div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;    <span class="comment">// Note: we read with an if statement, so that if in the future we add more meta datas, older demos which haven&#39;t these meta datas will still be replayable</span></div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;    metadata = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;    <span class="keywordflow">while</span> (<a class="code" href="dl__local_8h.html#a74f39535654af88006aa56dca7615bc5">Q_stricmp</a>(metadata, <span class="stringliteral">&quot;endMeta&quot;</span>))</div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;    {</div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;        metadata = <a class="code" href="msg_8c.html#ac13659557314c0e7525eae249cb74aec">MSG_ReadString</a>(&amp;msg);   <span class="comment">// We read the meta data marker</span></div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;</div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="dl__local_8h.html#a74f39535654af88006aa56dca7615bc5">Q_stricmp</a>(metadata, <span class="stringliteral">&quot;endMeta&quot;</span>))     <span class="comment">// if the string is the special endMeta string, we already break</span></div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;        {</div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;        }</div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="dl__local_8h.html#a74f39535654af88006aa56dca7615bc5">Q_stricmp</a>(metadata, <span class="stringliteral">&quot;clients&quot;</span>))</div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;        { <span class="comment">// democlients</span></div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;            <span class="comment">// Check slots, time and map</span></div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;            clients = <a class="code" href="msg_8c.html#adbb199f1fac9e30684b996143a907a5b">MSG_ReadByte</a>(&amp;msg); <span class="comment">// number of democlients (sv_maxclients at the time of the recording)</span></div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="server_8h.html#a0bc03a0e709716a4965c0324f23b8977">sv_maxclients</a>-&gt;<a class="code" href="structcvar__s.html#ae873b26596ff98802364d80bbb71c72a">integer</a> &lt; clients || <span class="comment">// if we have less real slots than democlients slots or</span></div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;                <a class="code" href="sv__demo_8c.html#a96ab40d64e830462b4c50916b4ee960a">savedMaxClients</a> &lt; 0 || <span class="comment">// if there&#39;s no savedMaxClients (so this means we didin&#39;t change sv_maxclients yet, and we always need to do so since we need to add sv_democlients)</span></div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;                <a class="code" href="server_8h.html#a0bc03a0e709716a4965c0324f23b8977">sv_maxclients</a>-&gt;<a class="code" href="structcvar__s.html#ae873b26596ff98802364d80bbb71c72a">integer</a> &lt;= <a class="code" href="sv__demo_8c.html#a96ab40d64e830462b4c50916b4ee960a">savedMaxClients</a>)</div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;            { <span class="comment">// or if maxclients is below or equal to the previous value of maxclients (normally it can only be equal, but if we switch the mod with game_restart, it can get the default value of 8, which can be below, so we need to check that as well)</span></div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;                <a class="code" href="cg__main_8c.html#ac5a47034a0c2a1c1eba5f1acd22987a2">Com_Printf</a>(<span class="stringliteral">&quot;DEMO: Not enough demo slots, automatically increasing sv_democlients to %d and sv_maxclients to %d.\n&quot;</span>, clients, <a class="code" href="server_8h.html#a0bc03a0e709716a4965c0324f23b8977">sv_maxclients</a>-&gt;<a class="code" href="structcvar__s.html#ae873b26596ff98802364d80bbb71c72a">integer</a> + clients);</div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;                <span class="comment">// save the old values of sv_maxclients, sv_democlients and bot_minplayers to later restore them</span></div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="sv__demo_8c.html#a96ab40d64e830462b4c50916b4ee960a">savedMaxClients</a> &lt; 0) <span class="comment">// save only if it&#39;s the first value, the subsequent ones may be default values of the engine</span></div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;                {</div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;                    <a class="code" href="sv__demo_8c.html#a96ab40d64e830462b4c50916b4ee960a">savedMaxClients</a> = <a class="code" href="server_8h.html#a0bc03a0e709716a4965c0324f23b8977">sv_maxclients</a>-&gt;<a class="code" href="structcvar__s.html#ae873b26596ff98802364d80bbb71c72a">integer</a>;</div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;                }</div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;</div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;                <span class="comment">// automatically adjusting sv_democlients, sv_maxclients and bot_minplayers</span></div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;                <a class="code" href="cvar_8c.html#abbb41791f156730b8af8e3e0a7fac820">Cvar_SetValue</a>(<span class="stringliteral">&quot;sv_democlients&quot;</span>, clients);</div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;                <a class="code" href="cvar_8c.html#a950a656c1889d681b4a28c82439031d1">Cvar_SetLatched</a>(<span class="stringliteral">&quot;sv_maxclients&quot;</span>, <a class="code" href="dl__local_8h.html#a2f2251d7d64d4c9ec69520b953f68bb9">va</a>(<span class="stringliteral">&quot;%i&quot;</span>, <a class="code" href="server_8h.html#a0bc03a0e709716a4965c0324f23b8977">sv_maxclients</a>-&gt;<a class="code" href="structcvar__s.html#ae873b26596ff98802364d80bbb71c72a">integer</a> + clients));</div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;                <span class="comment">// BUGGY makes a dedicated server crash</span></div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;                <span class="comment">//Cvar_Get( &quot;sv_maxclients&quot;, &quot;8&quot;, 0 );</span></div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;                <span class="comment">//sv_maxclients-&gt;modified = qfalse;</span></div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;            }</div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;        }</div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="dl__local_8h.html#a74f39535654af88006aa56dca7615bc5">Q_stricmp</a>(metadata, <span class="stringliteral">&quot;time&quot;</span>))</div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;        { <span class="comment">// server time</span></div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;            <span class="comment">// reading server time (from the demo)</span></div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;            time = <a class="code" href="msg_8c.html#ad7efeddd101bfd4d073ed261c67ddd1f">MSG_ReadLong</a>(&amp;msg);</div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;            <span class="keywordflow">if</span> (time &lt; 400)</div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;            {</div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;                <a class="code" href="sv__demo_8c.html#a13d0409732f14929c72828f0c9db0343">SV_DemoPlaybackError</a>(<a class="code" href="dl__local_8h.html#a2f2251d7d64d4c9ec69520b953f68bb9">va</a>(<span class="stringliteral">&quot;DEMOERROR: Demo time too small: %d.\n&quot;</span>, time));</div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;            }</div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;        }</div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="dl__local_8h.html#a74f39535654af88006aa56dca7615bc5">Q_stricmp</a>(metadata, <span class="stringliteral">&quot;sv_fps&quot;</span>))</div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;        {</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;            <span class="comment">// reading sv_fps (from the demo)</span></div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;            fps = <a class="code" href="msg_8c.html#ad7efeddd101bfd4d073ed261c67ddd1f">MSG_ReadLong</a>(&amp;msg);</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="g__local_8h.html#ae6326184cffc99fdda345480ffa7dc26">sv_fps</a>-&gt;<a class="code" href="structvmCvar__t.html#a692c1a403e65c64a1f9309bca9f47007">integer</a> != fps)</div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;            {</div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;                <a class="code" href="sv__demo_8c.html#a2aef5c150509941d274951dd9ad0065f">savedFPS</a> = <a class="code" href="g__local_8h.html#ae6326184cffc99fdda345480ffa7dc26">sv_fps</a>-&gt;<a class="code" href="structvmCvar__t.html#a692c1a403e65c64a1f9309bca9f47007">integer</a>;</div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;                <a class="code" href="cvar_8c.html#abbb41791f156730b8af8e3e0a7fac820">Cvar_SetValue</a>(<span class="stringliteral">&quot;sv_fps&quot;</span>, fps);</div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;            }</div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;        }</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="dl__local_8h.html#a74f39535654af88006aa56dca7615bc5">Q_stricmp</a>(metadata, <span class="stringliteral">&quot;g_gametype&quot;</span>))</div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;        {</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;            <span class="comment">// reading g_gametype (from the demo)</span></div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;            gametype = <a class="code" href="msg_8c.html#ad7efeddd101bfd4d073ed261c67ddd1f">MSG_ReadLong</a>(&amp;msg);</div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;            <span class="comment">// memorize the current gametype</span></div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;            <span class="keywordflow">if</span> (!<a class="code" href="sv__demo_8c.html#ae69d0c0b6524cde1bb78650a3627b9ad">keepSaved</a>)</div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;            {</div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;                <a class="code" href="sv__demo_8c.html#a6e1988af3068dd6e5579127c4580998f">savedGametype</a> = <a class="code" href="server_8h.html#acaeeafd96557862e708479efaac293ef">sv_gametype</a>-&gt;<a class="code" href="structcvar__s.html#ae873b26596ff98802364d80bbb71c72a">integer</a>; <span class="comment">// save the gametype before switching</span></div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;            }</div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;        }</div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="dl__local_8h.html#a74f39535654af88006aa56dca7615bc5">Q_stricmp</a>(metadata, <span class="stringliteral">&quot;fs_game&quot;</span>))</div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;        {</div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;            <span class="comment">// reading fs_game (mod name)</span></div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;            <a class="code" href="q__shared_8c.html#a70a2b0d67ad6af400d513cf1136af8dc">Q_strncpyz</a>(fs, <a class="code" href="msg_8c.html#ac13659557314c0e7525eae249cb74aec">MSG_ReadString</a>(&amp;msg), <a class="code" href="q__shared_8h.html#abd4ae30fcfdcbbff51bbf3f4e6daeee7">MAX_QPATH</a>);</div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;            <span class="keywordflow">if</span> (strlen(fs))</div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;            {</div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;                <a class="code" href="cg__main_8c.html#ac5a47034a0c2a1c1eba5f1acd22987a2">Com_Printf</a>(<span class="stringliteral">&quot;DEMO: Warning: this demo was recorded for the following mod: %s\n&quot;</span>, fs);</div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;            }</div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;        }</div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="dl__local_8h.html#a74f39535654af88006aa56dca7615bc5">Q_stricmp</a>(metadata, <span class="stringliteral">&quot;map&quot;</span>))</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;        {</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;            <span class="comment">// reading map (from the demo)</span></div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;            <a class="code" href="q__shared_8c.html#a70a2b0d67ad6af400d513cf1136af8dc">Q_strncpyz</a>(map, <a class="code" href="msg_8c.html#ac13659557314c0e7525eae249cb74aec">MSG_ReadString</a>(&amp;msg), <a class="code" href="q__shared_8h.html#abd4ae30fcfdcbbff51bbf3f4e6daeee7">MAX_QPATH</a>);</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;            <span class="keywordflow">if</span> (!<a class="code" href="files_8c.html#ae4fa3825c09365feb036e9712f554cab">FS_FOpenFileRead</a>(<a class="code" href="dl__local_8h.html#a2f2251d7d64d4c9ec69520b953f68bb9">va</a>(<span class="stringliteral">&quot;maps/%s.bsp&quot;</span>, map), <a class="code" href="q__shared_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="q__shared_8h.html#a110846a9664bbd925f955266e60e9136a0e538a5d43e68d2de4eb96c77855de40">qfalse</a>))</div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;            {</div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;                <a class="code" href="sv__demo_8c.html#a13d0409732f14929c72828f0c9db0343">SV_DemoPlaybackError</a>(<a class="code" href="dl__local_8h.html#a2f2251d7d64d4c9ec69520b953f68bb9">va</a>(<span class="stringliteral">&quot;Map does not exist: %s.\n&quot;</span>, map));</div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;            }</div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;        }</div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="dl__local_8h.html#a74f39535654af88006aa56dca7615bc5">Q_stricmp</a>(metadata, <span class="stringliteral">&quot;timelimit&quot;</span>))</div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;        {</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;            <span class="comment">// reading initial timelimit</span></div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;            timelimit = <a class="code" href="msg_8c.html#ad7efeddd101bfd4d073ed261c67ddd1f">MSG_ReadLong</a>(&amp;msg);</div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;            <span class="comment">// memorize the current timelimit</span></div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;            <span class="keywordflow">if</span> (!<a class="code" href="sv__demo_8c.html#ae69d0c0b6524cde1bb78650a3627b9ad">keepSaved</a>)</div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;            {</div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;                <a class="code" href="sv__demo_8c.html#a3f3666cfadf0a34792d803d256675d20">savedTimelimit</a> = <a class="code" href="cvar_8c.html#a37ba1e5addace2b2298bfbb2f5d52938">Cvar_VariableIntegerValue</a>(<span class="stringliteral">&quot;timelimit&quot;</span>);</div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;            }</div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;</div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;            <span class="comment">// set the demo setting</span></div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;            <a class="code" href="cvar_8c.html#abbb41791f156730b8af8e3e0a7fac820">Cvar_SetValue</a>(<span class="stringliteral">&quot;timelimit&quot;</span>, timelimit); <span class="comment">// Note: setting the timelimit is NOT necessary for the demo to be replayed (in fact even if the timelimit is reached, the demo will still continue to feed new frames and thus force the game to continue, without any bug - also to the opposite, if the timelimit is too high, the game will be finished when the demo will replay the events, even if the timelimit is not reached but was in the demo, it will be when replaying the demo), but setting it allows for timelimit warning and suddenDeath voice announcement to happen. FIXME: if the timelimit is changed during the game, it won&#39;t be reflected in the demo (but the demo will still continue to play, or stop if the game is won).</span></div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;        }</div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="dl__local_8h.html#a74f39535654af88006aa56dca7615bc5">Q_stricmp</a>(metadata, <span class="stringliteral">&quot;fraglimit&quot;</span>))</div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;        {</div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;            <span class="comment">// reading initial fraglimit</span></div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;            fraglimit = <a class="code" href="msg_8c.html#ad7efeddd101bfd4d073ed261c67ddd1f">MSG_ReadLong</a>(&amp;msg);</div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;            <span class="comment">// memorize the current fraglimit</span></div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;            <span class="keywordflow">if</span> (!<a class="code" href="sv__demo_8c.html#ae69d0c0b6524cde1bb78650a3627b9ad">keepSaved</a>)</div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;            {</div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;                <a class="code" href="sv__demo_8c.html#a85e89000c3c7d3a6a54bda8b7f157c5e">savedFraglimit</a> = <a class="code" href="cvar_8c.html#a37ba1e5addace2b2298bfbb2f5d52938">Cvar_VariableIntegerValue</a>(<span class="stringliteral">&quot;fraglimit&quot;</span>);</div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;            }</div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;</div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;            <span class="comment">// set the demo setting</span></div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;            <a class="code" href="cvar_8c.html#abbb41791f156730b8af8e3e0a7fac820">Cvar_SetValue</a>(<span class="stringliteral">&quot;fraglimit&quot;</span>, fraglimit); <span class="comment">// Note: unnecessary for the demo to be replayed, but allows to show the limit in the HUD. FIXME: if the limit is changed during the game, the new value won&#39;t be reflected in the demo (but the demo will continue to play to its integrality)</span></div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;        }</div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="dl__local_8h.html#a74f39535654af88006aa56dca7615bc5">Q_stricmp</a>(metadata, <span class="stringliteral">&quot;capturelimit&quot;</span>))</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;        {</div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;            <span class="comment">// reading initial capturelimit</span></div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;            capturelimit = <a class="code" href="msg_8c.html#ad7efeddd101bfd4d073ed261c67ddd1f">MSG_ReadLong</a>(&amp;msg);</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;            <span class="comment">// memorize the current capturelimit</span></div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;            <span class="keywordflow">if</span> (!<a class="code" href="sv__demo_8c.html#ae69d0c0b6524cde1bb78650a3627b9ad">keepSaved</a>)</div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;            {</div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;                <a class="code" href="sv__demo_8c.html#a3be8030f70d69bd57596786aaf19b572">savedCapturelimit</a> = <a class="code" href="cvar_8c.html#a37ba1e5addace2b2298bfbb2f5d52938">Cvar_VariableIntegerValue</a>(<span class="stringliteral">&quot;capturelimit&quot;</span>);</div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;            }</div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;</div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;            <span class="comment">// set the demo setting</span></div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;            <a class="code" href="cvar_8c.html#abbb41791f156730b8af8e3e0a7fac820">Cvar_SetValue</a>(<span class="stringliteral">&quot;capturelimit&quot;</span>, capturelimit); <span class="comment">// Note: unnecessary for the demo to be replayed, but allows to show the limit in the HUD. FIXME: if the limit is changed during the game, the new value won&#39;t be reflected in the demo (but the demo will continue to play to its integrality)</span></div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;</div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;            <span class="comment">// Additional infos (not necessary to replay a demo)</span></div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;        }</div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="dl__local_8h.html#a74f39535654af88006aa56dca7615bc5">Q_stricmp</a>(metadata, <span class="stringliteral">&quot;hostname&quot;</span>))</div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;        {</div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;            <span class="comment">// reading sv_hostname (additional info)</span></div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;            <a class="code" href="q__shared_8c.html#a70a2b0d67ad6af400d513cf1136af8dc">Q_strncpyz</a>(hostname, <a class="code" href="msg_8c.html#ac13659557314c0e7525eae249cb74aec">MSG_ReadString</a>(&amp;msg), <a class="code" href="q__shared_8h.html#a0c397a708cec89c74029582574516b30">MAX_NAME_LENGTH</a>);</div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;</div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;        }</div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="dl__local_8h.html#a74f39535654af88006aa56dca7615bc5">Q_stricmp</a>(metadata, <span class="stringliteral">&quot;datetime&quot;</span>))</div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;        {</div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;            <span class="comment">// reading datetime</span></div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;            <a class="code" href="q__shared_8c.html#a70a2b0d67ad6af400d513cf1136af8dc">Q_strncpyz</a>(datetime, <a class="code" href="msg_8c.html#ac13659557314c0e7525eae249cb74aec">MSG_ReadString</a>(&amp;msg), 1024);</div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;        }</div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;    }</div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;</div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;    <span class="comment">//Com_Error(ERR_FATAL,&quot;DEBUG ERROR&quot;);</span></div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;</div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;    <span class="comment">// g_doWarmup</span></div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="sv__demo_8c.html#ae69d0c0b6524cde1bb78650a3627b9ad">keepSaved</a>)</div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;    { <span class="comment">// we memorize values only if it&#39;s the first time we launch the playback of this demo, else the values may have already been modified by the demo playback</span></div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;        <span class="comment">// Memorize g_doWarmup</span></div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;        <a class="code" href="sv__demo_8c.html#aa21691af03d57b54abf4a87f05afc9b6">savedDoWarmup</a> = <a class="code" href="cvar_8c.html#a37ba1e5addace2b2298bfbb2f5d52938">Cvar_VariableIntegerValue</a>(<span class="stringliteral">&quot;g_doWarmup&quot;</span>);</div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;    }</div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;    <span class="comment">// Remove g_doWarmup (bugfix: else it will produce a weird bug with all gametypes except CTF and Double Domination because of CheckTournament() in g_main.c which will make the demo stop after the warmup time)</span></div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;</div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;    <span class="comment">// FIXME: THIS IS HACKED TO 1 for now (should be 0 or we need to make our own etgame mod bin)</span></div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;    <a class="code" href="cvar_8c.html#abbb41791f156730b8af8e3e0a7fac820">Cvar_SetValue</a>(<span class="stringliteral">&quot;g_doWarmup&quot;</span>, 1);</div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;</div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;    <span class="comment">// g_allowVote</span></div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="sv__demo_8c.html#ae69d0c0b6524cde1bb78650a3627b9ad">keepSaved</a>)</div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;    {</div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;        <span class="comment">// same for g_allowVote</span></div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;        <span class="comment">// Memorize g_allowVote</span></div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;        <a class="code" href="sv__demo_8c.html#af3e78672f89264c08f7d2dc2a8b43bac">savedAllowVote</a> = <a class="code" href="cvar_8c.html#a37ba1e5addace2b2298bfbb2f5d52938">Cvar_VariableIntegerValue</a>(<span class="stringliteral">&quot;g_allowVote&quot;</span>);</div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;    }</div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;    <span class="comment">// Remove g_allowVote (prevent players to call a vote while a map is replaying)</span></div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;    <a class="code" href="cvar_8c.html#abbb41791f156730b8af8e3e0a7fac820">Cvar_SetValue</a>(<span class="stringliteral">&quot;g_allowVote&quot;</span>, 0);</div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;</div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;    <span class="comment">// Printing infos about the demo</span></div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="server_8h.html#af1f59a32ccea93eed6522ef2a4140bc7">sv_demoTolerant</a>-&gt;<a class="code" href="structcvar__s.html#ae873b26596ff98802364d80bbb71c72a">integer</a>)   <span class="comment">// print the meta datas only if we&#39;re not in faults tolerance mode (because if there are missing meta datas, the printing will throw an exception! So we&#39;d better avoid it)</span></div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;    {</div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;        <a class="code" href="cg__main_8c.html#ac5a47034a0c2a1c1eba5f1acd22987a2">Com_Printf</a>(<span class="stringliteral">&quot;DEMO: Details of %s recorded %s on server \&quot;%s\&quot;: sv_fps: %i initial_servertime: %i clients: %i fs_game: %s g_gametype: %i map: %s timelimit: %i fraglimit: %i capturelimit: %i \n&quot;</span>, <a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#ae9a4f1d1b8296da77a74cf2da28a528c">demoName</a>, datetime, hostname, fps, time, clients, fs, gametype, map, timelimit, fraglimit, capturelimit);</div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;    }</div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;</div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;    <span class="comment">// Checking if all initial conditions from the demo are met (map, sv_fps, gametype, servertime, etc...)</span></div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;    <span class="comment">// FIXME? why sv_cheats is needed? Just to be able to use cheats commands to pass through walls?</span></div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="common_8c.html#a0dc3b8737b9c0dd5fc582a4c03c60332">com_sv_running</a>-&gt;<a class="code" href="structcvar__s.html#ae873b26596ff98802364d80bbb71c72a">integer</a> || <a class="code" href="dl__local_8h.html#a74f39535654af88006aa56dca7615bc5">Q_stricmp</a>(<a class="code" href="server_8h.html#a01eb98a830e2ac701458611d582296db">sv_mapname</a>-&gt;<a class="code" href="structcvar__s.html#adb4a4f5cdd70988e14780b79a6e32e0a">string</a>, map) ||</div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;        <a class="code" href="dl__local_8h.html#a74f39535654af88006aa56dca7615bc5">Q_stricmp</a>(<a class="code" href="cvar_8c.html#a47803524e8f002b6540d91b8cccc7e0e">Cvar_VariableString</a>(<span class="stringliteral">&quot;fs_game&quot;</span>), fs) ||</div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;        !<a class="code" href="cvar_8c.html#a37ba1e5addace2b2298bfbb2f5d52938">Cvar_VariableIntegerValue</a>(<span class="stringliteral">&quot;sv_cheats&quot;</span>) ||</div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;        (time &lt; <a class="code" href="server_8h.html#a698d5b1998898dad31ebfeb8983f8746">svs</a>.<a class="code" href="structserverStatic__t.html#a7f46475a8a4d8c8c140b9022d6476041">time</a> &amp;&amp; !<a class="code" href="sv__demo_8c.html#ae69d0c0b6524cde1bb78650a3627b9ad">keepSaved</a>) || <span class="comment">// if the demo initial time is below server time AND we didn&#39;t already restart for demo playback, then we must restart to reinit the server time (because else, it might happen that the server time is still above demo time if the demo was recorded during a warmup time, in this case we won&#39;t restart the demo playback but just iterate a few demo frames in the void to catch up the server time, see below the else statement)</span></div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;        <a class="code" href="server_8h.html#a0bc03a0e709716a4965c0324f23b8977">sv_maxclients</a>-&gt;<a class="code" href="structcvar__s.html#a5f1df4d8bd348465e156d90ff061cf48">modified</a> || <span class="comment">// FIXME: demo_play with sv_maxclients 64 doesn&#39;t start because of this and wants to set sv_mmaxclients 128?!</span></div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;        (<a class="code" href="server_8h.html#acaeeafd96557862e708479efaac293ef">sv_gametype</a>-&gt;<a class="code" href="structcvar__s.html#ae873b26596ff98802364d80bbb71c72a">integer</a> != gametype &amp;&amp; !(gametype == <a class="code" href="bg__public_8h.html#a8e2a64110eeed77727d53d171fd756c7abcecdd872c60907a514719cbcbaa9276">GT_SINGLE_PLAYER</a> &amp;&amp; <a class="code" href="server_8h.html#acaeeafd96557862e708479efaac293ef">sv_gametype</a>-&gt;<a class="code" href="structcvar__s.html#ae873b26596ff98802364d80bbb71c72a">integer</a> == <a class="code" href="bg__public_8h.html#a8e2a64110eeed77727d53d171fd756c7a0559b8be47dcc4828304030d8c62f5b9">GT_COOP</a>))  <span class="comment">// check for gametype change (need a restart to take effect since it&#39;s a latched var) AND check that the gametype difference is not between SinglePlayer and DM/FFA, which are in fact the same gametype (and the server will automatically change SinglePlayer to FFA, so we need to detect that and ignore this automatic change)</span></div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;        )</div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;    {</div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;</div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;        <span class="comment">//Cvar_SetValue(&quot;sv_democlients&quot;, 0); // necessary to stop the playback, else it will produce an error since the demo has not yet started!</span></div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;        <a class="code" href="sv__demo_8c.html#ae69d0c0b6524cde1bb78650a3627b9ad">keepSaved</a> = <a class="code" href="q__shared_8h.html#a110846a9664bbd925f955266e60e9136a9a60e3a3b7123e30c470bd5823cde09d">qtrue</a>; <span class="comment">// Declare that we want to keep the value saved (and we don&#39;t want to restore them now, because the demo hasn&#39;t started yet!)</span></div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;        <a class="code" href="sv__demo_8c.html#af40b5e1ed925afb7b86a9ad0c20bcbe2">SV_DemoStopPlayback</a>(); <span class="comment">// Stop the demo playback (reset back any change)</span></div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;        <a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#a66e3cb8a5905f2e1e9d8c89fcc2b2dc9">demoState</a> = <a class="code" href="q__shared_8h.html#aeaa898bef6b376f572e5e59d943d78b2a532cc227a9fbfa28f3a3f417f5fb1944">DS_WAITINGPLAYBACK</a>; <span class="comment">// Set the status WAITINGPLAYBACK meaning that as soon as the server will be restarted, the next SV_Frame() iteration must reactivate the demo playback</span></div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;        <a class="code" href="cvar_8c.html#abbb41791f156730b8af8e3e0a7fac820">Cvar_SetValue</a>(<span class="stringliteral">&quot;sv_demoState&quot;</span>, <a class="code" href="q__shared_8h.html#aeaa898bef6b376f572e5e59d943d78b2a532cc227a9fbfa28f3a3f417f5fb1944">DS_WAITINGPLAYBACK</a>); <span class="comment">// set the cvar too because when restarting the server, all sv.* vars will be destroyed</span></div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;        <a class="code" href="q__shared_8c.html#a70a2b0d67ad6af400d513cf1136af8dc">Q_strncpyz</a>(<a class="code" href="sv__demo_8c.html#a91118323f8771a34cc42f63aa7fe3cc9">savedPlaybackDemoname</a>, <a class="code" href="cmd_8c.html#ad637687ea893ee12b74615a6fc8ae0a9">Cmd_Cmd</a>(), <a class="code" href="q__shared_8h.html#abd4ae30fcfdcbbff51bbf3f4e6daeee7">MAX_QPATH</a>); <span class="comment">// we need to copy the value because since we may spawn a new server (if the demo is played client-side OR if we change fs_game), we will lose all sv. vars</span></div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;</div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;        <a class="code" href="cvar_8c.html#abbb41791f156730b8af8e3e0a7fac820">Cvar_SetValue</a>(<span class="stringliteral">&quot;sv_autoDemo&quot;</span>, 0); <span class="comment">// disable sv_autoDemo else it will start a recording before we can replay a demo (since we restart the map)</span></div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;        <span class="comment">// **** Automatic mod (fs_game) switching management ****</span></div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;        <span class="keywordflow">if</span> ((<a class="code" href="dl__local_8h.html#a74f39535654af88006aa56dca7615bc5">Q_stricmp</a>(<a class="code" href="cvar_8c.html#a47803524e8f002b6540d91b8cccc7e0e">Cvar_VariableString</a>(<span class="stringliteral">&quot;fs_game&quot;</span>), fs) &amp;&amp; strlen(fs)) ||</div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;            (!strlen(fs) &amp;&amp; <a class="code" href="dl__local_8h.html#a74f39535654af88006aa56dca7615bc5">Q_stricmp</a>(<a class="code" href="cvar_8c.html#a47803524e8f002b6540d91b8cccc7e0e">Cvar_VariableString</a>(<span class="stringliteral">&quot;fs_game&quot;</span>), fs) &amp;&amp; <a class="code" href="dl__local_8h.html#a74f39535654af88006aa56dca7615bc5">Q_stricmp</a>(fs, <a class="code" href="qcommon_8h.html#a7be3e8ed0151b858862dac2259654d01">BASEGAME</a>)))</div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;        { <span class="comment">// change the game mod only if necessary - if it&#39;s different from the current gamemod and the new is not empty, OR the new is empty but it&#39;s not BASEGAME and it&#39;s different (we&#39;re careful because it will restart the game engine and so probably every client will get disconnected)</span></div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;</div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;            <span class="comment">// Memorize the current mod (only if we are indeed switching mod, otherwise we will save basegame instead of empty strings and force a mod switching when stopping the demo when we haven&#39;t changed mod in the first place!)</span></div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;            <span class="keywordflow">if</span> (strlen(<a class="code" href="cvar_8c.html#a47803524e8f002b6540d91b8cccc7e0e">Cvar_VariableString</a>(<span class="stringliteral">&quot;fs_game&quot;</span>)))</div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;            {</div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;                <span class="comment">// if fs_game is not &quot;&quot;, we save it</span></div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;                <a class="code" href="q__shared_8c.html#a70a2b0d67ad6af400d513cf1136af8dc">Q_strncpyz</a>(<a class="code" href="sv__demo_8c.html#a97d4db4d6cb8217fdd4b8b641aebcea4">savedFsGame</a>, (<span class="keyword">const</span> <span class="keywordtype">char</span> *)<a class="code" href="cvar_8c.html#a47803524e8f002b6540d91b8cccc7e0e">Cvar_VariableString</a>(<span class="stringliteral">&quot;fs_game&quot;</span>), <a class="code" href="q__shared_8h.html#abd4ae30fcfdcbbff51bbf3f4e6daeee7">MAX_QPATH</a>);</div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;            }</div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;            {</div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;                <span class="comment">// else, it&#39;s equal to &quot;&quot;, and this means that we were playing in the basegame mod, but we need to have a non-empty string, else we can&#39;t use game_restart!</span></div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;                <a class="code" href="q__shared_8c.html#a70a2b0d67ad6af400d513cf1136af8dc">Q_strncpyz</a>(<a class="code" href="sv__demo_8c.html#a97d4db4d6cb8217fdd4b8b641aebcea4">savedFsGame</a>, <a class="code" href="qcommon_8h.html#a7be3e8ed0151b858862dac2259654d01">BASEGAME</a>, <a class="code" href="q__shared_8h.html#abd4ae30fcfdcbbff51bbf3f4e6daeee7">MAX_QPATH</a>);</div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;            }</div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;</div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;            <span class="comment">// Switch the mod</span></div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;            <a class="code" href="cg__main_8c.html#ac5a47034a0c2a1c1eba5f1acd22987a2">Com_Printf</a>(<span class="stringliteral">&quot;DEMO: Trying to switch automatically to the mod %s to replay the demo\n&quot;</span>, strlen(fs) ? fs : <a class="code" href="qcommon_8h.html#a7be3e8ed0151b858862dac2259654d01">BASEGAME</a>);</div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;            <a class="code" href="cvar_8c.html#abbb41791f156730b8af8e3e0a7fac820">Cvar_SetValue</a>(<span class="stringliteral">&quot;sv_democlients&quot;</span>, 0); <span class="comment">// set sv_democlients to 0 (because game_restart will reset sv_maxclients, so we have a risk to have a greater sv_democlients than sv_maxclients, and we don&#39;t want that)</span></div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;            <a class="code" href="cmd_8c.html#a64f2928056fbc22633bf72cadc92e16a">Cbuf_AddText</a>(<a class="code" href="dl__local_8h.html#a2f2251d7d64d4c9ec69520b953f68bb9">va</a>(<span class="stringliteral">&quot;game_restart %s\n&quot;</span>, fs)); <span class="comment">// switch mod!</span></div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;        }</div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;</div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;        <a class="code" href="cmd_8c.html#a64f2928056fbc22633bf72cadc92e16a">Cbuf_AddText</a>(<a class="code" href="dl__local_8h.html#a2f2251d7d64d4c9ec69520b953f68bb9">va</a>(<span class="stringliteral">&quot;g_gametype %i\ndevmap %s\n&quot;</span>, gametype, map)); <span class="comment">// Change gametype and map (using devmap to enable cheats)</span></div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;</div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;    }</div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (time &lt; <a class="code" href="server_8h.html#a698d5b1998898dad31ebfeb8983f8746">svs</a>.<a class="code" href="structserverStatic__t.html#a7f46475a8a4d8c8c140b9022d6476041">time</a> &amp;&amp; <a class="code" href="sv__demo_8c.html#ae69d0c0b6524cde1bb78650a3627b9ad">keepSaved</a>)</div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;    {</div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;        <span class="comment">// else if the demo time is still below the server time but we already restarted for the demo playback, we just iterate a few demo frames in the void to catch to until we are above the server time. Note: having a server time below the demo time is CRITICAL, else we may send to the clients a server time that is below the previous, making the time going backward, which should NEVER happen!</span></div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;        <span class="keywordtype">int</span> timetoreach = <a class="code" href="server_8h.html#a698d5b1998898dad31ebfeb8983f8746">svs</a>.<a class="code" href="structserverStatic__t.html#a7f46475a8a4d8c8c140b9022d6476041">time</a>;</div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;</div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;        <a class="code" href="server_8h.html#a698d5b1998898dad31ebfeb8983f8746">svs</a>.<a class="code" href="structserverStatic__t.html#a7f46475a8a4d8c8c140b9022d6476041">time</a> = time;</div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;        <span class="keywordflow">while</span> (<a class="code" href="server_8h.html#a698d5b1998898dad31ebfeb8983f8746">svs</a>.<a class="code" href="structserverStatic__t.html#a7f46475a8a4d8c8c140b9022d6476041">time</a> &lt; timetoreach)</div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;        {</div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;            <a class="code" href="sv__demo_8c.html#ad9dc1a465b353d71a5dc0696f11ed892">SV_DemoReadFrame</a>(); <span class="comment">// run a few frames to settle things out</span></div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;        }</div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;    }</div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;</div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;    <span class="comment">// Initialize our stuff</span></div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;    <a class="code" href="q__shared_8h.html#a331d56054b8d2cc3b4be5aaa79f9258c">Com_Memset</a>(<a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#a75f2b31ea80a25242aa46b8dd3d70d1b">demoEntities</a>, 0, <span class="keyword">sizeof</span>(<a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#a75f2b31ea80a25242aa46b8dd3d70d1b">demoEntities</a>));</div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;    <a class="code" href="q__shared_8h.html#a331d56054b8d2cc3b4be5aaa79f9258c">Com_Memset</a>(<a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#a4132ec967ed2e26499e7c93b84e70915">demoPlayerStates</a>, 0, <span class="keyword">sizeof</span>(<a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#a4132ec967ed2e26499e7c93b84e70915">demoPlayerStates</a>));</div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;    <a class="code" href="cvar_8c.html#abbb41791f156730b8af8e3e0a7fac820">Cvar_SetValue</a>(<span class="stringliteral">&quot;sv_democlients&quot;</span>, clients); <span class="comment">// Note: we need SV_Startup() to NOT use SV_ChangeMaxClients for this to work without crashing when changing fs_game</span></div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;</div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;    <span class="comment">// FIXME: omnibot - this bot stuff isn&#39;t tested well (but better than before)</span></div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;    <span class="comment">// disable bots and ensure they don&#39;t connect again </span></div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="cvar_8c.html#a961fe6ab129eda303da513bb4d0ece22">Cvar_Get</a>(<span class="stringliteral">&quot;omnibot_enable&quot;</span>, <span class="stringliteral">&quot;0&quot;</span>, 0)-&gt;integer &gt; 0) <span class="comment">// FIXME: and/or check for bot player count, omnibot_enable is latched !!!</span></div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;    {</div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;</div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;        <a class="code" href="cmd_8c.html#accbf67887d2d8e59ced2e4cca30dc7d0">Cbuf_ExecuteText</a>(<a class="code" href="q__shared_8h.html#af0a604c3447aef4c7fbe9a7a3dcafd6bab6b643787d3f344cdb6c2e9e7699ada6">EXEC_NOW</a>, <span class="stringliteral">&quot;bot maxbots 0; bot kickall\n&quot;</span>);</div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;        <a class="code" href="cvar_8c.html#abbb41791f156730b8af8e3e0a7fac820">Cvar_SetValue</a>(<span class="stringliteral">&quot;omnibot_enable&quot;</span>, 0); <span class="comment">// FIXME: restore value and bot players after demo play</span></div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;</div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;        <a class="code" href="cg__main_8c.html#ac5a47034a0c2a1c1eba5f1acd22987a2">Com_Printf</a>(<span class="stringliteral">&quot;Bye bye omnibots - you are not allowed to view this demo.\n&quot;</span>);</div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;    }</div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;</div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;    <span class="comment">// Force all real clients already connected before the demo begins to be set to spectator team</span></div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;    <span class="keywordflow">for</span> (i = <a class="code" href="server_8h.html#a8d79a0b5f456061ad33642f11f4b7d17">sv_democlients</a>-&gt;<a class="code" href="structcvar__s.html#ae873b26596ff98802364d80bbb71c72a">integer</a>; i &lt; sv_maxclients-&gt;integer; i++)</div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;    {</div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="server_8h.html#a698d5b1998898dad31ebfeb8983f8746">svs</a>.<a class="code" href="structserverStatic__t.html#a7cafb183964315009682fc02b30613d9">clients</a>[i].<a class="code" href="structclient__s.html#aea178e2c587a3c7eacdeaa92488a5f0d">state</a> &gt;= <a class="code" href="server_8h.html#a89d33b2529a2789787b365237a7319d4a3865e2578ba0d5b1078e326f0bf6d101">CS_CONNECTED</a>)</div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;        {</div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;            <span class="comment">// Only set as spectator a player that is at least connected (or primed or active)</span></div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;            <a class="code" href="server_8h.html#a52b0f145e2eab712924fdbda3b486b1f">SV_ExecuteClientCommand</a>(&amp;<a class="code" href="server_8h.html#a698d5b1998898dad31ebfeb8983f8746">svs</a>.<a class="code" href="structserverStatic__t.html#a7cafb183964315009682fc02b30613d9">clients</a>[i], <span class="stringliteral">&quot;team spectator&quot;</span>, <a class="code" href="q__shared_8h.html#a110846a9664bbd925f955266e60e9136a9a60e3a3b7123e30c470bd5823cde09d">qtrue</a>, <a class="code" href="q__shared_8h.html#a110846a9664bbd925f955266e60e9136a0e538a5d43e68d2de4eb96c77855de40">qfalse</a>); <span class="comment">// should be more interoperable than a forceteam</span></div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;            <a class="code" href="cmd_8c.html#accbf67887d2d8e59ced2e4cca30dc7d0">Cbuf_ExecuteText</a>(<a class="code" href="q__shared_8h.html#af0a604c3447aef4c7fbe9a7a3dcafd6bab6b643787d3f344cdb6c2e9e7699ada6">EXEC_NOW</a>, <a class="code" href="dl__local_8h.html#a2f2251d7d64d4c9ec69520b953f68bb9">va</a>(<span class="stringliteral">&quot;forceteam %i spectator&quot;</span>, i)); <span class="comment">// sometimes team spectator does not work when a demo is replayed client-side with some mods (eg: ExcessivePlus), in this case we also issue a forceteam (even if it&#39;s less interoperable)</span></div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;        }</div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;    }</div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;</div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;    <span class="comment">// Start reading the first frame</span></div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;    <a class="code" href="cg__main_8c.html#ac5a47034a0c2a1c1eba5f1acd22987a2">Com_Printf</a>(<span class="stringliteral">&quot;Playing demo %s.\n&quot;</span>, <a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#ae9a4f1d1b8296da77a74cf2da28a528c">demoName</a>); <span class="comment">// log that the demo is started here</span></div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;    <a class="code" href="server_8h.html#ade5a29e7abfb559177a66c7af35baf0f">SV_SendServerCommand</a>(<a class="code" href="q__shared_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="stringliteral">&quot;chat \&quot;^3Demo replay started!\&quot;&quot;</span>);   <span class="comment">// send a message to player</span></div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;    <a class="code" href="server_8h.html#ade5a29e7abfb559177a66c7af35baf0f">SV_SendServerCommand</a>(<a class="code" href="q__shared_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="stringliteral">&quot;cp \&quot;^3Demo replay started!\&quot;&quot;</span>);   <span class="comment">// send a centerprint message to player</span></div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;    <a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#a66e3cb8a5905f2e1e9d8c89fcc2b2dc9">demoState</a> = <a class="code" href="q__shared_8h.html#aeaa898bef6b376f572e5e59d943d78b2a92cbb6b682e745d51527236bad2a6011">DS_PLAYBACK</a>; <span class="comment">// set state to playback</span></div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;    <a class="code" href="cvar_8c.html#abbb41791f156730b8af8e3e0a7fac820">Cvar_SetValue</a>(<span class="stringliteral">&quot;sv_demoState&quot;</span>, <a class="code" href="q__shared_8h.html#aeaa898bef6b376f572e5e59d943d78b2a92cbb6b682e745d51527236bad2a6011">DS_PLAYBACK</a>);</div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;    <a class="code" href="sv__demo_8c.html#ae69d0c0b6524cde1bb78650a3627b9ad">keepSaved</a> = <a class="code" href="q__shared_8h.html#a110846a9664bbd925f955266e60e9136a0e538a5d43e68d2de4eb96c77855de40">qfalse</a>; <span class="comment">// Don&#39;t save values anymore: the next time we stop playback, we will restore previous values (because now we are really launching the playback, so anything that might happen now is either a big bug or the end of demo, in any case we want to restore the values)</span></div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;    <a class="code" href="sv__demo_8c.html#ad9dc1a465b353d71a5dc0696f11ed892">SV_DemoReadFrame</a>(); <span class="comment">// reading the first frame, which should contain some initialization events (eg: initial confistrings/userinfo when demo recording started, initial entities states and placement, etc..)</span></div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;</div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;}</div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;</div><div class="line"><a name="l01262"></a><span class="lineno"><a class="line" href="sv__demo_8c.html#a5cbe2abcce3bd42a5391d98791abb056"> 1262</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="sv__demo_8c.html#a5cbe2abcce3bd42a5391d98791abb056">SV_DemoStartRecord</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;{</div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;    <a class="code" href="structmsg__t.html">msg_t</a> msg;</div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;    <span class="keywordtype">int</span>   i;</div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;</div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;    <span class="comment">// Set democlients to 0 since it&#39;s only used for replaying demo</span></div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;    <a class="code" href="cvar_8c.html#abbb41791f156730b8af8e3e0a7fac820">Cvar_SetValue</a>(<span class="stringliteral">&quot;sv_democlients&quot;</span>, 0);</div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;</div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;    <a class="code" href="msg_8c.html#a4bba3ea21116c996f3e630414895b183">MSG_Init</a>(&amp;msg, <a class="code" href="sv__demo_8c.html#a1756d9ddc463d7bca9539c8546a7c1b0">buf</a>, <span class="keyword">sizeof</span>(<a class="code" href="sv__demo_8c.html#a1756d9ddc463d7bca9539c8546a7c1b0">buf</a>));</div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;</div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;    <span class="comment">// Write number of clients (sv_maxclients &lt; MAX_CLIENTS or else we can&#39;t playback)</span></div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;    <a class="code" href="msg_8c.html#ae9560f9b420c88d5da72ff14c004bac0">MSG_WriteString</a>(&amp;msg, <span class="stringliteral">&quot;clients&quot;</span>); <span class="comment">// for each demo meta data (infos about the demo), we prepend the name of the var (this allows for fault tolerance and retrocompatibility) - FIXME? We could also use MSG_LookaheadByte() to read a byte, instead of a string, this would save a tiny bit of storage space</span></div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;    <a class="code" href="msg_8c.html#aea0b2ab8f35e176632549e6b4f1bfc5b">MSG_WriteByte</a>(&amp;msg, <a class="code" href="server_8h.html#a0bc03a0e709716a4965c0324f23b8977">sv_maxclients</a>-&gt;<a class="code" href="structcvar__s.html#ae873b26596ff98802364d80bbb71c72a">integer</a>);</div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;    <span class="comment">// Write current server in-game time</span></div><div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;    <a class="code" href="msg_8c.html#ae9560f9b420c88d5da72ff14c004bac0">MSG_WriteString</a>(&amp;msg, <span class="stringliteral">&quot;time&quot;</span>);</div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;    <a class="code" href="msg_8c.html#a68ffe035e640c51060ff51147112d015">MSG_WriteLong</a>(&amp;msg, <a class="code" href="server_8h.html#a698d5b1998898dad31ebfeb8983f8746">svs</a>.<a class="code" href="structserverStatic__t.html#a7f46475a8a4d8c8c140b9022d6476041">time</a>);</div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;    <span class="comment">// Write sv_fps</span></div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;    <a class="code" href="msg_8c.html#ae9560f9b420c88d5da72ff14c004bac0">MSG_WriteString</a>(&amp;msg, <span class="stringliteral">&quot;sv_fps&quot;</span>);</div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;    <a class="code" href="msg_8c.html#a68ffe035e640c51060ff51147112d015">MSG_WriteLong</a>(&amp;msg, <a class="code" href="g__local_8h.html#ae6326184cffc99fdda345480ffa7dc26">sv_fps</a>-&gt;<a class="code" href="structvmCvar__t.html#a692c1a403e65c64a1f9309bca9f47007">integer</a>);</div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;    <span class="comment">// Write g_gametype</span></div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;    <a class="code" href="msg_8c.html#ae9560f9b420c88d5da72ff14c004bac0">MSG_WriteString</a>(&amp;msg, <span class="stringliteral">&quot;g_gametype&quot;</span>);</div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;    <a class="code" href="msg_8c.html#a68ffe035e640c51060ff51147112d015">MSG_WriteLong</a>(&amp;msg, <a class="code" href="server_8h.html#acaeeafd96557862e708479efaac293ef">sv_gametype</a>-&gt;<a class="code" href="structcvar__s.html#ae873b26596ff98802364d80bbb71c72a">integer</a>);</div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;    <span class="comment">// Write fs_game (mod name)</span></div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;    <a class="code" href="msg_8c.html#ae9560f9b420c88d5da72ff14c004bac0">MSG_WriteString</a>(&amp;msg, <span class="stringliteral">&quot;fs_game&quot;</span>);</div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;    <a class="code" href="msg_8c.html#ae9560f9b420c88d5da72ff14c004bac0">MSG_WriteString</a>(&amp;msg, <a class="code" href="cvar_8c.html#a47803524e8f002b6540d91b8cccc7e0e">Cvar_VariableString</a>(<span class="stringliteral">&quot;fs_game&quot;</span>));</div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;    <span class="comment">// Write map name</span></div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;    <a class="code" href="msg_8c.html#ae9560f9b420c88d5da72ff14c004bac0">MSG_WriteString</a>(&amp;msg, <span class="stringliteral">&quot;map&quot;</span>);</div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;    <a class="code" href="msg_8c.html#ae9560f9b420c88d5da72ff14c004bac0">MSG_WriteString</a>(&amp;msg, <a class="code" href="server_8h.html#a01eb98a830e2ac701458611d582296db">sv_mapname</a>-&gt;<a class="code" href="structcvar__s.html#adb4a4f5cdd70988e14780b79a6e32e0a">string</a>);</div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;    <span class="comment">// Write timelimit</span></div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;    <a class="code" href="msg_8c.html#ae9560f9b420c88d5da72ff14c004bac0">MSG_WriteString</a>(&amp;msg, <span class="stringliteral">&quot;timelimit&quot;</span>);</div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;    <a class="code" href="msg_8c.html#a68ffe035e640c51060ff51147112d015">MSG_WriteLong</a>(&amp;msg, <a class="code" href="cvar_8c.html#a37ba1e5addace2b2298bfbb2f5d52938">Cvar_VariableIntegerValue</a>(<span class="stringliteral">&quot;timelimit&quot;</span>));</div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;    <span class="comment">// Write sv_hostname (only for info)</span></div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;    <a class="code" href="msg_8c.html#ae9560f9b420c88d5da72ff14c004bac0">MSG_WriteString</a>(&amp;msg, <span class="stringliteral">&quot;hostname&quot;</span>);</div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;    <a class="code" href="msg_8c.html#ae9560f9b420c88d5da72ff14c004bac0">MSG_WriteString</a>(&amp;msg, <a class="code" href="server_8h.html#af99c33a2388290021601a4b4f192876e">sv_hostname</a>-&gt;<a class="code" href="structcvar__s.html#adb4a4f5cdd70988e14780b79a6e32e0a">string</a>);</div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;    <span class="comment">// Write current datetime (only for info)</span></div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;    <a class="code" href="msg_8c.html#ae9560f9b420c88d5da72ff14c004bac0">MSG_WriteString</a>(&amp;msg, <span class="stringliteral">&quot;datetime&quot;</span>);</div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;    <a class="code" href="msg_8c.html#ae9560f9b420c88d5da72ff14c004bac0">MSG_WriteString</a>(&amp;msg, <a class="code" href="sv__demo_8c.html#a5cdd1376828a792eeab1ac9e0f3fb945">SV_GenerateDateTime</a>());</div><div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;</div><div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;    <span class="comment">// Write end of meta datas (since we will read a string each loop, we need to set a special string to specify the reader that we end the loop, we cannot use a marker because it&#39;s a byte)</span></div><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;    <a class="code" href="msg_8c.html#ae9560f9b420c88d5da72ff14c004bac0">MSG_WriteString</a>(&amp;msg, <span class="stringliteral">&quot;endMeta&quot;</span>);</div><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;</div><div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;    <span class="comment">// Write all the above into the demo file</span></div><div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;    <a class="code" href="sv__demo_8c.html#aca7339ca663e4f8f7bf4218dd9a714c5">SV_DemoWriteMessage</a>(&amp;msg);</div><div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;</div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;    <span class="comment">// Write all configstrings (such as current capture score CS_SCORE1/2, etc...), including clients configstrings</span></div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;    <span class="comment">// Note: system configstrings will be filtered and excluded (there&#39;s a check function for that), and clients configstrings  will be automatically redirected to the specialized function (see the check function)</span></div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="q__shared_8h.html#a711f5c43166bc15a6a6adc8bacb0684a">MAX_CONFIGSTRINGS</a>; i++)</div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;    {</div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;        <span class="keywordflow">if</span> (&amp;<a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#ab3620e6e41fd6771b4994186079f6b43">configstrings</a>[i])     <span class="comment">// if the configstring pointer exists in memory (because we will check all the possible indexes, but we don&#39;t know if they really exist in memory and are used or not, so here we check for that)</span></div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;        {</div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;            <a class="code" href="sv__demo_8c.html#a8615b363043f307f54f6462a3fa072cb">SV_DemoWriteConfigString</a>(i, <a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#ab3620e6e41fd6771b4994186079f6b43">configstrings</a>[i]);</div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;        }</div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;    }</div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;</div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;    <span class="comment">// Write initial clients userinfo</span></div><div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="server_8h.html#a0bc03a0e709716a4965c0324f23b8977">sv_maxclients</a>-&gt;<a class="code" href="structcvar__s.html#ae873b26596ff98802364d80bbb71c72a">integer</a>; i++)</div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;    {</div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;        <a class="code" href="structclient__s.html">client_t</a> *client = &amp;<a class="code" href="server_8h.html#a698d5b1998898dad31ebfeb8983f8746">svs</a>.<a class="code" href="structserverStatic__t.html#a7cafb183964315009682fc02b30613d9">clients</a>[i];</div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;</div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;        <span class="keywordflow">if</span> (client-&gt;<a class="code" href="structclient__s.html#aea178e2c587a3c7eacdeaa92488a5f0d">state</a> &gt;= <a class="code" href="server_8h.html#a89d33b2529a2789787b365237a7319d4a3865e2578ba0d5b1078e326f0bf6d101">CS_CONNECTED</a>)</div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;        {</div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;            <span class="comment">// store client&#39;s userinfo (should be before clients configstrings since clients configstrings are derived from userinfo)</span></div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;            <span class="keywordflow">if</span> (client-&gt;<a class="code" href="structclient__s.html#a8a8cc9e2fab9730c092047434e73eff5">userinfo</a>[0] != <span class="charliteral">&#39;\0&#39;</span>)</div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;            {</div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;                <span class="comment">// if player is connected and the configstring exists, we store it</span></div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;                <a class="code" href="sv__demo_8c.html#ab15813f230fc9470cd6236c2f4c0cba2">SV_DemoWriteClientUserinfo</a>(client, (<span class="keyword">const</span> <span class="keywordtype">char</span> *)client-&gt;<a class="code" href="structclient__s.html#a8a8cc9e2fab9730c092047434e73eff5">userinfo</a>);</div><div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;            }</div><div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;        }</div><div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;    }</div><div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;</div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;    <span class="comment">// Write entities and players</span></div><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;    <a class="code" href="q__shared_8h.html#a331d56054b8d2cc3b4be5aaa79f9258c">Com_Memset</a>(<a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#a75f2b31ea80a25242aa46b8dd3d70d1b">demoEntities</a>, 0, <span class="keyword">sizeof</span>(<a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#a75f2b31ea80a25242aa46b8dd3d70d1b">demoEntities</a>));</div><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;    <a class="code" href="q__shared_8h.html#a331d56054b8d2cc3b4be5aaa79f9258c">Com_Memset</a>(<a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#a4132ec967ed2e26499e7c93b84e70915">demoPlayerStates</a>, 0, <span class="keyword">sizeof</span>(<a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#a4132ec967ed2e26499e7c93b84e70915">demoPlayerStates</a>));</div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;    <a class="code" href="sv__demo_8c.html#aecf518b2e15f81a605d80713408c161b">SV_DemoWriteFrame</a>();</div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;    <a class="code" href="cg__main_8c.html#ac5a47034a0c2a1c1eba5f1acd22987a2">Com_Printf</a>(<span class="stringliteral">&quot;Recording demo %s.\n&quot;</span>, <a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#ae9a4f1d1b8296da77a74cf2da28a528c">demoName</a>);</div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;    <a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#a66e3cb8a5905f2e1e9d8c89fcc2b2dc9">demoState</a> = <a class="code" href="q__shared_8h.html#aeaa898bef6b376f572e5e59d943d78b2a56f619bf31320371483bd356ba300028">DS_RECORDING</a>;</div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;    <a class="code" href="cvar_8c.html#abbb41791f156730b8af8e3e0a7fac820">Cvar_SetValue</a>(<span class="stringliteral">&quot;sv_demoState&quot;</span>, <a class="code" href="q__shared_8h.html#aeaa898bef6b376f572e5e59d943d78b2a56f619bf31320371483bd356ba300028">DS_RECORDING</a>);</div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;}</div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;</div><div class="line"><a name="l01345"></a><span class="lineno"><a class="line" href="sv__demo_8c.html#a71ccef0ee78f1fc40c726ca22d0fd6ba"> 1345</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="sv__demo_8c.html#a71ccef0ee78f1fc40c726ca22d0fd6ba">SV_DemoStopRecord</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;{</div><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;    <a class="code" href="structmsg__t.html">msg_t</a> msg;</div><div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;</div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;    <span class="comment">// End the demo</span></div><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;    <a class="code" href="msg_8c.html#a4bba3ea21116c996f3e630414895b183">MSG_Init</a>(&amp;msg, <a class="code" href="sv__demo_8c.html#a1756d9ddc463d7bca9539c8546a7c1b0">buf</a>, <span class="keyword">sizeof</span>(<a class="code" href="sv__demo_8c.html#a1756d9ddc463d7bca9539c8546a7c1b0">buf</a>));</div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;    <a class="code" href="msg_8c.html#aea0b2ab8f35e176632549e6b4f1bfc5b">MSG_WriteByte</a>(&amp;msg, <a class="code" href="sv__demo_8c.html#af2bc2d94afb470315c0786124a2fdc31a21695c29e33235a31893db6f62f314d1">demo_endDemo</a>);</div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;    <a class="code" href="sv__demo_8c.html#aca7339ca663e4f8f7bf4218dd9a714c5">SV_DemoWriteMessage</a>(&amp;msg); <span class="comment">// this also writes demo_EOF</span></div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;</div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;    <a class="code" href="files_8c.html#a3c4ec3bde86c3cb7549952febebbbc9b">FS_FCloseFile</a>(<a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#af6dffe71c8e672577be691d5b32bd8d3">demoFile</a>);</div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;    <a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#a66e3cb8a5905f2e1e9d8c89fcc2b2dc9">demoState</a> = <a class="code" href="q__shared_8h.html#aeaa898bef6b376f572e5e59d943d78b2a7c568dd37665684d045c4d40b0553a9c">DS_NONE</a>;</div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;    <a class="code" href="cvar_8c.html#abbb41791f156730b8af8e3e0a7fac820">Cvar_SetValue</a>(<span class="stringliteral">&quot;sv_demoState&quot;</span>, <a class="code" href="q__shared_8h.html#aeaa898bef6b376f572e5e59d943d78b2a7c568dd37665684d045c4d40b0553a9c">DS_NONE</a>);</div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;    <a class="code" href="cg__main_8c.html#ac5a47034a0c2a1c1eba5f1acd22987a2">Com_Printf</a>(<span class="stringliteral">&quot;Stopped recording demo %s.\n&quot;</span>, <a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#ae9a4f1d1b8296da77a74cf2da28a528c">demoName</a>);</div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;}</div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;</div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;<span class="comment">/***********************************************</span></div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;<span class="comment"> * DEMO READING FUNCTIONS</span></div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;<span class="comment"> * Functions to read demo events</span></div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;<span class="comment"> ***********************************************/</span></div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;</div><div class="line"><a name="l01374"></a><span class="lineno"><a class="line" href="sv__demo_8c.html#a857bf754749bfac22ce3930b8d719e31"> 1374</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="sv__demo_8c.html#a857bf754749bfac22ce3930b8d719e31">SV_DemoReadClientCommand</a>(<a class="code" href="structmsg__t.html">msg_t</a> *msg)</div><div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;{</div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;    <span class="keywordtype">char</span> *cmd;</div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;    <span class="keywordtype">int</span>  num;</div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;</div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;    num = <a class="code" href="msg_8c.html#adbb199f1fac9e30684b996143a907a5b">MSG_ReadByte</a>(msg);</div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;    cmd = <a class="code" href="msg_8c.html#ac13659557314c0e7525eae249cb74aec">MSG_ReadString</a>(msg);</div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;</div><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;    <a class="code" href="server_8h.html#a52b0f145e2eab712924fdbda3b486b1f">SV_ExecuteClientCommand</a>(&amp;<a class="code" href="server_8h.html#a698d5b1998898dad31ebfeb8983f8746">svs</a>.<a class="code" href="structserverStatic__t.html#a7cafb183964315009682fc02b30613d9">clients</a>[num], cmd, <a class="code" href="q__shared_8h.html#a110846a9664bbd925f955266e60e9136a9a60e3a3b7123e30c470bd5823cde09d">qtrue</a>, <a class="code" href="q__shared_8h.html#a110846a9664bbd925f955266e60e9136a0e538a5d43e68d2de4eb96c77855de40">qfalse</a>); <span class="comment">// 3rd arg = clientOK, and it&#39;s necessarily true since we saved the command in the demo (else it wouldn&#39;t be saved)</span></div><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;}</div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;</div><div class="line"><a name="l01392"></a><span class="lineno"><a class="line" href="sv__demo_8c.html#ae1276ebee179d6adbfacf85164ac6c56"> 1392</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="sv__demo_8c.html#ae1276ebee179d6adbfacf85164ac6c56">SV_DemoReadServerCommand</a>(<a class="code" href="structmsg__t.html">msg_t</a> *msg)</div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;{</div><div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;    <span class="keywordtype">char</span> *cmd;</div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;</div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;    cmd = <a class="code" href="msg_8c.html#ac13659557314c0e7525eae249cb74aec">MSG_ReadString</a>(msg);</div><div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;    <a class="code" href="server_8h.html#ade5a29e7abfb559177a66c7af35baf0f">SV_SendServerCommand</a>(<a class="code" href="q__shared_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="stringliteral">&quot;%s&quot;</span>, cmd);</div><div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;}</div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;</div><div class="line"><a name="l01410"></a><span class="lineno"><a class="line" href="sv__demo_8c.html#ab665b00f98fea8023457dd250deea1e0"> 1410</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="sv__demo_8c.html#ab665b00f98fea8023457dd250deea1e0">SV_DemoReadGameCommand</a>(<a class="code" href="structmsg__t.html">msg_t</a> *msg)</div><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;{</div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;    <span class="keywordtype">char</span> *cmd;</div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;</div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;    <a class="code" href="msg_8c.html#adbb199f1fac9e30684b996143a907a5b">MSG_ReadByte</a>(msg); <span class="comment">// clientNum, useless here so we don&#39;t save it, but we need to read it in order to move the msg cursor</span></div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;    cmd = <a class="code" href="msg_8c.html#ac13659557314c0e7525eae249cb74aec">MSG_ReadString</a>(msg);</div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;</div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="sv__demo_8c.html#a556c369cb3706595a0068e2de9e9d7db">SV_CheckLastCmd</a>(cmd, <a class="code" href="q__shared_8h.html#a110846a9664bbd925f955266e60e9136a0e538a5d43e68d2de4eb96c77855de40">qfalse</a>))</div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;    {</div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;        <span class="comment">// check for duplicates: check that the engine did not already send this very same message resulting from an event (this means that engine gamecommands are never filtered, only demo gamecommands)</span></div><div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;        <a class="code" href="server_8h.html#adc644fa8b6a89575ee9bff23cf07418d">SV_GameSendServerCommand</a>(-1, cmd);   <span class="comment">// send this game command to all clients (-1)</span></div><div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;    }</div><div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;}</div><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;</div><div class="line"><a name="l01428"></a><span class="lineno"><a class="line" href="sv__demo_8c.html#a723cda94f53cb8429c006815b6b256d8"> 1428</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="sv__demo_8c.html#a723cda94f53cb8429c006815b6b256d8">SV_DemoReadConfigString</a>(<a class="code" href="structmsg__t.html">msg_t</a> *msg)</div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;{</div><div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;    <span class="keywordtype">char</span> *configstring;</div><div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;    <span class="keywordtype">int</span>  num;</div><div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;</div><div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;    <span class="comment">//num = MSG_ReadLong(msg, MAX_CONFIGSTRINGS); FIXME: doesn&#39;t work, dunno why, but it would be better than a string to store a long int!</span></div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;    num          = atoi(<a class="code" href="msg_8c.html#ac13659557314c0e7525eae249cb74aec">MSG_ReadString</a>(msg));</div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;    configstring = <a class="code" href="msg_8c.html#ac13659557314c0e7525eae249cb74aec">MSG_ReadString</a>(msg);</div><div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;</div><div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;    <span class="keywordflow">if</span> (num &lt; CS_PLAYERS + sv_democlients-&gt;integer || num &gt;= <a class="code" href="group__lua__etvars.html#ga3c4270e8cb68ad1ff315b9ec7dbd2ef1">CS_PLAYERS</a> + <a class="code" href="server_8h.html#a0bc03a0e709716a4965c0324f23b8977">sv_maxclients</a>-&gt;<a class="code" href="structcvar__s.html#ae873b26596ff98802364d80bbb71c72a">integer</a>)</div><div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;    {</div><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;        <span class="comment">// we make sure to not overwrite real client configstrings (else when the demo starts, normal players will have no name, no model and no status!) - this cannot be done at recording time because we can&#39;t know how many sv_maxclients will be set at replaying time</span></div><div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;        <a class="code" href="server_8h.html#aec9788a4410ed7f82b60651c4e23e383">SV_SetConfigstring</a>(num, configstring);</div><div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;    }</div><div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;}</div><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;</div><div class="line"><a name="l01452"></a><span class="lineno"><a class="line" href="sv__demo_8c.html#a175c60213a858535c9f881e5e4186b66"> 1452</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="sv__demo_8c.html#a175c60213a858535c9f881e5e4186b66">SV_DemoReadClientConfigString</a>(<a class="code" href="structmsg__t.html">msg_t</a> *msg)</div><div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;{</div><div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;    <a class="code" href="structclient__s.html">client_t</a> *client;</div><div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;    <span class="keywordtype">char</span>     *configstring;</div><div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;    <span class="keywordtype">int</span>      num;</div><div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;</div><div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;    num          = <a class="code" href="msg_8c.html#adbb199f1fac9e30684b996143a907a5b">MSG_ReadByte</a>(msg);</div><div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;    configstring = <a class="code" href="msg_8c.html#ac13659557314c0e7525eae249cb74aec">MSG_ReadString</a>(msg);</div><div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;</div><div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;    <span class="comment">/**** DEMOCLIENTS CONNECTION MANAGEMENT  ****/</span></div><div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;    <span class="comment">// This part manages when a client should begin or be dropped based on the configstrings. This is a workaround because begin and disconnect events are managed in the gamecode, so we here use a clever way to know when these events happen (this is based on a careful reading of how work the mechanisms that manage players in a real game, so this should be OK in any case).</span></div><div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;    <span class="comment">// Note: this part could also be used in userinfo instead of client configstrings (but since DropClient automatically sets userinfo to null, which is not the case the other way around, this way was preferred)</span></div><div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="dl__local_8h.html#a74f39535654af88006aa56dca7615bc5">Q_stricmp</a>(<a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#ab3620e6e41fd6771b4994186079f6b43">configstrings</a>[<a class="code" href="group__lua__etvars.html#ga3c4270e8cb68ad1ff315b9ec7dbd2ef1">CS_PLAYERS</a> + num], configstring) &amp;&amp; configstring &amp;&amp; strlen(configstring))</div><div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;    {</div><div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;        <span class="comment">// client begin or just changed team: previous configstring and new one are different, and the new one is not null</span></div><div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;        <span class="keywordtype">int</span> svdoldteam;</div><div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;        <span class="keywordtype">int</span> svdnewteam;</div><div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;</div><div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;        client = &amp;<a class="code" href="server_8h.html#a698d5b1998898dad31ebfeb8983f8746">svs</a>.<a class="code" href="structserverStatic__t.html#a7cafb183964315009682fc02b30613d9">clients</a>[num];</div><div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;</div><div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;        svdoldteam = strlen(<a class="code" href="q__shared_8c.html#a8952048a805d58e583bfc6530f53ee82">Info_ValueForKey</a>(<a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#ab3620e6e41fd6771b4994186079f6b43">configstrings</a>[<a class="code" href="group__lua__etvars.html#ga3c4270e8cb68ad1ff315b9ec7dbd2ef1">CS_PLAYERS</a> + num], <span class="stringliteral">&quot;t&quot;</span>)) ? atoi(<a class="code" href="q__shared_8c.html#a8952048a805d58e583bfc6530f53ee82">Info_ValueForKey</a>(<a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#ab3620e6e41fd6771b4994186079f6b43">configstrings</a>[<a class="code" href="group__lua__etvars.html#ga3c4270e8cb68ad1ff315b9ec7dbd2ef1">CS_PLAYERS</a> + num], <span class="stringliteral">&quot;t&quot;</span>)) : -1; <span class="comment">// affect the new team if detected, else if an empty string is returned, just set -1 (will allow us to detect that there&#39;s really no team change instead of having 0 which is TEAM_FREE)</span></div><div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;        svdnewteam = strlen(<a class="code" href="q__shared_8c.html#a8952048a805d58e583bfc6530f53ee82">Info_ValueForKey</a>(configstring, <span class="stringliteral">&quot;t&quot;</span>)) ? atoi(<a class="code" href="q__shared_8c.html#a8952048a805d58e583bfc6530f53ee82">Info_ValueForKey</a>(configstring, <span class="stringliteral">&quot;t&quot;</span>)) : -1;</div><div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;</div><div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;        <span class="comment">// Set the client configstring (using a standard Q3 function)</span></div><div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;        <a class="code" href="server_8h.html#aec9788a4410ed7f82b60651c4e23e383">SV_SetConfigstring</a>(<a class="code" href="group__lua__etvars.html#ga3c4270e8cb68ad1ff315b9ec7dbd2ef1">CS_PLAYERS</a> + num, configstring);</div><div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;</div><div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;        <span class="comment">// Set some infos about this user:</span></div><div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;        <a class="code" href="server_8h.html#a698d5b1998898dad31ebfeb8983f8746">svs</a>.<a class="code" href="structserverStatic__t.html#a7cafb183964315009682fc02b30613d9">clients</a>[num].<a class="code" href="structclient__s.html#ae3d14ce39525b187f2ecc3fe3cf12b8b">demoClient</a> = <a class="code" href="q__shared_8h.html#a110846a9664bbd925f955266e60e9136a9a60e3a3b7123e30c470bd5823cde09d">qtrue</a>; <span class="comment">// to check if a client is a democlient, you can either rely on this variable, either you can check if it&#39;s a real client num (index of client) is &gt;= CS_PLAYERS + sv_democlients-&gt;integer &amp;&amp; &lt; CS_PLAYERS + sv_maxclients-&gt;integer (if it&#39;s not a configstring, remove CS_PLAYERS from your if)</span></div><div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;        <a class="code" href="q__shared_8c.html#a70a2b0d67ad6af400d513cf1136af8dc">Q_strncpyz</a>(<a class="code" href="server_8h.html#a698d5b1998898dad31ebfeb8983f8746">svs</a>.<a class="code" href="structserverStatic__t.html#a7cafb183964315009682fc02b30613d9">clients</a>[num].<a class="code" href="structclient__s.html#adb1abd6e53447ea4e644dd19e0dc5dee">name</a>, <a class="code" href="q__shared_8c.html#a8952048a805d58e583bfc6530f53ee82">Info_ValueForKey</a>(configstring, <span class="stringliteral">&quot;n&quot;</span>), <a class="code" href="q__shared_8h.html#a0c397a708cec89c74029582574516b30">MAX_NAME_LENGTH</a>);     <span class="comment">// set the name (useful for internal functions such as status_f). Anyway userinfo will automatically set both name (server-side) and netname (gamecode-side).</span></div><div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;</div><div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;</div><div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;        <span class="comment">// DEMOCLIENT INITIAL TEAM MANAGEMENT</span></div><div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;        <span class="comment">// Note: needed only to set the initial team of the democlients, subsequent team changes are directly handled by their clientCommands</span></div><div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;        <span class="comment">// DEPRECATED: moved to userinfo, more interoperable (because here team is an int, while in userinfo the full team name string is stored and can be directly replayed)</span></div><div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;        <span class="keywordflow">if</span> (!strlen(<a class="code" href="q__shared_8c.html#a8952048a805d58e583bfc6530f53ee82">Info_ValueForKey</a>(<a class="code" href="server_8h.html#a698d5b1998898dad31ebfeb8983f8746">svs</a>.<a class="code" href="structserverStatic__t.html#a7cafb183964315009682fc02b30613d9">clients</a>[num].<a class="code" href="structclient__s.html#a8a8cc9e2fab9730c092047434e73eff5">userinfo</a>, <span class="stringliteral">&quot;team&quot;</span>)))</div><div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;        {</div><div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;            <span class="keywordflow">if</span> (configstring &amp;&amp; strlen(configstring) &amp;&amp;</div><div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;                (svdoldteam == -1 || (svdoldteam != svdnewteam &amp;&amp; svdnewteam != -1))   <span class="comment">// if there was no team for this player before or if the new team is different</span></div><div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;                )</div><div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;            {</div><div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;                <span class="comment">// If the client changed team, we manually issue a team change (workaround by using a clientCommand team)</span></div><div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;</div><div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;<span class="comment">/* FIXME: find the reason of crash/no need to execute this now</span></div><div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;<span class="comment">                char *svdnewteamstr = Com_Allocate(10 * sizeof *svdnewteamstr);</span></div><div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;<span class="comment">                // random string, we just want the server to considerate the democlient in a team, whatever the team is. It will be automatically adjusted later with a clientCommand or userinfo string.</span></div><div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;<span class="comment">                switch (svdnewteam)</span></div><div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;<span class="comment">                {</span></div><div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;<span class="comment">                case TEAM_ALLIES:</span></div><div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;<span class="comment">                    strcpy(svdnewteamstr, &quot;allies&quot;);</span></div><div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;<span class="comment">                    break;</span></div><div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;<span class="comment">                case TEAM_AXIS:</span></div><div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;<span class="comment">                    strcpy(svdnewteamstr, &quot;axis&quot;);</span></div><div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;<span class="comment">                    break;</span></div><div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;<span class="comment">                case TEAM_SPECTATOR:</span></div><div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;<span class="comment">                    strcpy(svdnewteamstr, &quot;spectator&quot;);</span></div><div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;<span class="comment">                    break;</span></div><div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;<span class="comment">                case TEAM_FREE:</span></div><div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;<span class="comment">                default:</span></div><div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;<span class="comment">                    strcpy(svdnewteamstr, &quot;free&quot;);</span></div><div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;<span class="comment">                    break;</span></div><div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;<span class="comment">                }</span></div><div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;                <span class="comment">// FIXME: This causes a crash</span></div><div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;                <span class="comment">//SV_ExecuteClientCommand(&amp;svs.clients[num], va(&quot;team %s&quot;, svdnewteamstr), qtrue,qfalse); // workaround to force the server&#39;s gamecode and clients to update the team for this client - note: in fact, setting any team (except spectator) will make the engine set the client to a random team, but it&#39;s only sessionTeam! so the democlients will still be shown in the right team on the scoreboard, but the engine will consider them in a random team (this has no concrete adverse effect to the demo to my knowledge)</span></div><div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;            }</div><div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;        }</div><div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;</div><div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;        <span class="comment">// Set the remoteAddress of this client to localhost (this will set &quot;ip\localhost&quot; in the userinfo, which will in turn force the gamecode to set this client as a localClient, which avoids inactivity timers and some other stuffs to be triggered)</span></div><div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;        <span class="keywordflow">if</span> (strlen(configstring)) <span class="comment">// we check that the client isn&#39;t being dropped</span></div><div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;        {</div><div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;            <a class="code" href="net__chan_8c.html#aa6a665a1e1a3a0e2b922df6226e83bae">NET_StringToAdr</a>(<span class="stringliteral">&quot;localhost&quot;</span>, &amp;client-&gt;<a class="code" href="structclient__s.html#a6dac1acddd0a5749f1e66fe59e542ade">netchan</a>.<a class="code" href="structnetchan__t.html#accc89940b6f4bebbd1b70cfaa94ae0e9">remoteAddress</a>, <a class="code" href="qcommon_8h.html#a1654a012cc4b6196cf9e2da097b7b02aa9cf418f084ad1c666a25b35db62f9e55">NA_LOOPBACK</a>);</div><div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;        }</div><div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;</div><div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;        <span class="comment">// Make sure the gamecode consider the democlients (this will allow to show them on the scoreboard and make them spectatable with a standard follow) - does not use argv (directly fetch client infos from userinfo) so no need to tokenize with Cmd_TokenizeString()</span></div><div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;        <span class="comment">// Note: this also triggers the gamecode refreshing of the client&#39;s userinfo</span></div><div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;        <a class="code" href="qcommon_8h.html#a79d4501207fd0e4df1373143acaeac6e">VM_Call</a>(<a class="code" href="server_8h.html#a769d6e0a0fa0371353825fb0f1bac988">gvm</a>, <a class="code" href="g__public_8h.html#a73fae99264a6d9a1cf7e7aee493b27d5a1228e2de051fef0020329a96c592466a">GAME_CLIENT_BEGIN</a>, num);</div><div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;    }</div><div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="dl__local_8h.html#a74f39535654af88006aa56dca7615bc5">Q_stricmp</a>(<a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#ab3620e6e41fd6771b4994186079f6b43">configstrings</a>[<a class="code" href="group__lua__etvars.html#ga3c4270e8cb68ad1ff315b9ec7dbd2ef1">CS_PLAYERS</a> + num], configstring) &amp;&amp; strlen(<a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#ab3620e6e41fd6771b4994186079f6b43">configstrings</a>[<a class="code" href="group__lua__etvars.html#ga3c4270e8cb68ad1ff315b9ec7dbd2ef1">CS_PLAYERS</a> + num]) &amp;&amp; (!configstring || !strlen(configstring)))</div><div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;    {</div><div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;        <span class="comment">// client disconnect: different configstrings and the new one is empty, so the client is not there anymore, we drop him (also we check that the old config was not empty, else we would be disconnecting a player who is already dropped)</span></div><div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;        client = &amp;<a class="code" href="server_8h.html#a698d5b1998898dad31ebfeb8983f8746">svs</a>.<a class="code" href="structserverStatic__t.html#a7cafb183964315009682fc02b30613d9">clients</a>[num];</div><div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;        <a class="code" href="server_8h.html#ae8414b34853285827a1cfd61613f7b19">SV_DropClient</a>(client, <span class="stringliteral">&quot;disconnected&quot;</span>);   <span class="comment">// same as SV_Disconnect_f(client);</span></div><div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;        <a class="code" href="server_8h.html#aec9788a4410ed7f82b60651c4e23e383">SV_SetConfigstring</a>(<a class="code" href="group__lua__etvars.html#ga3c4270e8cb68ad1ff315b9ec7dbd2ef1">CS_PLAYERS</a> + num, configstring); <span class="comment">// empty the configstring</span></div><div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;    }</div><div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;    { <span class="comment">// In any other case (should there be?), we simply set the client configstring (which should not produce any error)</span></div><div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;        <a class="code" href="server_8h.html#aec9788a4410ed7f82b60651c4e23e383">SV_SetConfigstring</a>(<a class="code" href="group__lua__etvars.html#ga3c4270e8cb68ad1ff315b9ec7dbd2ef1">CS_PLAYERS</a> + num, configstring);</div><div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;    }</div><div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;}</div><div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;</div><div class="line"><a name="l01550"></a><span class="lineno"><a class="line" href="sv__demo_8c.html#a3187d882bdaed21c1191839264f13711"> 1550</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="sv__demo_8c.html#a3187d882bdaed21c1191839264f13711">SV_DemoReadClientUserinfo</a>(<a class="code" href="structmsg__t.html">msg_t</a> *msg)</div><div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;{</div><div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;    <a class="code" href="structclient__s.html">client_t</a> *client;</div><div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;    <span class="keywordtype">char</span>     *userinfo;</div><div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;    <span class="keywordtype">int</span>      num;</div><div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;    <span class="keywordtype">char</span>     svdoldteam[<a class="code" href="q__shared_8h.html#a0c397a708cec89c74029582574516b30">MAX_NAME_LENGTH</a>];</div><div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;    <span class="keywordtype">char</span>     svdnewteam[<a class="code" href="q__shared_8h.html#a0c397a708cec89c74029582574516b30">MAX_NAME_LENGTH</a>];</div><div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;</div><div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;    <a class="code" href="q__shared_8h.html#a331d56054b8d2cc3b4be5aaa79f9258c">Com_Memset</a>(svdoldteam, 0, <a class="code" href="q__shared_8h.html#a0c397a708cec89c74029582574516b30">MAX_NAME_LENGTH</a>);</div><div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;    <a class="code" href="q__shared_8h.html#a331d56054b8d2cc3b4be5aaa79f9258c">Com_Memset</a>(svdnewteam, 0, <a class="code" href="q__shared_8h.html#a0c397a708cec89c74029582574516b30">MAX_NAME_LENGTH</a>);</div><div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;</div><div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;    <span class="comment">// Get client</span></div><div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;    num    = <a class="code" href="msg_8c.html#adbb199f1fac9e30684b996143a907a5b">MSG_ReadByte</a>(msg);</div><div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;    client = &amp;<a class="code" href="server_8h.html#a698d5b1998898dad31ebfeb8983f8746">svs</a>.<a class="code" href="structserverStatic__t.html#a7cafb183964315009682fc02b30613d9">clients</a>[num];</div><div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;    <span class="comment">// Get userinfo</span></div><div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;    userinfo = <a class="code" href="msg_8c.html#ac13659557314c0e7525eae249cb74aec">MSG_ReadString</a>(msg);</div><div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;</div><div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;    <span class="comment">// Get the old and new team for the client</span></div><div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;    <a class="code" href="q__shared_8c.html#a70a2b0d67ad6af400d513cf1136af8dc">Q_strncpyz</a>(svdoldteam, <a class="code" href="q__shared_8c.html#a8952048a805d58e583bfc6530f53ee82">Info_ValueForKey</a>(client-&gt;<a class="code" href="structclient__s.html#a8a8cc9e2fab9730c092047434e73eff5">userinfo</a>, <span class="stringliteral">&quot;team&quot;</span>), <a class="code" href="q__shared_8h.html#a0c397a708cec89c74029582574516b30">MAX_NAME_LENGTH</a>);</div><div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;    <a class="code" href="q__shared_8c.html#a70a2b0d67ad6af400d513cf1136af8dc">Q_strncpyz</a>(svdnewteam, <a class="code" href="q__shared_8c.html#a8952048a805d58e583bfc6530f53ee82">Info_ValueForKey</a>(userinfo, <span class="stringliteral">&quot;team&quot;</span>), <a class="code" href="q__shared_8h.html#a0c397a708cec89c74029582574516b30">MAX_NAME_LENGTH</a>);</div><div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;</div><div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;    <span class="comment">// Set the remoteAddress of this client to localhost (this will set &quot;ip\localhost&quot; in the userinfo, which will in turn force the gamecode to set this client as a localClient, which avoids inactivity timers and some other stuffs to be triggered)</span></div><div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;    <span class="keywordflow">if</span> (strlen(userinfo)) <span class="comment">// we check that the client isn&#39;t being dropped (in which case we shouldn&#39;t set an address)</span></div><div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;    {</div><div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;        <a class="code" href="net__chan_8c.html#aa6a665a1e1a3a0e2b922df6226e83bae">NET_StringToAdr</a>(<span class="stringliteral">&quot;localhost&quot;</span>, &amp;client-&gt;<a class="code" href="structclient__s.html#a6dac1acddd0a5749f1e66fe59e542ade">netchan</a>.<a class="code" href="structnetchan__t.html#accc89940b6f4bebbd1b70cfaa94ae0e9">remoteAddress</a>, <a class="code" href="qcommon_8h.html#a1654a012cc4b6196cf9e2da097b7b02aa9cf418f084ad1c666a25b35db62f9e55">NA_LOOPBACK</a>);</div><div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;    }</div><div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;</div><div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;    <span class="comment">// Update the userinfo for both the server and gamecode</span></div><div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;    <a class="code" href="cmd_8c.html#a25002ad2a0030da75a2030d646bcbc75">Cmd_TokenizeString</a>(<a class="code" href="dl__local_8h.html#a2f2251d7d64d4c9ec69520b953f68bb9">va</a>(<span class="stringliteral">&quot;userinfo %s&quot;</span>, userinfo));   <span class="comment">// we need to prepend the userinfo command (or in fact any word) to tokenize the userinfo string to the second index because SV_UpdateUserinfo_f expects to fetch it with Argv(1)</span></div><div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;    <a class="code" href="server_8h.html#a13c22272e1091e3df00ee97b9ed3ac10">SV_UpdateUserinfo_f</a>(client); <span class="comment">// will update the server userinfo, automatically fill client_t fields and then transmit to the gamecode and call ClientUserinfoChanged() which will also update the gamecode&#39;s client_t from the new userinfo (eg: name [server-side] and netname [gamecode-side] will be both updated)</span></div><div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;</div><div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;</div><div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;    <span class="comment">// DEMOCLIENT INITIAL TEAM MANAGEMENT</span></div><div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;    <span class="comment">// Note: it is more interoperable to do team management here than in configstrings because here we have the team name as a string, so we can directly issue it in a &quot;team&quot; clientCommand</span></div><div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;    <span class="comment">// Note2: this function is only necessary to set the initial team for democlients (the team they were at first when the demo started), for all the latter team changes, the clientCommands are recorded and will be replayed</span></div><div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;    <span class="keywordflow">if</span> (strlen(userinfo) &amp;&amp; strlen(svdnewteam) &amp;&amp;</div><div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;        (!strlen(svdoldteam) || (<a class="code" href="dl__local_8h.html#a74f39535654af88006aa56dca7615bc5">Q_stricmp</a>(svdoldteam, svdnewteam) &amp;&amp; strlen(svdnewteam)))   <span class="comment">// if there was no team for this player before OR if the new team is different</span></div><div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;        )</div><div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;    {</div><div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;        <span class="comment">// If the democlient changed team, we manually issue a team change (workaround by using a clientCommand team)</span></div><div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;        <a class="code" href="server_8h.html#a52b0f145e2eab712924fdbda3b486b1f">SV_ExecuteClientCommand</a>(client, <a class="code" href="dl__local_8h.html#a2f2251d7d64d4c9ec69520b953f68bb9">va</a>(<span class="stringliteral">&quot;team %s&quot;</span>, svdnewteam), <a class="code" href="q__shared_8h.html#a110846a9664bbd925f955266e60e9136a9a60e3a3b7123e30c470bd5823cde09d">qtrue</a>, <a class="code" href="q__shared_8h.html#a110846a9664bbd925f955266e60e9136a0e538a5d43e68d2de4eb96c77855de40">qfalse</a>); <span class="comment">// workaround to force the server&#39;s gamecode and clients to update the team for this client</span></div><div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;</div><div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;    }</div><div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strlen(svdoldteam) &amp;&amp; !strlen(svdnewteam) &amp;&amp; strlen(userinfo) &amp;&amp; !strlen(<a class="code" href="q__shared_8c.html#a8952048a805d58e583bfc6530f53ee82">Info_ValueForKey</a>(<a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#ab3620e6e41fd6771b4994186079f6b43">configstrings</a>[<a class="code" href="group__lua__etvars.html#ga3c4270e8cb68ad1ff315b9ec7dbd2ef1">CS_PLAYERS</a> + num], <span class="stringliteral">&quot;t&quot;</span>)))</div><div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;    {</div><div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;        <span class="comment">// old and new team are not specified in the previous and current userinfo, but a userinfo is present</span></div><div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;        <span class="comment">// Else if the democlient has no team specified, it&#39;s probably because he just has connected and so he is set to the default team by the gamecode depending on the gamecode: for &gt;= GT_TEAM it&#39;s spectator, for all the others non-team based gametypes it&#39;s direcly in-game</span></div><div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;        <span class="comment">// FIXME? If you are trying to port this patch and weirdly some democlients are visible in scoreboard but can&#39;t be followed, try to uncomment these lines</span></div><div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;        <a class="code" href="server_8h.html#a52b0f145e2eab712924fdbda3b486b1f">SV_ExecuteClientCommand</a>(client, <span class="stringliteral">&quot;team spectator&quot;</span>, <a class="code" href="q__shared_8h.html#a110846a9664bbd925f955266e60e9136a9a60e3a3b7123e30c470bd5823cde09d">qtrue</a>, <a class="code" href="q__shared_8h.html#a110846a9664bbd925f955266e60e9136a0e538a5d43e68d2de4eb96c77855de40">qfalse</a>);</div><div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;    }</div><div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;}</div><div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;</div><div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;<span class="comment">static void SV_DemoReadClientUsercmd( msg_t *msg )</span></div><div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;<span class="comment">{</span></div><div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;<span class="comment">    int num, deltaint;</span></div><div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;<span class="comment">    qboolean delta;</span></div><div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;<span class="comment">    Cmd_SaveCmdContext(); // Save the context (tokenized strings) so that the engine can continue its usual processing normally just after this function</span></div><div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;<span class="comment">    num = MSG_ReadByte(msg);</span></div><div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;<span class="comment">    deltaint = MSG_ReadByte(msg);</span></div><div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;<span class="comment">    if (deltaint)</span></div><div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;<span class="comment">        delta = qtrue;</span></div><div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;<span class="comment">    else</span></div><div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;<span class="comment">        delta = qfalse;</span></div><div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;<span class="comment">    //Com_Printf(&quot;DebugGBOReadusercmd: %i\n&quot;, num);</span></div><div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;<span class="comment">    SV_UserMove(&amp;svs.clients[num], msg, delta);</span></div><div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;<span class="comment">    Cmd_RestoreCmdContext(); // Restore the context (tokenized strings)</span></div><div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;<span class="comment">}</span></div><div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;</div><div class="line"><a name="l01635"></a><span class="lineno"><a class="line" href="sv__demo_8c.html#a08a7dff997b64b706f653d15bf6f6ee0"> 1635</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="sv__demo_8c.html#a08a7dff997b64b706f653d15bf6f6ee0">SV_DemoReadAllPlayerState</a>(<a class="code" href="structmsg__t.html">msg_t</a> *msg)</div><div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;{</div><div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;    <a class="code" href="structplayerState__s.html">playerState_t</a> *player;</div><div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;    <span class="keywordtype">int</span>           num;</div><div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;</div><div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;    num = <a class="code" href="msg_8c.html#adbb199f1fac9e30684b996143a907a5b">MSG_ReadByte</a>(msg);</div><div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;</div><div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;    <span class="keywordflow">if</span> (num &lt; 0 || num &gt;= <a class="code" href="q__shared_8h.html#a0a8f91f93d75a07f0ae45077db45b3eb">MAX_CLIENTS</a>)</div><div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;    {</div><div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;        <a class="code" href="sv__demo_8c.html#a13d0409732f14929c72828f0c9db0343">SV_DemoPlaybackError</a>(<span class="stringliteral">&quot;SV_DemoReadAllPlayerState: invalid demo message!&quot;</span>);</div><div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;    }</div><div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;</div><div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;    player = <a class="code" href="server_8h.html#a7f1a538eff9cab28ecafcf036f68e49d">SV_GameClientNum</a>(num);</div><div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;    <a class="code" href="msg_8c.html#ae7dd73838db747fb3c9e5d7bc0725471">MSG_ReadDeltaPlayerstate</a>(msg, &amp;<a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#a4132ec967ed2e26499e7c93b84e70915">demoPlayerStates</a>[num], player);</div><div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;    <a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#a4132ec967ed2e26499e7c93b84e70915">demoPlayerStates</a>[num] = *player;</div><div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;}</div><div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;</div><div class="line"><a name="l01656"></a><span class="lineno"><a class="line" href="sv__demo_8c.html#aaff78f6aa9ec94251e5e0a7ed26ecbd9"> 1656</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="sv__demo_8c.html#aaff78f6aa9ec94251e5e0a7ed26ecbd9">SV_DemoReadAllEntityState</a>(<a class="code" href="structmsg__t.html">msg_t</a> *msg)</div><div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;{</div><div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;    <a class="code" href="structsharedEntity__t.html">sharedEntity_t</a> *entity;</div><div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;    <span class="keywordtype">int</span>            num;</div><div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;</div><div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;    <span class="comment">// For each state in this message (because we store a concatenation of all entities states in a single message, we could do otherwise, but that&#39;s the design)</span></div><div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;    <span class="keywordflow">while</span> (1)</div><div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;    {</div><div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;        <span class="comment">// Get entity num</span></div><div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;        num = <a class="code" href="msg_8c.html#ab4fbaf62146cc0af89d6ffc359b588a6">MSG_ReadBits</a>(msg, <a class="code" href="q__shared_8h.html#a674763dac6c5d9defd5165e2d196b7a4">GENTITYNUM_BITS</a>);</div><div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;</div><div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;        <span class="comment">// Reached the end of the message, stop here</span></div><div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;        <span class="keywordflow">if</span> (num == <a class="code" href="q__shared_8h.html#aa684040d7aebb90b780e2169fbe326e9">ENTITYNUM_NONE</a>)</div><div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;        {</div><div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;        }</div><div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;</div><div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;        <span class="comment">// Create a blank entity</span></div><div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;        entity = <a class="code" href="server_8h.html#a20f9c6bea9d6c49b1e7f2e00ecafb273">SV_GentityNum</a>(num);</div><div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;        <span class="comment">// Interpolate the new entity state from previous state in sv.demoEntities</span></div><div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;        <a class="code" href="msg_8c.html#aa78e4a13e042f3abe51215857148f00f">MSG_ReadDeltaEntity</a>(msg, &amp;<a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#a75f2b31ea80a25242aa46b8dd3d70d1b">demoEntities</a>[num].<a class="code" href="structsharedEntity__t.html#a89773b8fde222ad9577e8d9b3504141a">s</a>, &amp;entity-&gt;<a class="code" href="structsharedEntity__t.html#a89773b8fde222ad9577e8d9b3504141a">s</a>, num);</div><div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;</div><div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;        <span class="comment">// Fix mover movements, (avoid the &quot;bad moverstate&quot; error)</span></div><div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;        <span class="keywordflow">if</span> (entity-&gt;<a class="code" href="structsharedEntity__t.html#a89773b8fde222ad9577e8d9b3504141a">s</a>.<a class="code" href="structentityState__s.html#afbe7d9eca166816dad9eb2b44484073f">eType</a> == <a class="code" href="q__shared_8h.html#aba8efcfeace840764f26eb63236b996fac64a219bee2ab3ff18669647f94f1419">ET_MOVER</a>)</div><div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;        {</div><div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;            <span class="comment">// 1st way to fix: completely disable movers (but not their displacement effects, so they will be invisible, but players are still moved by movers)</span></div><div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;            <span class="comment">//entity-&gt;s.eType = ET_GENERAL;</span></div><div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;</div><div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;            <span class="comment">// 2nd way to fix (better): only binarymovers are producing the bug, because the game will be confused about the moverState since we cannot have access nor set it...</span></div><div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;            <span class="comment">// the solution: avoid changing the moverState, only change the position. To do this, avoid calls to ent-&gt;reached, so in other words never allow s.pot.trType to be TR_LINEAR_STOP (other types of movers are not affected since they don&#39;t have a stop/reached state, they are just looping over and over)</span></div><div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;            <span class="keywordflow">if</span> (entity-&gt;<a class="code" href="structsharedEntity__t.html#a89773b8fde222ad9577e8d9b3504141a">s</a>.<a class="code" href="structentityState__s.html#a0f67fab8014db00050f0fa306b49e030">pos</a>.<a class="code" href="structtrajectory__t.html#a35221cbd6034e328a53ba10f6da6e17e">trType</a> == <a class="code" href="q__shared_8h.html#ab53d05683d8387a66f35e1dfc5edafb9a9cca5ee0127e0afe5df67f7fcca468b9">TR_LINEAR_STOP</a>)  <span class="comment">// mover reached end of movement? change it...</span></div><div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;            {</div><div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;                entity-&gt;<a class="code" href="structsharedEntity__t.html#a89773b8fde222ad9577e8d9b3504141a">s</a>.<a class="code" href="structentityState__s.html#a0f67fab8014db00050f0fa306b49e030">pos</a>.<a class="code" href="structtrajectory__t.html#a35221cbd6034e328a53ba10f6da6e17e">trType</a> = <a class="code" href="q__shared_8h.html#ab53d05683d8387a66f35e1dfc5edafb9ae73c66220ebe757bbbce0df3a5283636">TR_LINEAR</a>;  <span class="comment">// ... to always set movers in a moving linear state.</span></div><div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;                <span class="comment">//entity-&gt;s.apos.trType = TR_LINEAR; // should apos be also set?</span></div><div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;            }</div><div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;        }</div><div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;</div><div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;        <span class="comment">// Save new entity state (in sv.demoEntities, which in other words display the new state)</span></div><div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;        <a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#a75f2b31ea80a25242aa46b8dd3d70d1b">demoEntities</a>[num].<a class="code" href="structsharedEntity__t.html#a89773b8fde222ad9577e8d9b3504141a">s</a> = entity-&gt;<a class="code" href="structsharedEntity__t.html#a89773b8fde222ad9577e8d9b3504141a">s</a>;</div><div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;    }</div><div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;}</div><div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;</div><div class="line"><a name="l01704"></a><span class="lineno"><a class="line" href="sv__demo_8c.html#a5d8a660f9dee330dc9a9bc59363bc70e"> 1704</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="sv__demo_8c.html#a5d8a660f9dee330dc9a9bc59363bc70e">SV_DemoReadAllEntityShared</a>(<a class="code" href="structmsg__t.html">msg_t</a> *msg)</div><div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;{</div><div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;    <a class="code" href="structsharedEntity__t.html">sharedEntity_t</a> *entity;</div><div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;    <span class="keywordtype">int</span>            num;</div><div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;</div><div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;    <span class="keywordflow">while</span> (1) <span class="comment">// loop until we read the whole message (which is storing several states)</span></div><div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;    {</div><div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;        <span class="comment">// Get entity num</span></div><div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;        num = <a class="code" href="msg_8c.html#ab4fbaf62146cc0af89d6ffc359b588a6">MSG_ReadBits</a>(msg, <a class="code" href="q__shared_8h.html#a674763dac6c5d9defd5165e2d196b7a4">GENTITYNUM_BITS</a>);</div><div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;</div><div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;        <span class="comment">// Reached end of message, stop here</span></div><div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;        <span class="keywordflow">if</span> (num == <a class="code" href="q__shared_8h.html#aa684040d7aebb90b780e2169fbe326e9">ENTITYNUM_NONE</a>)</div><div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;        {</div><div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;        }</div><div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;</div><div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;        <span class="comment">// Load an empty entity</span></div><div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;        entity = <a class="code" href="server_8h.html#a20f9c6bea9d6c49b1e7f2e00ecafb273">SV_GentityNum</a>(num);</div><div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;        <span class="comment">// Interpolate the new entity state from previous state in sv.demoEntities</span></div><div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;        <a class="code" href="msg_8c.html#a895c6fc8d885fe5641e76185abef53a0">MSG_ReadDeltaSharedEntity</a>(msg, &amp;<a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#a75f2b31ea80a25242aa46b8dd3d70d1b">demoEntities</a>[num].<a class="code" href="structsharedEntity__t.html#a465868be7e097c59e30eb820fb890822">r</a>, &amp;entity-&gt;<a class="code" href="structsharedEntity__t.html#a465868be7e097c59e30eb820fb890822">r</a>, num);</div><div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;</div><div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;        entity-&gt;<a class="code" href="structsharedEntity__t.html#a465868be7e097c59e30eb820fb890822">r</a>.<a class="code" href="structentityShared__t.html#aba45f5cd6a771d13ca3665dfd98ce3a1">svFlags</a> &amp;= ~<a class="code" href="bg__public_8h.html#a5d3c87f6de9e1f3a5adb0649d6f480be">SVF_BOT</a>; <span class="comment">// fix bots camera freezing issues - because since now the engine will consider these democlients just as normal players, it won&#39;t be using anymore special bots fields and instead just use the standard viewangles field to replay the camera movements</span></div><div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;</div><div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;        <span class="comment">//entity-&gt;r.svFlags |= SVF_BOT; //Set player as a &quot;bot&quot; so the empty IP and GUID will not cause a kick</span></div><div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;</div><div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;        <span class="comment">// Link/unlink the entity</span></div><div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;        <span class="keywordflow">if</span> (entity-&gt;<a class="code" href="structsharedEntity__t.html#a465868be7e097c59e30eb820fb890822">r</a>.<a class="code" href="structentityShared__t.html#a806533ac43c862ab4487835a7051ed5a">linked</a> &amp;&amp; (!<a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#a75f2b31ea80a25242aa46b8dd3d70d1b">demoEntities</a>[num].<a class="code" href="structsharedEntity__t.html#a465868be7e097c59e30eb820fb890822">r</a>.<a class="code" href="structentityShared__t.html#a806533ac43c862ab4487835a7051ed5a">linked</a> ||</div><div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;                                 entity-&gt;<a class="code" href="structsharedEntity__t.html#a465868be7e097c59e30eb820fb890822">r</a>.<a class="code" href="structentityShared__t.html#a5cef811298c9427e17484f50db8f5387">linkcount</a> != <a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#a75f2b31ea80a25242aa46b8dd3d70d1b">demoEntities</a>[num].<a class="code" href="structsharedEntity__t.html#a465868be7e097c59e30eb820fb890822">r</a>.<a class="code" href="structentityShared__t.html#a5cef811298c9427e17484f50db8f5387">linkcount</a>))</div><div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;        {</div><div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;            <a class="code" href="server_8h.html#a69fbe770061af3f2aabc5e74ea822d71">SV_LinkEntity</a>(entity);</div><div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;        }</div><div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!entity-&gt;<a class="code" href="structsharedEntity__t.html#a465868be7e097c59e30eb820fb890822">r</a>.<a class="code" href="structentityShared__t.html#a806533ac43c862ab4487835a7051ed5a">linked</a> &amp;&amp; <a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#a75f2b31ea80a25242aa46b8dd3d70d1b">demoEntities</a>[num].<a class="code" href="structsharedEntity__t.html#a465868be7e097c59e30eb820fb890822">r</a>.<a class="code" href="structentityShared__t.html#a806533ac43c862ab4487835a7051ed5a">linked</a>)</div><div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;        {</div><div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;            <a class="code" href="server_8h.html#ae0b352c6d88fa5bc0585149c71d75818">SV_UnlinkEntity</a>(entity);</div><div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;        }</div><div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;</div><div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;        <span class="comment">// Save the new state in sv.demoEntities (ie, display current entity state)</span></div><div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;        <a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#a75f2b31ea80a25242aa46b8dd3d70d1b">demoEntities</a>[num].<a class="code" href="structsharedEntity__t.html#a465868be7e097c59e30eb820fb890822">r</a> = entity-&gt;<a class="code" href="structsharedEntity__t.html#a465868be7e097c59e30eb820fb890822">r</a>;</div><div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;        <span class="keywordflow">if</span> (num &gt; <a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#aecc2bc627e3d7df7e58c8c39d22c10eb">num_entities</a>)</div><div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;        {</div><div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;            <a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#aecc2bc627e3d7df7e58c8c39d22c10eb">num_entities</a> = num;</div><div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;        }</div><div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;    }</div><div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;}</div><div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;</div><div class="line"><a name="l01752"></a><span class="lineno"><a class="line" href="sv__demo_8c.html#af6045856578984db5b182a7c905938a0"> 1752</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="sv__demo_8c.html#af6045856578984db5b182a7c905938a0">SV_DemoReadRefreshEntities</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;{</div><div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;    <span class="keywordtype">int</span> i;</div><div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;</div><div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;    <span class="comment">// Overwrite anything the game may have changed</span></div><div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#aecc2bc627e3d7df7e58c8c39d22c10eb">num_entities</a>; i++)</div><div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;    {</div><div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;        <span class="keywordflow">if</span> (i &gt;= <a class="code" href="server_8h.html#a8d79a0b5f456061ad33642f11f4b7d17">sv_democlients</a>-&gt;<a class="code" href="structcvar__s.html#ae873b26596ff98802364d80bbb71c72a">integer</a> &amp;&amp; i &lt; <a class="code" href="q__shared_8h.html#a0a8f91f93d75a07f0ae45077db45b3eb">MAX_CLIENTS</a>) <span class="comment">// FIXME? shouldn&#39;t MAX_CLIENTS be sv_maxclients-&gt;integer?</span></div><div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;        {</div><div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;        }</div><div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;</div><div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;        *<a class="code" href="server_8h.html#a20f9c6bea9d6c49b1e7f2e00ecafb273">SV_GentityNum</a>(i) = <a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#a75f2b31ea80a25242aa46b8dd3d70d1b">demoEntities</a>[i]; <span class="comment">// Overwrite entities</span></div><div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;    }</div><div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;</div><div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="server_8h.html#a8d79a0b5f456061ad33642f11f4b7d17">sv_democlients</a>-&gt;<a class="code" href="structcvar__s.html#ae873b26596ff98802364d80bbb71c72a">integer</a>; i++)</div><div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;    {</div><div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;        *<a class="code" href="server_8h.html#a7f1a538eff9cab28ecafcf036f68e49d">SV_GameClientNum</a>(i) = <a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#a4132ec967ed2e26499e7c93b84e70915">demoPlayerStates</a>[i]; <span class="comment">// Overwrite player states</span></div><div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;    }</div><div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;}</div><div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;</div><div class="line"><a name="l01779"></a><span class="lineno"><a class="line" href="sv__demo_8c.html#ace360dcbf25cac744f9367ca438b4f30"> 1779</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="sv__demo_8c.html#ace360dcbf25cac744f9367ca438b4f30">SV_DemoReadRefreshPlayersHealth</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;{</div><div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;    <span class="keywordtype">int</span> i;</div><div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;</div><div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;    <span class="comment">// Update all players&#39; health in HUD</span></div><div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="server_8h.html#a8d79a0b5f456061ad33642f11f4b7d17">sv_democlients</a>-&gt;<a class="code" href="structcvar__s.html#ae873b26596ff98802364d80bbb71c72a">integer</a>; i++)</div><div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;    {</div><div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;        <a class="code" href="server_8h.html#a3b99dca52e9e1e439d5fab603a33ef92">SV_GentityUpdateHealthField</a>(<a class="code" href="server_8h.html#a20f9c6bea9d6c49b1e7f2e00ecafb273">SV_GentityNum</a>(i), <a class="code" href="server_8h.html#a7f1a538eff9cab28ecafcf036f68e49d">SV_GameClientNum</a>(i));   <span class="comment">// Update the health with the value of playerState_t-&gt;stats[STAT_HEALTH]</span></div><div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;    }</div><div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;}</div><div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;</div><div class="line"><a name="l01799"></a><span class="lineno"><a class="line" href="sv__demo_8c.html#ad9dc1a465b353d71a5dc0696f11ed892"> 1799</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="sv__demo_8c.html#ad9dc1a465b353d71a5dc0696f11ed892">SV_DemoReadFrame</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;{</div><div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;    <a class="code" href="structmsg__t.html">msg_t</a> msg;</div><div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;    <span class="keywordtype">int</span>   cmd, r;</div><div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;</div><div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;    <span class="keyword">static</span> <span class="keywordtype">int</span> memsvtime;</div><div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;    <span class="keyword">static</span> <span class="keywordtype">int</span> currentframe = -1;</div><div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;</div><div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;read_next_demo_frame: <span class="comment">// used to read another whole demo frame</span></div><div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;</div><div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;    <span class="comment">// Demo freezed? Just stop reading the demo frames</span></div><div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="cvar_8c.html#a37ba1e5addace2b2298bfbb2f5d52938">Cvar_VariableIntegerValue</a>(<span class="stringliteral">&quot;cl_freezeDemo&quot;</span>))</div><div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;    {</div><div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;        <a class="code" href="server_8h.html#a698d5b1998898dad31ebfeb8983f8746">svs</a>.<a class="code" href="structserverStatic__t.html#a7f46475a8a4d8c8c140b9022d6476041">time</a> = memsvtime; <span class="comment">// reset server time to the same time as the previous frame, to avoid the time going backward when resuming the demo (which will disconnect every players)</span></div><div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;    }</div><div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;</div><div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;    <span class="comment">// Update timescale</span></div><div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;    currentframe++; <span class="comment">// update the current frame number</span></div><div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;</div><div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="common_8c.html#a39d965dde39e997b0cabeb491e9a074a">com_timescale</a>-&gt;<a class="code" href="structcvar__s.html#a924de486b6519c65a08d4872b4cd15f8">value</a> &lt; 1.0f &amp;&amp; <a class="code" href="common_8c.html#a39d965dde39e997b0cabeb491e9a074a">com_timescale</a>-&gt;<a class="code" href="structcvar__s.html#a924de486b6519c65a08d4872b4cd15f8">value</a> &gt; 0.0f)</div><div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;    {</div><div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;        <span class="comment">// Check timescale: if slowed timescale (below 1.0), then we check that we pass one frame on 1.0/com_timescale (eg: timescale = 0.5, 1.0/0.5=2, so we pass one frame on two)</span></div><div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;        <span class="keywordflow">if</span> (currentframe % (<span class="keywordtype">int</span>)(1.0f / <a class="code" href="common_8c.html#a39d965dde39e997b0cabeb491e9a074a">com_timescale</a>-&gt;<a class="code" href="structcvar__s.html#a924de486b6519c65a08d4872b4cd15f8">value</a>) != 0)</div><div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;        { <span class="comment">// if it&#39;s not yet the right time to read the frame, we just pass and wait for the next server frame to read this demo frame</span></div><div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;            <span class="keywordflow">return</span>;</div><div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;        }</div><div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;    }</div><div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;</div><div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;    <span class="comment">// Initialize / reinitialize the msg buffer</span></div><div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;    <a class="code" href="msg_8c.html#a4bba3ea21116c996f3e630414895b183">MSG_Init</a>(&amp;msg, <a class="code" href="sv__demo_8c.html#a1756d9ddc463d7bca9539c8546a7c1b0">buf</a>, <span class="keyword">sizeof</span>(<a class="code" href="sv__demo_8c.html#a1756d9ddc463d7bca9539c8546a7c1b0">buf</a>));</div><div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;</div><div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;    <span class="keywordflow">while</span> (1)</div><div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;    {</div><div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;read_next_demo_event: <span class="comment">// used to read next demo event</span></div><div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;</div><div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;        <span class="comment">// Get a message</span></div><div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;        r = <a class="code" href="files_8c.html#a4e635a7a368bbd1ef3dbd99140c69e39">FS_Read</a>(&amp;msg.<a class="code" href="structmsg__t.html#ad79ecd5d9636d0e96bedd3a8b1be24a8">cursize</a>, 4, <a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#af6dffe71c8e672577be691d5b32bd8d3">demoFile</a>);</div><div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;</div><div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;        <span class="keywordflow">if</span> (r != 4)</div><div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;        {</div><div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;            <a class="code" href="sv__demo_8c.html#a13d0409732f14929c72828f0c9db0343">SV_DemoPlaybackError</a>(<span class="stringliteral">&quot;DEMOERROR: SV_DemoReadFrame: Demo file is corrupted&quot;</span>);</div><div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;        }</div><div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;        msg.<a class="code" href="structmsg__t.html#ad79ecd5d9636d0e96bedd3a8b1be24a8">cursize</a> = LittleLong(msg.<a class="code" href="structmsg__t.html#ad79ecd5d9636d0e96bedd3a8b1be24a8">cursize</a>); <span class="comment">// get the size of the next demo message</span></div><div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;</div><div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;        <span class="keywordflow">if</span> (msg.<a class="code" href="structmsg__t.html#ad79ecd5d9636d0e96bedd3a8b1be24a8">cursize</a> &gt; msg.<a class="code" href="structmsg__t.html#a7b8927986fe254f74101628ef88df26c">maxsize</a>) <span class="comment">// if the size is too big, we throw an error</span></div><div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;        {</div><div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;            <a class="code" href="sv__demo_8c.html#a13d0409732f14929c72828f0c9db0343">SV_DemoPlaybackError</a>(<span class="stringliteral">&quot;DEMOERROR: SV_DemoReadFrame: demo message too long\n&quot;</span>);</div><div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;        }</div><div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;</div><div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;        r = <a class="code" href="files_8c.html#a4e635a7a368bbd1ef3dbd99140c69e39">FS_Read</a>(msg.<a class="code" href="structmsg__t.html#ab12d572562d7fb2fd9c3a450786e5c33">data</a>, msg.<a class="code" href="structmsg__t.html#ad79ecd5d9636d0e96bedd3a8b1be24a8">cursize</a>, <a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#af6dffe71c8e672577be691d5b32bd8d3">demoFile</a>); <span class="comment">// fetch the demo message (using the length we got) from the demo file sv.demoFile, and store it into msg.data (will be accessed automatically by MSG_thing() functions), and store in r the length of the data returned (used to check that it&#39;s correct)</span></div><div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;        <span class="keywordflow">if</span> (r != msg.<a class="code" href="structmsg__t.html#ad79ecd5d9636d0e96bedd3a8b1be24a8">cursize</a>) <span class="comment">// if the returned length of the read demo message is not the same as the length we expected (the one that was stored just prior to the demo message), we return an error because we miss the demo message, and the only reason is that the file is truncated, so there&#39;s nothing to read after</span></div><div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;        {</div><div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;            <a class="code" href="sv__demo_8c.html#a13d0409732f14929c72828f0c9db0343">SV_DemoPlaybackError</a>(<span class="stringliteral">&quot;DEMOERROR: Demo file was truncated.&quot;</span>);</div><div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;        }</div><div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;</div><div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;        <span class="comment">// Parse the message</span></div><div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;        <span class="keywordflow">while</span> (1)</div><div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;        {</div><div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;            cmd = <a class="code" href="msg_8c.html#adbb199f1fac9e30684b996143a907a5b">MSG_ReadByte</a>(&amp;msg); <span class="comment">// Read the demo message marker</span></div><div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;</div><div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;            <span class="keywordflow">switch</span> (cmd) <span class="comment">// switch to the right processing depending on the type of the marker</span></div><div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;            {</div><div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;            <span class="keywordflow">default</span>:</div><div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;                <span class="comment">// Error tolerance mode: if we encounter an unknown demo message, we just skip to the next (this may allow for retrocompatibility)</span></div><div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="server_8h.html#af1f59a32ccea93eed6522ef2a4140bc7">sv_demoTolerant</a>-&gt;<a class="code" href="structcvar__s.html#ae873b26596ff98802364d80bbb71c72a">integer</a>)</div><div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;                {</div><div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;                    <a class="code" href="msg_8c.html#a7931ab57b8c77c161cb63c76155f92ec">MSG_Clear</a>(&amp;msg);</div><div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;                    <span class="keywordflow">goto</span> read_next_demo_event;</div><div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;                }</div><div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;                <span class="keywordflow">else</span></div><div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;                {     <span class="comment">// else we just drop the demo and throw a big fat error</span></div><div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;                    <a class="code" href="sv__demo_8c.html#a13d0409732f14929c72828f0c9db0343">SV_DemoPlaybackError</a>(<a class="code" href="dl__local_8h.html#a2f2251d7d64d4c9ec69520b953f68bb9">va</a>(<span class="stringliteral">&quot;SV_DemoReadFrame: Illegible demo message [%i %i:%i]&quot;</span>, cmd, msg.<a class="code" href="structmsg__t.html#adf44d2010aefea14afec18978b23044e">readcount</a>, msg.<a class="code" href="structmsg__t.html#ad79ecd5d9636d0e96bedd3a8b1be24a8">cursize</a>));</div><div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;                }</div><div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="sv__demo_8c.html#af2bc2d94afb470315c0786124a2fdc31af5d3dcaed9fee578e7a23fdaf39b3485">demo_EOF</a>:     <span class="comment">// end of a demo event (the loop will continue to real the next event)</span></div><div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;                <a class="code" href="msg_8c.html#a7931ab57b8c77c161cb63c76155f92ec">MSG_Clear</a>(&amp;msg);</div><div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;                <span class="keywordflow">goto</span> read_next_demo_event;</div><div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="sv__demo_8c.html#af2bc2d94afb470315c0786124a2fdc31a28877e13ad25c44d02526672a825b457">demo_configString</a>:     <span class="comment">// general configstrings setting (such as capture scores CS_SCORES1/2, etc.) - except clients configstrings</span></div><div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;                <a class="code" href="sv__demo_8c.html#a723cda94f53cb8429c006815b6b256d8">SV_DemoReadConfigString</a>(&amp;msg);</div><div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="sv__demo_8c.html#af2bc2d94afb470315c0786124a2fdc31ade02da1ed2771e05fc653410dabc7ee9">demo_clientConfigString</a>:     <span class="comment">// client configstrings setting and clients status management</span></div><div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;                <a class="code" href="sv__demo_8c.html#a175c60213a858535c9f881e5e4186b66">SV_DemoReadClientConfigString</a>(&amp;msg);</div><div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="sv__demo_8c.html#af2bc2d94afb470315c0786124a2fdc31a899deb9b820e7fddef38a0f8b9b02b84">demo_clientUserinfo</a>:     <span class="comment">// client userinfo setting and client_t fields management</span></div><div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;                <a class="code" href="sv__demo_8c.html#a3187d882bdaed21c1191839264f13711">SV_DemoReadClientUserinfo</a>(&amp;msg);</div><div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="sv__demo_8c.html#af2bc2d94afb470315c0786124a2fdc31a4ae848aa842475d53d1bf51d11f5324c">demo_clientCommand</a>:     <span class="comment">// client command management (generally automatic, such as tinfo for HUD team overlay status, team selection, etc.) - except userinfo command that is managed by another event</span></div><div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;                <a class="code" href="sv__demo_8c.html#a857bf754749bfac22ce3930b8d719e31">SV_DemoReadClientCommand</a>(&amp;msg);</div><div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="sv__demo_8c.html#af2bc2d94afb470315c0786124a2fdc31a7a1cab03a80a4741e82f124d9e6fd8cc">demo_serverCommand</a>:     <span class="comment">// server command management - except print/cp (already handled by gameCommand),</span></div><div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;                <a class="code" href="sv__demo_8c.html#ae1276ebee179d6adbfacf85164ac6c56">SV_DemoReadServerCommand</a>(&amp;msg);</div><div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="sv__demo_8c.html#af2bc2d94afb470315c0786124a2fdc31a8829120824b95d7ac3fd0b727d6d7550">demo_gameCommand</a>:     <span class="comment">// game command management - such as prints/centerprint (cp) scores command - except chat/tchat (handled by clientCommand) - basically the same as demo_serverCommand (because sv_GameSendServerCommand uses SV_SendServerCommand, but game commands are safe to be replayed to everyone, while server commands may be unsafe such as disconnect)</span></div><div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;                <a class="code" href="sv__demo_8c.html#ab665b00f98fea8023457dd250deea1e0">SV_DemoReadGameCommand</a>(&amp;msg);</div><div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="sv__demo_8c.html#af2bc2d94afb470315c0786124a2fdc31a2408c8938e204b6ab01b8d830d5b1c2c">demo_playerState</a>:     <span class="comment">// manage playerState_t (some more players game status management, see demo_endFrame)</span></div><div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;                <a class="code" href="sv__demo_8c.html#a08a7dff997b64b706f653d15bf6f6ee0">SV_DemoReadAllPlayerState</a>(&amp;msg);</div><div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="sv__demo_8c.html#af2bc2d94afb470315c0786124a2fdc31aa376fd14cf5aa4417a120dae8db81167">demo_entityState</a>:     <span class="comment">// manage gentity-&gt;entityState_t (some more gentities game status management, see demo_endFrame)</span></div><div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;                <a class="code" href="sv__demo_8c.html#aaff78f6aa9ec94251e5e0a7ed26ecbd9">SV_DemoReadAllEntityState</a>(&amp;msg);</div><div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="sv__demo_8c.html#af2bc2d94afb470315c0786124a2fdc31a75fd01e2070256a0617c394331e5ee9f">demo_entityShared</a>:     <span class="comment">// gentity_t-&gt;entityShared_t management (see g_local.h for more infos)</span></div><div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;                <a class="code" href="sv__demo_8c.html#a5d8a660f9dee330dc9a9bc59363bc70e">SV_DemoReadAllEntityShared</a>(&amp;msg);</div><div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;            <span class="comment">/*</span></div><div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;<span class="comment">            case demo_clientUsercmd:</span></div><div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;<span class="comment">                SV_DemoReadClientUsercmd(&amp;msg);</span></div><div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;<span class="comment">                break;</span></div><div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;<span class="comment">            */</span></div><div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;            <span class="keywordflow">case</span> -1: <span class="comment">// no more chars in msg FIXME: inspect!</span></div><div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;                <a class="code" href="common_8c.html#a2063ee236b7b5b79899a81047e5e0400">Com_DPrintf</a>(<span class="stringliteral">&quot;SV_DemoReadFrame: no chars [%i %i:%i]&quot;</span>, cmd, msg.<a class="code" href="structmsg__t.html#adf44d2010aefea14afec18978b23044e">readcount</a>, msg.<a class="code" href="structmsg__t.html#ad79ecd5d9636d0e96bedd3a8b1be24a8">cursize</a>);</div><div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;                <span class="keywordflow">return</span>;</div><div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="sv__demo_8c.html#af2bc2d94afb470315c0786124a2fdc31a33f59650efb74b3a4305f11883698a02">demo_endFrame</a>:     <span class="comment">// end of the frame - players and entities game status update: we commit every demo entity to the server, update the server time, then release the demo frame reading here to the next server (and demo) frame</span></div><div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;                <a class="code" href="common_8c.html#a2063ee236b7b5b79899a81047e5e0400">Com_DPrintf</a>(<span class="stringliteral">&quot; END OF FRAME \n&quot;</span>);</div><div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;</div><div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;                <span class="comment">// Update entities</span></div><div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;                <a class="code" href="sv__demo_8c.html#af6045856578984db5b182a7c905938a0">SV_DemoReadRefreshEntities</a>();     <span class="comment">// load into memory the demo entities (overwriting any change the game may have done)</span></div><div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;                <span class="comment">// Update all players&#39; health in HUD</span></div><div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;                <a class="code" href="sv__demo_8c.html#ace360dcbf25cac744f9367ca438b4f30">SV_DemoReadRefreshPlayersHealth</a>();</div><div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;                <span class="comment">// Set the server time</span></div><div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;                <a class="code" href="server_8h.html#a698d5b1998898dad31ebfeb8983f8746">svs</a>.<a class="code" href="structserverStatic__t.html#a7f46475a8a4d8c8c140b9022d6476041">time</a>  = <a class="code" href="msg_8c.html#ad7efeddd101bfd4d073ed261c67ddd1f">MSG_ReadLong</a>(&amp;msg);    <span class="comment">// refresh server in-game time (overwriting any change the game may have done)</span></div><div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;                memsvtime = <a class="code" href="server_8h.html#a698d5b1998898dad31ebfeb8983f8746">svs</a>.<a class="code" href="structserverStatic__t.html#a7f46475a8a4d8c8c140b9022d6476041">time</a>;     <span class="comment">// keep memory of the last server time, in case we want to freeze the demo</span></div><div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;</div><div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;                <span class="comment">// Check for timescale: if timescale is faster (above 1.0), we read more frames at once (eg: timescale=2, we read 2 frames for one call of this function)</span></div><div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="common_8c.html#a39d965dde39e997b0cabeb491e9a074a">com_timescale</a>-&gt;<a class="code" href="structcvar__s.html#a924de486b6519c65a08d4872b4cd15f8">value</a> &gt; 1.0f)</div><div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;                {</div><div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;                    <span class="comment">// Check that we&#39;ve read all the frames we needed</span></div><div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;                    <span class="keywordflow">if</span> (currentframe % (<span class="keywordtype">int</span>)(<a class="code" href="common_8c.html#a39d965dde39e997b0cabeb491e9a074a">com_timescale</a>-&gt;<a class="code" href="structcvar__s.html#a924de486b6519c65a08d4872b4cd15f8">value</a>) != 0)</div><div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;                    {</div><div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;                        <span class="keywordflow">goto</span> read_next_demo_frame;     <span class="comment">// if not true, we read another frame</span></div><div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;                    }</div><div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;                }</div><div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;</div><div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;                <span class="keywordflow">return</span>;     <span class="comment">// else we end the current demo frame</span></div><div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="sv__demo_8c.html#af2bc2d94afb470315c0786124a2fdc31a21695c29e33235a31893db6f62f314d1">demo_endDemo</a>:     <span class="comment">// end of the demo file - just stop playback and restore saved cvars</span></div><div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;                <a class="code" href="cg__main_8c.html#ac5a47034a0c2a1c1eba5f1acd22987a2">Com_Printf</a>(<span class="stringliteral">&quot;End of demo reached.\n&quot;</span>);</div><div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;                <a class="code" href="sv__demo_8c.html#af40b5e1ed925afb7b86a9ad0c20bcbe2">SV_DemoStopPlayback</a>();</div><div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;                <span class="keywordflow">return</span>;</div><div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;            }</div><div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;        }</div><div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;    }</div><div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;}</div><div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;</div><div class="line"><a name="l01945"></a><span class="lineno"><a class="line" href="sv__demo_8c.html#a8fe5acd248eb0ad72f98008fc25dc3bf"> 1945</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="sv__demo_8c.html#a8fe5acd248eb0ad72f98008fc25dc3bf">SV_DemoStopAll</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;{</div><div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;    <span class="comment">// stop any demos</span></div><div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#a66e3cb8a5905f2e1e9d8c89fcc2b2dc9">demoState</a> == <a class="code" href="q__shared_8h.html#aeaa898bef6b376f572e5e59d943d78b2a56f619bf31320371483bd356ba300028">DS_RECORDING</a>)</div><div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;    {</div><div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;        <a class="code" href="sv__demo_8c.html#a71ccef0ee78f1fc40c726ca22d0fd6ba">SV_DemoStopRecord</a>();</div><div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;    }</div><div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#a66e3cb8a5905f2e1e9d8c89fcc2b2dc9">demoState</a> == <a class="code" href="q__shared_8h.html#aeaa898bef6b376f572e5e59d943d78b2a92cbb6b682e745d51527236bad2a6011">DS_PLAYBACK</a> || <a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#a66e3cb8a5905f2e1e9d8c89fcc2b2dc9">demoState</a> == <a class="code" href="q__shared_8h.html#aeaa898bef6b376f572e5e59d943d78b2a532cc227a9fbfa28f3a3f417f5fb1944">DS_WAITINGPLAYBACK</a>)</div><div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;    {</div><div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;        <a class="code" href="sv__demo_8c.html#af40b5e1ed925afb7b86a9ad0c20bcbe2">SV_DemoStopPlayback</a>();</div><div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;    }</div><div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;}</div><div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;</div><div class="line"><a name="l01961"></a><span class="lineno"><a class="line" href="sv__demo_8c.html#a4746034bb9e2d789bcecb74b26912eb0"> 1961</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="sv__demo_8c.html#a4746034bb9e2d789bcecb74b26912eb0">SV_Demo_Record_f</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;{</div><div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;    <span class="comment">// make sure server is running</span></div><div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="common_8c.html#a0dc3b8737b9c0dd5fc582a4c03c60332">com_sv_running</a>-&gt;<a class="code" href="structcvar__s.html#ae873b26596ff98802364d80bbb71c72a">integer</a>)</div><div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;    {</div><div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;        <a class="code" href="cg__main_8c.html#ac5a47034a0c2a1c1eba5f1acd22987a2">Com_Printf</a>(<span class="stringliteral">&quot;Server is not running.\n&quot;</span>);</div><div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;    }</div><div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;</div><div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="cmd_8c.html#aaf7e5eaecf2386bacf67dafb8cdcba33">Cmd_Argc</a>() &gt; 2)</div><div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;    {</div><div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;        <a class="code" href="cg__main_8c.html#ac5a47034a0c2a1c1eba5f1acd22987a2">Com_Printf</a>(<span class="stringliteral">&quot;Usage: demo_record &lt;demoname&gt;\n&quot;</span>);</div><div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;    }</div><div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;</div><div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#a66e3cb8a5905f2e1e9d8c89fcc2b2dc9">demoState</a> != <a class="code" href="q__shared_8h.html#aeaa898bef6b376f572e5e59d943d78b2a7c568dd37665684d045c4d40b0553a9c">DS_NONE</a>)</div><div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;    {</div><div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;        <a class="code" href="cg__main_8c.html#ac5a47034a0c2a1c1eba5f1acd22987a2">Com_Printf</a>(<span class="stringliteral">&quot;A demo is already being recorded/played. Use demo_stop and retry.\n&quot;</span>);</div><div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;    }</div><div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;</div><div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="server_8h.html#a0bc03a0e709716a4965c0324f23b8977">sv_maxclients</a>-&gt;<a class="code" href="structcvar__s.html#ae873b26596ff98802364d80bbb71c72a">integer</a> &gt; <a class="code" href="q__shared_8h.html#a0a8f91f93d75a07f0ae45077db45b3eb">MAX_CLIENTS</a>)</div><div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;    {</div><div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;        <a class="code" href="cg__main_8c.html#ac5a47034a0c2a1c1eba5f1acd22987a2">Com_Printf</a>(<span class="stringliteral">&quot;DEMO: ERROR: Too many client slots, reduce sv_maxclients and retry.\n&quot;</span>);</div><div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;    }</div><div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;</div><div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="cmd_8c.html#aaf7e5eaecf2386bacf67dafb8cdcba33">Cmd_Argc</a>() == 2)</div><div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;    {</div><div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;        <a class="code" href="q__shared_8c.html#aad4e641649a5bcf8bb21fbe7a815ee98">Com_sprintf</a>(<a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#ae9a4f1d1b8296da77a74cf2da28a528c">demoName</a>, <span class="keyword">sizeof</span>(<a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#ae9a4f1d1b8296da77a74cf2da28a528c">demoName</a>), <span class="stringliteral">&quot;svdemos/%s.%s%d&quot;</span>, <a class="code" href="cmd_8c.html#a1734574e90e7819673500355d4758877">Cmd_Argv</a>(1), <a class="code" href="q__shared_8h.html#ace81fe40472a49aacabe17f75dc443ee">SVDEMOEXT</a>, <a class="code" href="qcommon_8h.html#a277f7abca2044f354abe265252cb9252">PROTOCOL_VERSION</a>);</div><div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;    }</div><div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;    {</div><div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;        <span class="keywordtype">int</span> number;</div><div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;        <span class="comment">// scan for a free demo name</span></div><div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;        <span class="keywordflow">for</span> (number = 0; number &gt;= 0; number++)</div><div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;        {</div><div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;            <a class="code" href="q__shared_8c.html#aad4e641649a5bcf8bb21fbe7a815ee98">Com_sprintf</a>(<a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#ae9a4f1d1b8296da77a74cf2da28a528c">demoName</a>, <span class="keyword">sizeof</span>(<a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#ae9a4f1d1b8296da77a74cf2da28a528c">demoName</a>), <span class="stringliteral">&quot;svdemos/%d.%s%d&quot;</span>, number, <a class="code" href="q__shared_8h.html#ace81fe40472a49aacabe17f75dc443ee">SVDEMOEXT</a>, <a class="code" href="qcommon_8h.html#a277f7abca2044f354abe265252cb9252">PROTOCOL_VERSION</a>);</div><div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;            <span class="keywordflow">if</span> (!<a class="code" href="files_8c.html#a966590935244c0d031a419129bf844a6">FS_FileExists</a>(<a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#ae9a4f1d1b8296da77a74cf2da28a528c">demoName</a>))</div><div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;            {</div><div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;                <span class="keywordflow">break</span>;  <span class="comment">// file doesn&#39;t exist</span></div><div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;            }</div><div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;        }</div><div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;    }</div><div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;</div><div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;    <a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#af6dffe71c8e672577be691d5b32bd8d3">demoFile</a> = <a class="code" href="files_8c.html#a98c0382e75450c34c712641754787708">FS_FOpenFileWrite</a>(<a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#ae9a4f1d1b8296da77a74cf2da28a528c">demoName</a>);</div><div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#af6dffe71c8e672577be691d5b32bd8d3">demoFile</a>)</div><div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;    {</div><div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;        <a class="code" href="cg__main_8c.html#ac5a47034a0c2a1c1eba5f1acd22987a2">Com_Printf</a>(<span class="stringliteral">&quot;DEMO: ERROR: Couldn&#39;t open %s for writing.\n&quot;</span>, <a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#ae9a4f1d1b8296da77a74cf2da28a528c">demoName</a>);</div><div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;    }</div><div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;</div><div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;    <a class="code" href="sv__demo_8c.html#a5cbe2abcce3bd42a5391d98791abb056">SV_DemoStartRecord</a>();</div><div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;}</div><div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;</div><div class="line"><a name="l02019"></a><span class="lineno"><a class="line" href="sv__demo_8c.html#ab12739ae66c61231b78135e511331563"> 2019</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="sv__demo_8c.html#ab12739ae66c61231b78135e511331563">SV_Demo_Play_f</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;{</div><div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;    <span class="keywordtype">char</span> *arg;</div><div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;</div><div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="cmd_8c.html#aaf7e5eaecf2386bacf67dafb8cdcba33">Cmd_Argc</a>() != 2)</div><div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;    {</div><div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;        <a class="code" href="cg__main_8c.html#ac5a47034a0c2a1c1eba5f1acd22987a2">Com_Printf</a>(<span class="stringliteral">&quot;Usage: demo_play &lt;demoname&gt;\n&quot;</span>);</div><div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;    }</div><div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;</div><div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#a66e3cb8a5905f2e1e9d8c89fcc2b2dc9">demoState</a> != <a class="code" href="q__shared_8h.html#aeaa898bef6b376f572e5e59d943d78b2a7c568dd37665684d045c4d40b0553a9c">DS_NONE</a> &amp;&amp; <a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#a66e3cb8a5905f2e1e9d8c89fcc2b2dc9">demoState</a> != <a class="code" href="q__shared_8h.html#aeaa898bef6b376f572e5e59d943d78b2a532cc227a9fbfa28f3a3f417f5fb1944">DS_WAITINGPLAYBACK</a>)</div><div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;    {</div><div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;        <a class="code" href="cg__main_8c.html#ac5a47034a0c2a1c1eba5f1acd22987a2">Com_Printf</a>(<span class="stringliteral">&quot;A demo is already being recorded/played. Use demo_stop and retry.\n&quot;</span>);</div><div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;    }</div><div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;</div><div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;    <span class="comment">// check for an extension .svdm_?? (?? is protocol)</span></div><div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;    arg = <a class="code" href="cmd_8c.html#a1734574e90e7819673500355d4758877">Cmd_Argv</a>(1);</div><div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;    <span class="keywordflow">if</span> (!strcmp(arg + strlen(arg) - 6, <a class="code" href="dl__local_8h.html#a2f2251d7d64d4c9ec69520b953f68bb9">va</a>(<span class="stringliteral">&quot;.%s%d&quot;</span>, <a class="code" href="q__shared_8h.html#ace81fe40472a49aacabe17f75dc443ee">SVDEMOEXT</a>, <a class="code" href="qcommon_8h.html#a277f7abca2044f354abe265252cb9252">PROTOCOL_VERSION</a>)))</div><div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;    {</div><div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;        <a class="code" href="q__shared_8c.html#aad4e641649a5bcf8bb21fbe7a815ee98">Com_sprintf</a>(<a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#ae9a4f1d1b8296da77a74cf2da28a528c">demoName</a>, <span class="keyword">sizeof</span>(<a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#ae9a4f1d1b8296da77a74cf2da28a528c">demoName</a>), <span class="stringliteral">&quot;svdemos/%s&quot;</span>, arg);</div><div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;    }</div><div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;    {</div><div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;        <a class="code" href="q__shared_8c.html#aad4e641649a5bcf8bb21fbe7a815ee98">Com_sprintf</a>(<a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#ae9a4f1d1b8296da77a74cf2da28a528c">demoName</a>, <span class="keyword">sizeof</span>(<a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#ae9a4f1d1b8296da77a74cf2da28a528c">demoName</a>), <span class="stringliteral">&quot;svdemos/%s.%s%d&quot;</span>, arg, <a class="code" href="q__shared_8h.html#ace81fe40472a49aacabe17f75dc443ee">SVDEMOEXT</a>, <a class="code" href="qcommon_8h.html#a277f7abca2044f354abe265252cb9252">PROTOCOL_VERSION</a>);</div><div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;    }</div><div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;</div><div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;    <span class="comment">//FS_FileExists(sv.demoName);</span></div><div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;    <a class="code" href="files_8c.html#ae4fa3825c09365feb036e9712f554cab">FS_FOpenFileRead</a>(<a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#ae9a4f1d1b8296da77a74cf2da28a528c">demoName</a>, &amp;<a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#af6dffe71c8e672577be691d5b32bd8d3">demoFile</a>, <a class="code" href="q__shared_8h.html#a110846a9664bbd925f955266e60e9136a9a60e3a3b7123e30c470bd5823cde09d">qtrue</a>);</div><div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#af6dffe71c8e672577be691d5b32bd8d3">demoFile</a>)</div><div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;    {</div><div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;        <a class="code" href="cg__main_8c.html#ac5a47034a0c2a1c1eba5f1acd22987a2">Com_Printf</a>(<span class="stringliteral">&quot;ERROR: Couldn&#39;t open %s for reading.\n&quot;</span>, <a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#ae9a4f1d1b8296da77a74cf2da28a528c">demoName</a>);</div><div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;    }</div><div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;</div><div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;    <a class="code" href="sv__demo_8c.html#afdffb6076d624c8106be5546856c442c">SV_DemoStartPlayback</a>();</div><div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;}</div><div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;</div><div class="line"><a name="l02060"></a><span class="lineno"><a class="line" href="sv__demo_8c.html#a4c7653cdc5eb5ff4b0faf0bd4d1a87dd"> 2060</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="sv__demo_8c.html#a4c7653cdc5eb5ff4b0faf0bd4d1a87dd">SV_Demo_Stop_f</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;{</div><div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a>.<a class="code" href="structserver__t.html#a66e3cb8a5905f2e1e9d8c89fcc2b2dc9">demoState</a> == <a class="code" href="q__shared_8h.html#aeaa898bef6b376f572e5e59d943d78b2a7c568dd37665684d045c4d40b0553a9c">DS_NONE</a>)</div><div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;    {</div><div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;        <a class="code" href="cg__main_8c.html#ac5a47034a0c2a1c1eba5f1acd22987a2">Com_Printf</a>(<span class="stringliteral">&quot;No demo is currently being recorded or played.\n&quot;</span>);</div><div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;    }</div><div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;</div><div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;    <a class="code" href="sv__demo_8c.html#a8fe5acd248eb0ad72f98008fc25dc3bf">SV_DemoStopAll</a>();</div><div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;}</div><div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;</div><div class="line"><a name="l02076"></a><span class="lineno"><a class="line" href="sv__demo_8c.html#a25ef0f2e94637786927c43103dd9e5a4"> 2076</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="sv__demo_8c.html#a25ef0f2e94637786927c43103dd9e5a4">SV_CompleteDemoName</a>(<span class="keywordtype">char</span> *args, <span class="keywordtype">int</span> argNum)</div><div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;{</div><div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;    <span class="keywordflow">if</span> (argNum == 2)</div><div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;    {</div><div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;        <span class="keywordtype">char</span> demoExt[16];</div><div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;</div><div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;        <a class="code" href="q__shared_8c.html#aad4e641649a5bcf8bb21fbe7a815ee98">Com_sprintf</a>(demoExt, <span class="keyword">sizeof</span>(demoExt), <span class="stringliteral">&quot;.%s%d&quot;</span>, <a class="code" href="q__shared_8h.html#ace81fe40472a49aacabe17f75dc443ee">SVDEMOEXT</a>, <a class="code" href="qcommon_8h.html#a277f7abca2044f354abe265252cb9252">PROTOCOL_VERSION</a>);</div><div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;        <a class="code" href="common_8c.html#a5b18ecdac4d5688915148b2570c518fe">Field_CompleteFilename</a>(<span class="stringliteral">&quot;svdemos&quot;</span>, demoExt, <a class="code" href="q__shared_8h.html#a110846a9664bbd925f955266e60e9136a9a60e3a3b7123e30c470bd5823cde09d">qtrue</a>, <a class="code" href="q__shared_8h.html#a110846a9664bbd925f955266e60e9136a9a60e3a3b7123e30c470bd5823cde09d">qtrue</a>);</div><div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;    }</div><div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;}</div><div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;</div><div class="line"><a name="l02090"></a><span class="lineno"><a class="line" href="sv__demo_8c.html#add33d5c852338d8b242e70aa80ccf70d"> 2090</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="sv__demo_8c.html#add33d5c852338d8b242e70aa80ccf70d">SV_DemoInit</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;{</div><div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;    <a class="code" href="qcommon_8h.html#a0cdfe37e6e2062d76073a542ad2e66f4">Cmd_AddCommand</a>(<span class="stringliteral">&quot;demo_record&quot;</span>, <a class="code" href="sv__demo_8c.html#a4746034bb9e2d789bcecb74b26912eb0">SV_Demo_Record_f</a>, <span class="stringliteral">&quot;Starts demo recording.&quot;</span>);</div><div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;    <a class="code" href="qcommon_8h.html#a0cdfe37e6e2062d76073a542ad2e66f4">Cmd_AddCommand</a>(<span class="stringliteral">&quot;demo_play&quot;</span>, <a class="code" href="sv__demo_8c.html#ab12739ae66c61231b78135e511331563">SV_Demo_Play_f</a>, <span class="stringliteral">&quot;Plays a demo record.&quot;</span>, <a class="code" href="sv__demo_8c.html#a25ef0f2e94637786927c43103dd9e5a4">SV_CompleteDemoName</a>);</div><div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;    <a class="code" href="qcommon_8h.html#a0cdfe37e6e2062d76073a542ad2e66f4">Cmd_AddCommand</a>(<span class="stringliteral">&quot;demo_stop&quot;</span>, <a class="code" href="sv__demo_8c.html#a4c7653cdc5eb5ff4b0faf0bd4d1a87dd">SV_Demo_Stop_f</a>, <span class="stringliteral">&quot;Stops a demo record.&quot;</span>);</div><div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;}</div><div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;</div><div class="line"><a name="l02100"></a><span class="lineno"><a class="line" href="sv__demo_8c.html#ac2df805abc2d8b1abfe9958f0376b0ff"> 2100</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="sv__demo_8c.html#ac2df805abc2d8b1abfe9958f0376b0ff">SV_DemoShutdown</a>(<span class="keywordtype">void</span>) <span class="comment">// FIXME: don&#39;t remove these on server shutdown/demo end so listen servers can start another demo and server owners too</span></div><div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;{</div><div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;    <a class="code" href="cmd_8c.html#a93726aad83fc281293e890274ae75dde">Cmd_RemoveCommand</a>(<span class="stringliteral">&quot;demo_record&quot;</span>);</div><div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;    <a class="code" href="cmd_8c.html#a93726aad83fc281293e890274ae75dde">Cmd_RemoveCommand</a>(<span class="stringliteral">&quot;demo_play&quot;</span>);</div><div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;    <a class="code" href="cmd_8c.html#a93726aad83fc281293e890274ae75dde">Cmd_RemoveCommand</a>(<span class="stringliteral">&quot;demo_stop&quot;</span>);</div><div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;}</div><div class="ttc" id="server_8h_html_a769d6e0a0fa0371353825fb0f1bac988"><div class="ttname"><a href="server_8h.html#a769d6e0a0fa0371353825fb0f1bac988">gvm</a></div><div class="ttdeci">vm_t * gvm</div><div class="ttdoc">game virtual machine </div><div class="ttdef"><b>Definition:</b> <a href="sv__main_8c_source.html#l00039">sv_main.c:39</a></div></div>
<div class="ttc" id="structqtime__s_html_a53c431dc2e4ec3fe75e5709c39537d2e"><div class="ttname"><a href="structqtime__s.html#a53c431dc2e4ec3fe75e5709c39537d2e">qtime_s::tm_min</a></div><div class="ttdeci">int tm_min</div><div class="ttdoc">minutes after the hour - [0,59] </div><div class="ttdef"><b>Definition:</b> <a href="q__shared_8h_source.html#l01612">q_shared.h:1612</a></div></div>
<div class="ttc" id="sv__demo_8c_html_aa6c595b76b700169003ada70b27a546b"><div class="ttname"><a href="sv__demo_8c.html#aa6c595b76b700169003ada70b27a546b">Q_IsColorStringGameCommand</a></div><div class="ttdeci">#define Q_IsColorStringGameCommand(p)</div><div class="ttdef"><b>Definition:</b> <a href="sv__demo_8c_source.html#l00041">sv_demo.c:41</a></div></div>
<div class="ttc" id="sv__demo_8c_html_a85e89000c3c7d3a6a54bda8b7f157c5e"><div class="ttname"><a href="sv__demo_8c.html#a85e89000c3c7d3a6a54bda8b7f157c5e">savedFraglimit</a></div><div class="ttdeci">static int savedFraglimit</div><div class="ttdef"><b>Definition:</b> <a href="sv__demo_8c_source.html#l00083">sv_demo.c:83</a></div></div>
<div class="ttc" id="bg__public_8h_html_a8e2a64110eeed77727d53d171fd756c7a0559b8be47dcc4828304030d8c62f5b9"><div class="ttname"><a href="bg__public_8h.html#a8e2a64110eeed77727d53d171fd756c7a0559b8be47dcc4828304030d8c62f5b9">GT_COOP</a></div><div class="ttdoc">obsolete </div><div class="ttdef"><b>Definition:</b> <a href="bg__public_8h_source.html#l00437">bg_public.h:437</a></div></div>
<div class="ttc" id="sv__demo_8c_html_a857bf754749bfac22ce3930b8d719e31"><div class="ttname"><a href="sv__demo_8c.html#a857bf754749bfac22ce3930b8d719e31">SV_DemoReadClientCommand</a></div><div class="ttdeci">static void SV_DemoReadClientCommand(msg_t *msg)</div><div class="ttdoc">Replay a client command. </div><div class="ttdef"><b>Definition:</b> <a href="sv__demo_8c_source.html#l01374">sv_demo.c:1374</a></div></div>
<div class="ttc" id="sv__demo_8c_html_ace360dcbf25cac744f9367ca438b4f30"><div class="ttname"><a href="sv__demo_8c.html#ace360dcbf25cac744f9367ca438b4f30">SV_DemoReadRefreshPlayersHealth</a></div><div class="ttdeci">void SV_DemoReadRefreshPlayersHealth(void)</div><div class="ttdoc">Update all demoplayers health (will be reflected on the HUD when spectated - for team overlay see tin...</div><div class="ttdef"><b>Definition:</b> <a href="sv__demo_8c_source.html#l01779">sv_demo.c:1779</a></div></div>
<div class="ttc" id="structsharedEntity__t_html_a465868be7e097c59e30eb820fb890822"><div class="ttname"><a href="structsharedEntity__t.html#a465868be7e097c59e30eb820fb890822">sharedEntity_t::r</a></div><div class="ttdeci">entityShared_t r</div><div class="ttdoc">shared by both the server system and game </div><div class="ttdef"><b>Definition:</b> <a href="g__public_8h_source.html#l00095">g_public.h:95</a></div></div>
<div class="ttc" id="q__shared_8h_html_abd4ae30fcfdcbbff51bbf3f4e6daeee7"><div class="ttname"><a href="q__shared_8h.html#abd4ae30fcfdcbbff51bbf3f4e6daeee7">MAX_QPATH</a></div><div class="ttdeci">#define MAX_QPATH</div><div class="ttdoc">max length of a quake game pathname </div><div class="ttdef"><b>Definition:</b> <a href="q__shared_8h_source.html#l00451">q_shared.h:451</a></div></div>
<div class="ttc" id="sv__demo_8c_html_a556c369cb3706595a0068e2de9e9d7db"><div class="ttname"><a href="sv__demo_8c.html#a556c369cb3706595a0068e2de9e9d7db">SV_CheckLastCmd</a></div><div class="ttdeci">qboolean SV_CheckLastCmd(const char *cmd, qboolean onlyStore)</div><div class="ttdoc">Check and store the last command and compare it with the current one, to avoid duplicates. If onlyStore is true, it will only store the new cmd, without checking. </div><div class="ttdef"><b>Definition:</b> <a href="sv__demo_8c_source.html#l00258">sv_demo.c:258</a></div></div>
<div class="ttc" id="cg__main_8c_html_ab77f32d4cdc361616b0daa01e5f709da"><div class="ttname"><a href="cg__main_8c.html#ab77f32d4cdc361616b0daa01e5f709da">Com_Error</a></div><div class="ttdeci">void QDECL Com_Error(int code, const char *error,...)</div><div class="ttdoc">Com_Error. </div><div class="ttdef"><b>Definition:</b> <a href="cg__main_8c_source.html#l00920">cg_main.c:920</a></div></div>
<div class="ttc" id="structserverStatic__t_html_a7f46475a8a4d8c8c140b9022d6476041"><div class="ttname"><a href="structserverStatic__t.html#a7f46475a8a4d8c8c140b9022d6476041">serverStatic_t::time</a></div><div class="ttdeci">int time</div><div class="ttdoc">will be strictly increasing across level changes </div><div class="ttdef"><b>Definition:</b> <a href="server_8h_source.html#l00366">server.h:366</a></div></div>
<div class="ttc" id="qcommon_8h_html_a0cdfe37e6e2062d76073a542ad2e66f4"><div class="ttname"><a href="qcommon_8h.html#a0cdfe37e6e2062d76073a542ad2e66f4">Cmd_AddCommand</a></div><div class="ttdeci">#define Cmd_AddCommand(...)</div><div class="ttdef"><b>Definition:</b> <a href="qcommon_8h_source.html#l00582">qcommon.h:582</a></div></div>
<div class="ttc" id="q__shared_8h_html_aae573e3e6a2cbf05f3485f215403c9c2a1c6bf755d394a50c551150ea2135c551"><div class="ttname"><a href="q__shared_8h.html#aae573e3e6a2cbf05f3485f215403c9c2a1c6bf755d394a50c551150ea2135c551">ERR_DROP</a></div><div class="ttdoc">print to console and disconnect from game </div><div class="ttdef"><b>Definition:</b> <a href="q__shared_8h_source.html#l00520">q_shared.h:520</a></div></div>
<div class="ttc" id="g__public_8h_html_a73fae99264a6d9a1cf7e7aee493b27d5a1228e2de051fef0020329a96c592466a"><div class="ttname"><a href="g__public_8h.html#a73fae99264a6d9a1cf7e7aee493b27d5a1228e2de051fef0020329a96c592466a">GAME_CLIENT_BEGIN</a></div><div class="ttdoc">( int clientNum ); </div><div class="ttdef"><b>Definition:</b> <a href="g__public_8h_source.html#l00286">g_public.h:286</a></div></div>
<div class="ttc" id="structserver__t_html_a75f2b31ea80a25242aa46b8dd3d70d1b"><div class="ttname"><a href="structserver__t.html#a75f2b31ea80a25242aa46b8dd3d70d1b">server_t::demoEntities</a></div><div class="ttdeci">sharedEntity_t demoEntities[MAX_GENTITIES]</div><div class="ttdef"><b>Definition:</b> <a href="server_8h_source.html#l00149">server.h:149</a></div></div>
<div class="ttc" id="sv__demo_8c_html_a13d0409732f14929c72828f0c9db0343"><div class="ttname"><a href="sv__demo_8c.html#a13d0409732f14929c72828f0c9db0343">SV_DemoPlaybackError</a></div><div class="ttdeci">static void SV_DemoPlaybackError(const char *message)</div><div class="ttdoc">Call this to abort the demo play by error. </div><div class="ttdef"><b>Definition:</b> <a href="sv__demo_8c_source.html#l00918">sv_demo.c:918</a></div></div>
<div class="ttc" id="q__shared_8h_html_aeaa898bef6b376f572e5e59d943d78b2a7c568dd37665684d045c4d40b0553a9c"><div class="ttname"><a href="q__shared_8h.html#aeaa898bef6b376f572e5e59d943d78b2a7c568dd37665684d045c4d40b0553a9c">DS_NONE</a></div><div class="ttdef"><b>Definition:</b> <a href="q__shared_8h_source.html#l01652">q_shared.h:1652</a></div></div>
<div class="ttc" id="files_8c_html_a98c0382e75450c34c712641754787708"><div class="ttname"><a href="files_8c.html#a98c0382e75450c34c712641754787708">FS_FOpenFileWrite</a></div><div class="ttdeci">fileHandle_t FS_FOpenFileWrite(const char *fileName)</div><div class="ttdoc">FS_FOpenFileWrite. </div><div class="ttdef"><b>Definition:</b> <a href="files_8c_source.html#l01084">files.c:1084</a></div></div>
<div class="ttc" id="sv__demo_8c_html_a4746034bb9e2d789bcecb74b26912eb0"><div class="ttname"><a href="sv__demo_8c.html#a4746034bb9e2d789bcecb74b26912eb0">SV_Demo_Record_f</a></div><div class="ttdeci">static void SV_Demo_Record_f(void)</div><div class="ttdoc">SV_Demo_Record_f. </div><div class="ttdef"><b>Definition:</b> <a href="sv__demo_8c_source.html#l01961">sv_demo.c:1961</a></div></div>
<div class="ttc" id="msg_8c_html_a895c6fc8d885fe5641e76185abef53a0"><div class="ttname"><a href="msg_8c.html#a895c6fc8d885fe5641e76185abef53a0">MSG_ReadDeltaSharedEntity</a></div><div class="ttdeci">void MSG_ReadDeltaSharedEntity(msg_t *msg, void *from, void *to, int number)</div><div class="ttdoc">MSG_ReadDeltaSharedEntity. </div><div class="ttdef"><b>Definition:</b> <a href="msg_8c_source.html#l01766">msg.c:1766</a></div></div>
<div class="ttc" id="structplayerState__s_html"><div class="ttname"><a href="structplayerState__s.html">playerState_s</a></div><div class="ttdef"><b>Definition:</b> <a href="q__shared_8h_source.html#l01093">q_shared.h:1093</a></div></div>
<div class="ttc" id="structqtime__s_html_a86d4d9b3464d9cba2fc41a80646857cc"><div class="ttname"><a href="structqtime__s.html#a86d4d9b3464d9cba2fc41a80646857cc">qtime_s::tm_mday</a></div><div class="ttdeci">int tm_mday</div><div class="ttdoc">day of the month - [1,31] </div><div class="ttdef"><b>Definition:</b> <a href="q__shared_8h_source.html#l01614">q_shared.h:1614</a></div></div>
<div class="ttc" id="sv__demo_8c_html_af2bc2d94afb470315c0786124a2fdc31a8829120824b95d7ac3fd0b727d6d7550"><div class="ttname"><a href="sv__demo_8c.html#af2bc2d94afb470315c0786124a2fdc31a8829120824b95d7ac3fd0b727d6d7550">demo_gameCommand</a></div><div class="ttdef"><b>Definition:</b> <a href="sv__demo_8c_source.html#l00059">sv_demo.c:59</a></div></div>
<div class="ttc" id="sv__demo_8c_html_a95c238fae64c45718ef4e2ec2dbcb7cb"><div class="ttname"><a href="sv__demo_8c.html#a95c238fae64c45718ef4e2ec2dbcb7cb">savedPlaybackDemonameVal</a></div><div class="ttdeci">static char savedPlaybackDemonameVal[MAX_QPATH]</div><div class="ttdef"><b>Definition:</b> <a href="sv__demo_8c_source.html#l00089">sv_demo.c:89</a></div></div>
<div class="ttc" id="bg__public_8h_html_a5d3c87f6de9e1f3a5adb0649d6f480be"><div class="ttname"><a href="bg__public_8h.html#a5d3c87f6de9e1f3a5adb0649d6f480be">SVF_BOT</a></div><div class="ttdeci">#define SVF_BOT</div><div class="ttdef"><b>Definition:</b> <a href="bg__public_8h_source.html#l00141">bg_public.h:141</a></div></div>
<div class="ttc" id="structnetchan__t_html_accc89940b6f4bebbd1b70cfaa94ae0e9"><div class="ttname"><a href="structnetchan__t.html#accc89940b6f4bebbd1b70cfaa94ae0e9">netchan_t::remoteAddress</a></div><div class="ttdeci">netadr_t remoteAddress</div><div class="ttdef"><b>Definition:</b> <a href="qcommon_8h_source.html#l00276">qcommon.h:276</a></div></div>
<div class="ttc" id="sv__demo_8c_html_a3be8030f70d69bd57596786aaf19b572"><div class="ttname"><a href="sv__demo_8c.html#a3be8030f70d69bd57596786aaf19b572">savedCapturelimit</a></div><div class="ttdeci">static int savedCapturelimit</div><div class="ttdef"><b>Definition:</b> <a href="sv__demo_8c_source.html#l00084">sv_demo.c:84</a></div></div>
<div class="ttc" id="sv__demo_8c_html_af2bc2d94afb470315c0786124a2fdc31a4ae848aa842475d53d1bf51d11f5324c"><div class="ttname"><a href="sv__demo_8c.html#af2bc2d94afb470315c0786124a2fdc31a4ae848aa842475d53d1bf51d11f5324c">demo_clientCommand</a></div><div class="ttdef"><b>Definition:</b> <a href="sv__demo_8c_source.html#l00057">sv_demo.c:57</a></div></div>
<div class="ttc" id="sv__demo_8c_html_a969169e99a911b6986af6c45ace955ff"><div class="ttname"><a href="sv__demo_8c.html#a969169e99a911b6986af6c45ace955ff">savedFsGameVal</a></div><div class="ttdeci">static char savedFsGameVal[MAX_QPATH]</div><div class="ttdef"><b>Definition:</b> <a href="sv__demo_8c_source.html#l00086">sv_demo.c:86</a></div></div>
<div class="ttc" id="sv__demo_8c_html_ae1276ebee179d6adbfacf85164ac6c56"><div class="ttname"><a href="sv__demo_8c.html#ae1276ebee179d6adbfacf85164ac6c56">SV_DemoReadServerCommand</a></div><div class="ttdeci">static void SV_DemoReadServerCommand(msg_t *msg)</div><div class="ttdoc">Replay a server command. </div><div class="ttdef"><b>Definition:</b> <a href="sv__demo_8c_source.html#l01392">sv_demo.c:1392</a></div></div>
<div class="ttc" id="sv__demo_8c_html_a3f3666cfadf0a34792d803d256675d20"><div class="ttname"><a href="sv__demo_8c.html#a3f3666cfadf0a34792d803d256675d20">savedTimelimit</a></div><div class="ttdeci">static int savedTimelimit</div><div class="ttdef"><b>Definition:</b> <a href="sv__demo_8c_source.html#l00082">sv_demo.c:82</a></div></div>
<div class="ttc" id="sv__demo_8c_html_af2bc2d94afb470315c0786124a2fdc31a2408c8938e204b6ab01b8d830d5b1c2c"><div class="ttname"><a href="sv__demo_8c.html#af2bc2d94afb470315c0786124a2fdc31a2408c8938e204b6ab01b8d830d5b1c2c">demo_playerState</a></div><div class="ttdef"><b>Definition:</b> <a href="sv__demo_8c_source.html#l00063">sv_demo.c:63</a></div></div>
<div class="ttc" id="server_8h_html_a69fbe770061af3f2aabc5e74ea822d71"><div class="ttname"><a href="server_8h.html#a69fbe770061af3f2aabc5e74ea822d71">SV_LinkEntity</a></div><div class="ttdeci">void SV_LinkEntity(sharedEntity_t *gEnt)</div><div class="ttdoc">SV_LinkEntity. </div><div class="ttdef"><b>Definition:</b> <a href="sv__world_8c_source.html#l00220">sv_world.c:220</a></div></div>
<div class="ttc" id="q__shared_8h_html_a331d56054b8d2cc3b4be5aaa79f9258c"><div class="ttname"><a href="q__shared_8h.html#a331d56054b8d2cc3b4be5aaa79f9258c">Com_Memset</a></div><div class="ttdeci">#define Com_Memset</div><div class="ttdef"><b>Definition:</b> <a href="q__shared_8h_source.html#l00575">q_shared.h:575</a></div></div>
<div class="ttc" id="q__shared_8h_html_adf9097a01af0067c10d749471dbdbe34"><div class="ttname"><a href="q__shared_8h.html#adf9097a01af0067c10d749471dbdbe34">MAX_STRING_CHARS</a></div><div class="ttdeci">#define MAX_STRING_CHARS</div><div class="ttdoc">max length of a string passed to Cmd_TokenizeString </div><div class="ttdef"><b>Definition:</b> <a href="q__shared_8h_source.html#l00437">q_shared.h:437</a></div></div>
<div class="ttc" id="server_8h_html_adc644fa8b6a89575ee9bff23cf07418d"><div class="ttname"><a href="server_8h.html#adc644fa8b6a89575ee9bff23cf07418d">SV_GameSendServerCommand</a></div><div class="ttdeci">void SV_GameSendServerCommand(int clientNum, const char *text)</div><div class="ttdoc">Sends a command string to a client. </div><div class="ttdef"><b>Definition:</b> <a href="sv__game_8c_source.html#l00115">sv_game.c:115</a></div></div>
<div class="ttc" id="sv__demo_8c_html_afdffb6076d624c8106be5546856c442c"><div class="ttname"><a href="sv__demo_8c.html#afdffb6076d624c8106be5546856c442c">SV_DemoStartPlayback</a></div><div class="ttdeci">static void SV_DemoStartPlayback(void)</div><div class="ttdoc">Start the playback of a demo. </div><div class="ttdef"><b>Definition:</b> <a href="sv__demo_8c_source.html#l00954">sv_demo.c:954</a></div></div>
<div class="ttc" id="common_8c_html_a0dc3b8737b9c0dd5fc582a4c03c60332"><div class="ttname"><a href="common_8c.html#a0dc3b8737b9c0dd5fc582a4c03c60332">com_sv_running</a></div><div class="ttdeci">cvar_t * com_sv_running</div><div class="ttdef"><b>Definition:</b> <a href="common_8c_source.html#l00109">common.c:109</a></div></div>
<div class="ttc" id="msg_8c_html_adbb199f1fac9e30684b996143a907a5b"><div class="ttname"><a href="msg_8c.html#adbb199f1fac9e30684b996143a907a5b">MSG_ReadByte</a></div><div class="ttdeci">int MSG_ReadByte(msg_t *msg)</div><div class="ttdoc">MSG_ReadByte. </div><div class="ttdef"><b>Definition:</b> <a href="msg_8c_source.html#l00648">msg.c:648</a></div></div>
<div class="ttc" id="server_8h_html_af99c33a2388290021601a4b4f192876e"><div class="ttname"><a href="server_8h.html#af99c33a2388290021601a4b4f192876e">sv_hostname</a></div><div class="ttdeci">cvar_t * sv_hostname</div><div class="ttdef"><b>Definition:</b> <a href="sv__main_8c_source.html#l00051">sv_main.c:51</a></div></div>
<div class="ttc" id="server_8h_html_a13c22272e1091e3df00ee97b9ed3ac10"><div class="ttname"><a href="server_8h.html#a13c22272e1091e3df00ee97b9ed3ac10">SV_UpdateUserinfo_f</a></div><div class="ttdeci">void SV_UpdateUserinfo_f(client_t *cl)</div><div class="ttdoc">SV_UpdateUserinfo_f. </div><div class="ttdef"><b>Definition:</b> <a href="sv__client_8c_source.html#l01730">sv_client.c:1730</a></div></div>
<div class="ttc" id="structmsg__t_html_adf44d2010aefea14afec18978b23044e"><div class="ttname"><a href="structmsg__t.html#adf44d2010aefea14afec18978b23044e">msg_t::readcount</a></div><div class="ttdeci">int readcount</div><div class="ttdef"><b>Definition:</b> <a href="qcommon_8h_source.html#l00065">qcommon.h:65</a></div></div>
<div class="ttc" id="structserver__t_html_ae9a4f1d1b8296da77a74cf2da28a528c"><div class="ttname"><a href="structserver__t.html#ae9a4f1d1b8296da77a74cf2da28a528c">server_t::demoName</a></div><div class="ttdeci">char demoName[MAX_QPATH]</div><div class="ttdef"><b>Definition:</b> <a href="server_8h_source.html#l00146">server.h:146</a></div></div>
<div class="ttc" id="sv__demo_8c_html_af2bc2d94afb470315c0786124a2fdc31a33f59650efb74b3a4305f11883698a02"><div class="ttname"><a href="sv__demo_8c.html#af2bc2d94afb470315c0786124a2fdc31a33f59650efb74b3a4305f11883698a02">demo_endFrame</a></div><div class="ttdef"><b>Definition:</b> <a href="sv__demo_8c_source.html#l00053">sv_demo.c:53</a></div></div>
<div class="ttc" id="msg_8c_html_a68ffe035e640c51060ff51147112d015"><div class="ttname"><a href="msg_8c.html#a68ffe035e640c51060ff51147112d015">MSG_WriteLong</a></div><div class="ttdeci">void MSG_WriteLong(msg_t *msg, int c)</div><div class="ttdoc">MSG_WriteLong. </div><div class="ttdef"><b>Definition:</b> <a href="msg_8c_source.html#l00482">msg.c:482</a></div></div>
<div class="ttc" id="sv__demo_8c_html_aecf518b2e15f81a605d80713408c161b"><div class="ttname"><a href="sv__demo_8c.html#aecf518b2e15f81a605d80713408c161b">SV_DemoWriteFrame</a></div><div class="ttdeci">void SV_DemoWriteFrame(void)</div><div class="ttdoc">Record all the entities (gentities fields) and players (player_t fields) at the end of every frame (t...</div><div class="ttdef"><b>Definition:</b> <a href="sv__demo_8c_source.html#l00776">sv_demo.c:776</a></div></div>
<div class="ttc" id="sv__demo_8c_html_aca7339ca663e4f8f7bf4218dd9a714c5"><div class="ttname"><a href="sv__demo_8c.html#aca7339ca663e4f8f7bf4218dd9a714c5">SV_DemoWriteMessage</a></div><div class="ttdeci">static void SV_DemoWriteMessage(msg_t *msg)</div><div class="ttdoc">Write a message/event to the demo file. </div><div class="ttdef"><b>Definition:</b> <a href="sv__demo_8c_source.html#l00422">sv_demo.c:422</a></div></div>
<div class="ttc" id="structclient__s_html_a8a8cc9e2fab9730c092047434e73eff5"><div class="ttname"><a href="structclient__s.html#a8a8cc9e2fab9730c092047434e73eff5">client_s::userinfo</a></div><div class="ttdeci">char userinfo[MAX_INFO_STRING]</div><div class="ttdoc">name, etc </div><div class="ttdef"><b>Definition:</b> <a href="server_8h_source.html#l00206">server.h:206</a></div></div>
<div class="ttc" id="msg_8c_html_aa78e4a13e042f3abe51215857148f00f"><div class="ttname"><a href="msg_8c.html#aa78e4a13e042f3abe51215857148f00f">MSG_ReadDeltaEntity</a></div><div class="ttdeci">void MSG_ReadDeltaEntity(msg_t *msg, entityState_t *from, entityState_t *to, int number)</div><div class="ttdoc">The entity number has already been read from the message, which is how the from state is identified...</div><div class="ttdef"><b>Definition:</b> <a href="msg_8c_source.html#l01430">msg.c:1430</a></div></div>
<div class="ttc" id="sv__demo_8c_html_a91118323f8771a34cc42f63aa7fe3cc9"><div class="ttname"><a href="sv__demo_8c.html#a91118323f8771a34cc42f63aa7fe3cc9">savedPlaybackDemoname</a></div><div class="ttdeci">static char * savedPlaybackDemoname</div><div class="ttdef"><b>Definition:</b> <a href="sv__demo_8c_source.html#l00090">sv_demo.c:90</a></div></div>
<div class="ttc" id="sv__demo_8c_html_af2bc2d94afb470315c0786124a2fdc31a28877e13ad25c44d02526672a825b457"><div class="ttname"><a href="sv__demo_8c.html#af2bc2d94afb470315c0786124a2fdc31a28877e13ad25c44d02526672a825b457">demo_configString</a></div><div class="ttdef"><b>Definition:</b> <a href="sv__demo_8c_source.html#l00055">sv_demo.c:55</a></div></div>
<div class="ttc" id="q__shared_8c_html_a91cce8a6e4157761794c0c88f3396945"><div class="ttname"><a href="q__shared_8c.html#a91cce8a6e4157761794c0c88f3396945">Q_strncmp</a></div><div class="ttdeci">int Q_strncmp(const char *s1, const char *s2, size_t n)</div><div class="ttdoc">Compare strings up to n characters. </div><div class="ttdef"><b>Definition:</b> <a href="q__shared_8c_source.html#l01539">q_shared.c:1539</a></div></div>
<div class="ttc" id="cmd_8c_html_aaf7e5eaecf2386bacf67dafb8cdcba33"><div class="ttname"><a href="cmd_8c.html#aaf7e5eaecf2386bacf67dafb8cdcba33">Cmd_Argc</a></div><div class="ttdeci">int Cmd_Argc(void)</div><div class="ttdoc">Cmd_Argc. </div><div class="ttdef"><b>Definition:</b> <a href="cmd_8c_source.html#l00414">cmd.c:414</a></div></div>
<div class="ttc" id="q__shared_8h_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="q__shared_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="q__shared_8h_source.html#l00417">q_shared.h:417</a></div></div>
<div class="ttc" id="sv__demo_8c_html_a723cda94f53cb8429c006815b6b256d8"><div class="ttname"><a href="sv__demo_8c.html#a723cda94f53cb8429c006815b6b256d8">SV_DemoReadConfigString</a></div><div class="ttdeci">static void SV_DemoReadConfigString(msg_t *msg)</div><div class="ttdoc">Read a configstring from a message and load it into memory. </div><div class="ttdef"><b>Definition:</b> <a href="sv__demo_8c_source.html#l01428">sv_demo.c:1428</a></div></div>
<div class="ttc" id="sv__demo_8c_html_aba182f107f0549b75f5a815795be0815"><div class="ttname"><a href="sv__demo_8c.html#aba182f107f0549b75f5a815795be0815">SV_DemoWriteAllEntityShared</a></div><div class="ttdeci">static void SV_DemoWriteAllEntityShared(void)</div><div class="ttdoc">Write all entities (gentity_t-&gt;entityShared_t) </div><div class="ttdef"><b>Definition:</b> <a href="sv__demo_8c_source.html#l00738">sv_demo.c:738</a></div></div>
<div class="ttc" id="cg__main_8c_html_ac5a47034a0c2a1c1eba5f1acd22987a2"><div class="ttname"><a href="cg__main_8c.html#ac5a47034a0c2a1c1eba5f1acd22987a2">Com_Printf</a></div><div class="ttdeci">void QDECL Com_Printf(const char *msg,...)</div><div class="ttdoc">Com_Printf. </div><div class="ttdef"><b>Definition:</b> <a href="cg__main_8c_source.html#l00936">cg_main.c:936</a></div></div>
<div class="ttc" id="structcvar__s_html_a924de486b6519c65a08d4872b4cd15f8"><div class="ttname"><a href="structcvar__s.html#a924de486b6519c65a08d4872b4cd15f8">cvar_s::value</a></div><div class="ttdeci">float value</div><div class="ttdoc">atof( string ) </div><div class="ttdef"><b>Definition:</b> <a href="q__shared_8h_source.html#l00839">q_shared.h:839</a></div></div>
<div class="ttc" id="files_8c_html_af2f02a32d713bda5d8907bb011c22b75"><div class="ttname"><a href="files_8c.html#af2f02a32d713bda5d8907bb011c22b75">FS_Write</a></div><div class="ttdeci">int FS_Write(const void *buffer, int len, fileHandle_t h)</div><div class="ttdoc">Properly handles partial writes. </div><div class="ttdef"><b>Definition:</b> <a href="files_8c_source.html#l02077">files.c:2077</a></div></div>
<div class="ttc" id="q__shared_8h_html_ab53d05683d8387a66f35e1dfc5edafb9ae73c66220ebe757bbbce0df3a5283636"><div class="ttname"><a href="q__shared_8h.html#ab53d05683d8387a66f35e1dfc5edafb9ae73c66220ebe757bbbce0df3a5283636">TR_LINEAR</a></div><div class="ttdef"><b>Definition:</b> <a href="q__shared_8h_source.html#l01318">q_shared.h:1318</a></div></div>
<div class="ttc" id="structmsg__t_html_a7b8927986fe254f74101628ef88df26c"><div class="ttname"><a href="structmsg__t.html#a7b8927986fe254f74101628ef88df26c">msg_t::maxsize</a></div><div class="ttdeci">int maxsize</div><div class="ttdef"><b>Definition:</b> <a href="qcommon_8h_source.html#l00062">qcommon.h:62</a></div></div>
<div class="ttc" id="files_8c_html_a3c4ec3bde86c3cb7549952febebbbc9b"><div class="ttname"><a href="files_8c.html#a3c4ec3bde86c3cb7549952febebbbc9b">FS_FCloseFile</a></div><div class="ttdeci">void FS_FCloseFile(fileHandle_t f)</div><div class="ttdoc">If the FILE pointer is an open pak file, leave it open. </div><div class="ttdef"><b>Definition:</b> <a href="files_8c_source.html#l01053">files.c:1053</a></div></div>
<div class="ttc" id="sv__demo_8c_html_aa6adb04c0f453de369768eb1cddd9f4a"><div class="ttname"><a href="sv__demo_8c.html#aa6adb04c0f453de369768eb1cddd9f4a">SV_DemoWriteServerCommand</a></div><div class="ttdeci">void SV_DemoWriteServerCommand(const char *cmd)</div><div class="ttdoc">Write a server command to the demo file. </div><div class="ttdef"><b>Definition:</b> <a href="sv__demo_8c_source.html#l00491">sv_demo.c:491</a></div></div>
<div class="ttc" id="cvar_8c_html_a961fe6ab129eda303da513bb4d0ece22"><div class="ttname"><a href="cvar_8c.html#a961fe6ab129eda303da513bb4d0ece22">Cvar_Get</a></div><div class="ttdeci">cvar_t * Cvar_Get(const char *varName, const char *value, int flags)</div><div class="ttdoc">If the variable already exists, the value will not be set unless CVAR_ROM The flags will be or&amp;#39;ed in ...</div><div class="ttdef"><b>Definition:</b> <a href="cvar_8c_source.html#l00409">cvar.c:409</a></div></div>
<div class="ttc" id="msg_8c_html_aa29f5e1e2e54f0a0d72a9bcc692dfae5"><div class="ttname"><a href="msg_8c.html#aa29f5e1e2e54f0a0d72a9bcc692dfae5">MSG_WriteDeltaEntity</a></div><div class="ttdeci">void MSG_WriteDeltaEntity(msg_t *msg, entityState_t *from, entityState_t *to, qboolean force)</div><div class="ttdoc">Writes part of a packetentities message, including the entity number. Can delta from either a baselin...</div><div class="ttdef"><b>Definition:</b> <a href="msg_8c_source.html#l01257">msg.c:1257</a></div></div>
<div class="ttc" id="sv__demo_8c_html_a88fbc53658b1f8c0833176451c609a67"><div class="ttname"><a href="sv__demo_8c.html#a88fbc53658b1f8c0833176451c609a67">SV_DemoCvarsRestore</a></div><div class="ttdeci">static void SV_DemoCvarsRestore()</div><div class="ttdoc">Restores all CVARs. </div><div class="ttdef"><b>Definition:</b> <a href="sv__demo_8c_source.html#l00097">sv_demo.c:97</a></div></div>
<div class="ttc" id="sv__demo_8c_html_a4c7653cdc5eb5ff4b0faf0bd4d1a87dd"><div class="ttname"><a href="sv__demo_8c.html#a4c7653cdc5eb5ff4b0faf0bd4d1a87dd">SV_Demo_Stop_f</a></div><div class="ttdeci">static void SV_Demo_Stop_f(void)</div><div class="ttdoc">SV_Demo_Stop_f. </div><div class="ttdef"><b>Definition:</b> <a href="sv__demo_8c_source.html#l02060">sv_demo.c:2060</a></div></div>
<div class="ttc" id="structmsg__t_html_ab12d572562d7fb2fd9c3a450786e5c33"><div class="ttname"><a href="structmsg__t.html#ab12d572562d7fb2fd9c3a450786e5c33">msg_t::data</a></div><div class="ttdeci">byte * data</div><div class="ttdoc">message content </div><div class="ttdef"><b>Definition:</b> <a href="qcommon_8h_source.html#l00061">qcommon.h:61</a></div></div>
<div class="ttc" id="sv__demo_8c_html_af2bc2d94afb470315c0786124a2fdc31a75fd01e2070256a0617c394331e5ee9f"><div class="ttname"><a href="sv__demo_8c.html#af2bc2d94afb470315c0786124a2fdc31a75fd01e2070256a0617c394331e5ee9f">demo_entityShared</a></div><div class="ttdef"><b>Definition:</b> <a href="sv__demo_8c_source.html#l00062">sv_demo.c:62</a></div></div>
<div class="ttc" id="q__shared_8h_html_a110846a9664bbd925f955266e60e9136"><div class="ttname"><a href="q__shared_8h.html#a110846a9664bbd925f955266e60e9136">qboolean</a></div><div class="ttdeci">qboolean</div><div class="ttdoc">Boolean definition. </div><div class="ttdef"><b>Definition:</b> <a href="q__shared_8h_source.html#l00357">q_shared.h:357</a></div></div>
<div class="ttc" id="server_8h_html_a698d5b1998898dad31ebfeb8983f8746"><div class="ttname"><a href="server_8h.html#a698d5b1998898dad31ebfeb8983f8746">svs</a></div><div class="ttdeci">serverStatic_t svs</div><div class="ttdoc">persistant server info across maps </div><div class="ttdef"><b>Definition:</b> <a href="sv__main_8c_source.html#l00037">sv_main.c:37</a></div></div>
<div class="ttc" id="msg_8c_html_a7931ab57b8c77c161cb63c76155f92ec"><div class="ttname"><a href="msg_8c.html#a7931ab57b8c77c161cb63c76155f92ec">MSG_Clear</a></div><div class="ttdeci">void MSG_Clear(msg_t *buf)</div><div class="ttdoc">MSG_Clear. </div><div class="ttdef"><b>Definition:</b> <a href="msg_8c_source.html#l00106">msg.c:106</a></div></div>
<div class="ttc" id="sv__demo_8c_html_a21441f49ae53a7b13498ec69122910a1"><div class="ttname"><a href="sv__demo_8c.html#a21441f49ae53a7b13498ec69122910a1">SV_DemoFilterClientUserinfo</a></div><div class="ttdeci">void SV_DemoFilterClientUserinfo(char *userinfo)</div><div class="ttdoc">Filters privacy keys from a client userinfo to later write in a demo file. </div><div class="ttdef"><b>Definition:</b> <a href="sv__demo_8c_source.html#l00345">sv_demo.c:345</a></div></div>
<div class="ttc" id="server_8h_html_a7f1a538eff9cab28ecafcf036f68e49d"><div class="ttname"><a href="server_8h.html#a7f1a538eff9cab28ecafcf036f68e49d">SV_GameClientNum</a></div><div class="ttdeci">playerState_t * SV_GameClientNum(int num)</div><div class="ttdoc">SV_GameClientNum. </div><div class="ttdef"><b>Definition:</b> <a href="sv__game_8c_source.html#l00077">sv_game.c:77</a></div></div>
<div class="ttc" id="server_8h_html_a01eb98a830e2ac701458611d582296db"><div class="ttname"><a href="server_8h.html#a01eb98a830e2ac701458611d582296db">sv_mapname</a></div><div class="ttdeci">cvar_t * sv_mapname</div><div class="ttdef"><b>Definition:</b> <a href="sv__main_8c_source.html#l00057">sv_main.c:57</a></div></div>
<div class="ttc" id="sv__demo_8c_html_a08a7dff997b64b706f653d15bf6f6ee0"><div class="ttname"><a href="sv__demo_8c.html#a08a7dff997b64b706f653d15bf6f6ee0">SV_DemoReadAllPlayerState</a></div><div class="ttdeci">static void SV_DemoReadAllPlayerState(msg_t *msg)</div><div class="ttdoc">Read the usercmd_t for a democlient and restituate the movements. </div><div class="ttdef"><b>Definition:</b> <a href="sv__demo_8c_source.html#l01635">sv_demo.c:1635</a></div></div>
<div class="ttc" id="structcvar__s_html_ae873b26596ff98802364d80bbb71c72a"><div class="ttname"><a href="structcvar__s.html#ae873b26596ff98802364d80bbb71c72a">cvar_s::integer</a></div><div class="ttdeci">int integer</div><div class="ttdoc">atoi( string ) </div><div class="ttdef"><b>Definition:</b> <a href="q__shared_8h_source.html#l00840">q_shared.h:840</a></div></div>
<div class="ttc" id="structqtime__s_html"><div class="ttname"><a href="structqtime__s.html">qtime_s</a></div><div class="ttdef"><b>Definition:</b> <a href="q__shared_8h_source.html#l01609">q_shared.h:1609</a></div></div>
<div class="ttc" id="server_8h_html_a20f9c6bea9d6c49b1e7f2e00ecafb273"><div class="ttname"><a href="server_8h.html#a20f9c6bea9d6c49b1e7f2e00ecafb273">SV_GentityNum</a></div><div class="ttdeci">sharedEntity_t * SV_GentityNum(int num)</div><div class="ttdoc">SV_GentityNum. </div><div class="ttdef"><b>Definition:</b> <a href="sv__game_8c_source.html#l00065">sv_game.c:65</a></div></div>
<div class="ttc" id="structserver__t_html_a66e3cb8a5905f2e1e9d8c89fcc2b2dc9"><div class="ttname"><a href="structserver__t.html#a66e3cb8a5905f2e1e9d8c89fcc2b2dc9">server_t::demoState</a></div><div class="ttdeci">demoState_t demoState</div><div class="ttdef"><b>Definition:</b> <a href="server_8h_source.html#l00145">server.h:145</a></div></div>
<div class="ttc" id="structsharedEntity__t_html_a89773b8fde222ad9577e8d9b3504141a"><div class="ttname"><a href="structsharedEntity__t.html#a89773b8fde222ad9577e8d9b3504141a">sharedEntity_t::s</a></div><div class="ttdeci">entityState_t s</div><div class="ttdoc">communicated by server to clients </div><div class="ttdef"><b>Definition:</b> <a href="g__public_8h_source.html#l00094">g_public.h:94</a></div></div>
<div class="ttc" id="net__chan_8c_html_aa6a665a1e1a3a0e2b922df6226e83bae"><div class="ttname"><a href="net__chan_8c.html#aa6a665a1e1a3a0e2b922df6226e83bae">NET_StringToAdr</a></div><div class="ttdeci">int NET_StringToAdr(const char *s, netadr_t *a, netadrtype_t family)</div><div class="ttdoc">Traps &quot;localhost&quot; for loopback, passes everything else to system. </div><div class="ttdef"><b>Definition:</b> <a href="net__chan_8c_source.html#l00733">net_chan.c:733</a></div></div>
<div class="ttc" id="common_8c_html_a2063ee236b7b5b79899a81047e5e0400"><div class="ttname"><a href="common_8c.html#a2063ee236b7b5b79899a81047e5e0400">Com_DPrintf</a></div><div class="ttdeci">void QDECL Com_DPrintf(const char *fmt,...)</div><div class="ttdoc">A Com_Printf that only shows up if the &quot;developer&quot; cvar is set. </div><div class="ttdef"><b>Definition:</b> <a href="common_8c_source.html#l00312">common.c:312</a></div></div>
<div class="ttc" id="structserverStatic__t_html_a7cafb183964315009682fc02b30613d9"><div class="ttname"><a href="structserverStatic__t.html#a7cafb183964315009682fc02b30613d9">serverStatic_t::clients</a></div><div class="ttdeci">client_t * clients</div><div class="ttdoc">[sv_maxclients-&gt;integer]; </div><div class="ttdef"><b>Definition:</b> <a href="server_8h_source.html#l00370">server.h:370</a></div></div>
<div class="ttc" id="sv__demo_8c_html_aef7d3c63cf10e49a020339383214ce81"><div class="ttname"><a href="sv__demo_8c.html#aef7d3c63cf10e49a020339383214ce81">SV_DemoWriteClientConfigString</a></div><div class="ttdeci">static void SV_DemoWriteClientConfigString(int clientNum, const char *cs_string)</div><div class="ttdoc">Write a client configstring to the demo file. </div><div class="ttdef"><b>Definition:</b> <a href="sv__demo_8c_source.html#l00574">sv_demo.c:574</a></div></div>
<div class="ttc" id="q__shared_8h_html_aa684040d7aebb90b780e2169fbe326e9"><div class="ttname"><a href="q__shared_8h.html#aa684040d7aebb90b780e2169fbe326e9">ENTITYNUM_NONE</a></div><div class="ttdeci">#define ENTITYNUM_NONE</div><div class="ttdef"><b>Definition:</b> <a href="q__shared_8h_source.html#l01004">q_shared.h:1004</a></div></div>
<div class="ttc" id="structvmCvar__t_html_a692c1a403e65c64a1f9309bca9f47007"><div class="ttname"><a href="structvmCvar__t.html#a692c1a403e65c64a1f9309bca9f47007">vmCvar_t::integer</a></div><div class="ttdeci">int integer</div><div class="ttdef"><b>Definition:</b> <a href="q__shared_8h_source.html#l00868">q_shared.h:868</a></div></div>
<div class="ttc" id="q__shared_8h_html_a0a8f91f93d75a07f0ae45077db45b3eb"><div class="ttname"><a href="q__shared_8h.html#a0a8f91f93d75a07f0ae45077db45b3eb">MAX_CLIENTS</a></div><div class="ttdeci">#define MAX_CLIENTS</div><div class="ttdoc">back to q3ta default was 128 // absolute limit </div><div class="ttdef"><b>Definition:</b> <a href="q__shared_8h_source.html#l00996">q_shared.h:996</a></div></div>
<div class="ttc" id="server_8h_html_acaeeafd96557862e708479efaac293ef"><div class="ttname"><a href="server_8h.html#acaeeafd96557862e708479efaac293ef">sv_gametype</a></div><div class="ttdeci">cvar_t * sv_gametype</div><div class="ttdef"><b>Definition:</b> <a href="sv__main_8c_source.html#l00064">sv_main.c:64</a></div></div>
<div class="ttc" id="server_8h_html_ae8414b34853285827a1cfd61613f7b19"><div class="ttname"><a href="server_8h.html#ae8414b34853285827a1cfd61613f7b19">SV_DropClient</a></div><div class="ttdeci">void SV_DropClient(client_t *drop, const char *reason)</div><div class="ttdoc">Called when the player is totally leaving the server, either willingly or unwillingly. This is NOT called if the entire server is quiting or crashing â€“ SV_FinalCommand() will handle that. </div><div class="ttdef"><b>Definition:</b> <a href="sv__client_8c_source.html#l00598">sv_client.c:598</a></div></div>
<div class="ttc" id="server_8h_html_a0ff9eb096e93804922c75bbddaf18703"><div class="ttname"><a href="server_8h.html#a0ff9eb096e93804922c75bbddaf18703">sv</a></div><div class="ttdeci">server_t sv</div><div class="ttdoc">cleared each map </div><div class="ttdef"><b>Definition:</b> <a href="sv__main_8c_source.html#l00038">sv_main.c:38</a></div></div>
<div class="ttc" id="sv__demo_8c_html_ab4edf5c3717b68024df01aabcf4e261c"><div class="ttname"><a href="sv__demo_8c.html#ab4edf5c3717b68024df01aabcf4e261c">SV_DemoWriteAllPlayerState</a></div><div class="ttdeci">static void SV_DemoWriteAllPlayerState(void)</div><div class="ttdoc">Write all active clients playerState (playerState_t) </div><div class="ttdef"><b>Definition:</b> <a href="sv__demo_8c_source.html#l00665">sv_demo.c:665</a></div></div>
<div class="ttc" id="files_8c_html_ae4fa3825c09365feb036e9712f554cab"><div class="ttname"><a href="files_8c.html#ae4fa3825c09365feb036e9712f554cab">FS_FOpenFileRead</a></div><div class="ttdeci">long FS_FOpenFileRead(const char *fileName, fileHandle_t *file, qboolean uniqueFILE)</div><div class="ttdoc">Finds the file in the search path. Used for streaming data out of either a separate file or a ZIP fil...</div><div class="ttdef"><b>Definition:</b> <a href="files_8c_source.html#l01636">files.c:1636</a></div></div>
<div class="ttc" id="structmsg__t_html_ad79ecd5d9636d0e96bedd3a8b1be24a8"><div class="ttname"><a href="structmsg__t.html#ad79ecd5d9636d0e96bedd3a8b1be24a8">msg_t::cursize</a></div><div class="ttdeci">int cursize</div><div class="ttdef"><b>Definition:</b> <a href="qcommon_8h_source.html#l00063">qcommon.h:63</a></div></div>
<div class="ttc" id="common_8c_html_a39d965dde39e997b0cabeb491e9a074a"><div class="ttname"><a href="common_8c.html#a39d965dde39e997b0cabeb491e9a074a">com_timescale</a></div><div class="ttdeci">cvar_t * com_timescale</div><div class="ttdef"><b>Definition:</b> <a href="common_8c_source.html#l00103">common.c:103</a></div></div>
<div class="ttc" id="msg_8c_html_ae9560f9b420c88d5da72ff14c004bac0"><div class="ttname"><a href="msg_8c.html#ae9560f9b420c88d5da72ff14c004bac0">MSG_WriteString</a></div><div class="ttdeci">void MSG_WriteString(msg_t *msg, const char *s)</div><div class="ttdoc">MSG_WriteString. </div><div class="ttdef"><b>Definition:</b> <a href="msg_8c_source.html#l00509">msg.c:509</a></div></div>
<div class="ttc" id="sv__demo_8c_html_a3bcd6680e0d399f46b044dc7d23f6208"><div class="ttname"><a href="sv__demo_8c.html#a3bcd6680e0d399f46b044dc7d23f6208">SV_DemoWriteAllEntityState</a></div><div class="ttdeci">static void SV_DemoWriteAllEntityState(void)</div><div class="ttdoc">Write all entities state (gentity_t-&gt;entityState_t) </div><div class="ttdef"><b>Definition:</b> <a href="sv__demo_8c_source.html#l00701">sv_demo.c:701</a></div></div>
<div class="ttc" id="group__lua__etvars_html_ga51cad0ce7f4368abb921a976fcdaacce"><div class="ttname"><a href="group__lua__etvars.html#ga51cad0ce7f4368abb921a976fcdaacce">CS_MOTD</a></div><div class="ttdeci">#define CS_MOTD</div><div class="ttdoc">g_motd string for server message of the day </div><div class="ttdef"><b>Definition:</b> <a href="bg__public_8h_source.html#l00360">bg_public.h:360</a></div></div>
<div class="ttc" id="msg_8c_html_ac13659557314c0e7525eae249cb74aec"><div class="ttname"><a href="msg_8c.html#ac13659557314c0e7525eae249cb74aec">MSG_ReadString</a></div><div class="ttdeci">char * MSG_ReadString(msg_t *msg)</div><div class="ttdoc">MSG_ReadString. </div><div class="ttdef"><b>Definition:</b> <a href="msg_8c_source.html#l00724">msg.c:724</a></div></div>
<div class="ttc" id="sv__demo_8c_html_aba97b9ff4cc466abde57e33ab63649dc"><div class="ttname"><a href="sv__demo_8c.html#aba97b9ff4cc466abde57e33ab63649dc">SV_CleanStrCmd</a></div><div class="ttdeci">static char * SV_CleanStrCmd(char *string)</div><div class="ttdoc">Same as Q_CleanStr but also remove any ^s or special empty color created by the engine in a gamecomma...</div><div class="ttdef"><b>Definition:</b> <a href="sv__demo_8c_source.html#l00177">sv_demo.c:177</a></div></div>
<div class="ttc" id="sv__demo_8c_html_a25ef0f2e94637786927c43103dd9e5a4"><div class="ttname"><a href="sv__demo_8c.html#a25ef0f2e94637786927c43103dd9e5a4">SV_CompleteDemoName</a></div><div class="ttdeci">static void SV_CompleteDemoName(char *args, int argNum)</div><div class="ttdoc">SV_CompleteDemoName. </div><div class="ttdef"><b>Definition:</b> <a href="sv__demo_8c_source.html#l02076">sv_demo.c:2076</a></div></div>
<div class="ttc" id="q__shared_8h_html_ace81fe40472a49aacabe17f75dc443ee"><div class="ttname"><a href="q__shared_8h.html#ace81fe40472a49aacabe17f75dc443ee">SVDEMOEXT</a></div><div class="ttdeci">#define SVDEMOEXT</div><div class="ttdoc">standard server demo extension </div><div class="ttdef"><b>Definition:</b> <a href="q__shared_8h_source.html#l00075">q_shared.h:75</a></div></div>
<div class="ttc" id="sv__demo_8c_html_ac2df805abc2d8b1abfe9958f0376b0ff"><div class="ttname"><a href="sv__demo_8c.html#ac2df805abc2d8b1abfe9958f0376b0ff">SV_DemoShutdown</a></div><div class="ttdeci">void SV_DemoShutdown(void)</div><div class="ttdoc">SV_DemoShutdown. </div><div class="ttdef"><b>Definition:</b> <a href="sv__demo_8c_source.html#l02100">sv_demo.c:2100</a></div></div>
<div class="ttc" id="sv__demo_8c_html_ae40ba076ac619b2c265145f7b7e5fc1a"><div class="ttname"><a href="sv__demo_8c.html#ae40ba076ac619b2c265145f7b7e5fc1a">SV_CheckClientCommand</a></div><div class="ttdeci">static qboolean SV_CheckClientCommand(client_t *client, const char *cmd)</div><div class="ttdoc">Check that the clientCommand is OK (if not we either continue with a more specialized function...</div><div class="ttdef"><b>Definition:</b> <a href="sv__demo_8c_source.html#l00208">sv_demo.c:208</a></div></div>
<div class="ttc" id="structsharedEntity__t_html"><div class="ttname"><a href="structsharedEntity__t.html">sharedEntity_t</a></div><div class="ttdoc">The server looks at a sharedEntity, which is the start of the game&amp;#39;s gentity_t structure. </div><div class="ttdef"><b>Definition:</b> <a href="g__public_8h_source.html#l00092">g_public.h:92</a></div></div>
<div class="ttc" id="sv__demo_8c_html_a5d8a660f9dee330dc9a9bc59363bc70e"><div class="ttname"><a href="sv__demo_8c.html#a5d8a660f9dee330dc9a9bc59363bc70e">SV_DemoReadAllEntityShared</a></div><div class="ttdeci">static void SV_DemoReadAllEntityShared(msg_t *msg)</div><div class="ttdoc">Read all shared entities (gentity_t or sharedEntity_t-&gt;entityShared_t. </div><div class="ttdef"><b>Definition:</b> <a href="sv__demo_8c_source.html#l01704">sv_demo.c:1704</a></div></div>
<div class="ttc" id="bg__public_8h_html_a8e2a64110eeed77727d53d171fd756c7abcecdd872c60907a514719cbcbaa9276"><div class="ttname"><a href="bg__public_8h.html#a8e2a64110eeed77727d53d171fd756c7abcecdd872c60907a514719cbcbaa9276">GT_SINGLE_PLAYER</a></div><div class="ttdoc">obsolete </div><div class="ttdef"><b>Definition:</b> <a href="bg__public_8h_source.html#l00436">bg_public.h:436</a></div></div>
<div class="ttc" id="server_8h_html_ae0b352c6d88fa5bc0585149c71d75818"><div class="ttname"><a href="server_8h.html#ae0b352c6d88fa5bc0585149c71d75818">SV_UnlinkEntity</a></div><div class="ttdeci">void SV_UnlinkEntity(sharedEntity_t *gEnt)</div><div class="ttdoc">SV_UnlinkEntity. </div><div class="ttdef"><b>Definition:</b> <a href="sv__world_8c_source.html#l00179">sv_world.c:179</a></div></div>
<div class="ttc" id="cmd_8c_html_ad637687ea893ee12b74615a6fc8ae0a9"><div class="ttname"><a href="cmd_8c.html#ad637687ea893ee12b74615a6fc8ae0a9">Cmd_Cmd</a></div><div class="ttdeci">char * Cmd_Cmd(void)</div><div class="ttdoc">Retrieve the unmodified command string. For rcon use when you want to transmit without altering quoti...</div><div class="ttdef"><b>Definition:</b> <a href="cmd_8c_source.html#l00547">cmd.c:547</a></div></div>
<div class="ttc" id="server_8h_html_a3b99dca52e9e1e439d5fab603a33ef92"><div class="ttname"><a href="server_8h.html#a3b99dca52e9e1e439d5fab603a33ef92">SV_GentityUpdateHealthField</a></div><div class="ttdeci">void SV_GentityUpdateHealthField(sharedEntity_t *gent, playerState_t *player)</div><div class="ttdoc">Update the value of the gentity_t-&gt;health field with playerState_t-&gt;stats[STAT_HEALTH] for a given pl...</div><div class="ttdef"><b>Definition:</b> <a href="sv__demo__ext_8c_source.html#l00101">sv_demo_ext.c:101</a></div></div>
<div class="ttc" id="sv__demo_8c_html_af2bc2d94afb470315c0786124a2fdc31a21695c29e33235a31893db6f62f314d1"><div class="ttname"><a href="sv__demo_8c.html#af2bc2d94afb470315c0786124a2fdc31a21695c29e33235a31893db6f62f314d1">demo_endDemo</a></div><div class="ttdef"><b>Definition:</b> <a href="sv__demo_8c_source.html#l00051">sv_demo.c:51</a></div></div>
<div class="ttc" id="sv__demo_8c_html_a2c7dac2240c5973fef1fdc91ef5da9a0"><div class="ttname"><a href="sv__demo_8c.html#a2c7dac2240c5973fef1fdc91ef5da9a0">SV_DemoWriteGameCommand</a></div><div class="ttdeci">void SV_DemoWriteGameCommand(int clientNum, const char *cmd)</div><div class="ttdoc">Write a game command to the demo file. </div><div class="ttdef"><b>Definition:</b> <a href="sv__demo_8c_source.html#l00517">sv_demo.c:517</a></div></div>
<div class="ttc" id="structserver__t_html_a4132ec967ed2e26499e7c93b84e70915"><div class="ttname"><a href="structserver__t.html#a4132ec967ed2e26499e7c93b84e70915">server_t::demoPlayerStates</a></div><div class="ttdeci">playerState_t demoPlayerStates[MAX_CLIENTS]</div><div class="ttdef"><b>Definition:</b> <a href="server_8h_source.html#l00150">server.h:150</a></div></div>
<div class="ttc" id="sv__demo_8c_html_ab665b00f98fea8023457dd250deea1e0"><div class="ttname"><a href="sv__demo_8c.html#ab665b00f98fea8023457dd250deea1e0">SV_DemoReadGameCommand</a></div><div class="ttdeci">static void SV_DemoReadGameCommand(msg_t *msg)</div><div class="ttdoc">Replay a game command (only game commands sent to all clients) </div><div class="ttdef"><b>Definition:</b> <a href="sv__demo_8c_source.html#l01410">sv_demo.c:1410</a></div></div>
<div class="ttc" id="sv__demo_8c_html_aaff78f6aa9ec94251e5e0a7ed26ecbd9"><div class="ttname"><a href="sv__demo_8c.html#aaff78f6aa9ec94251e5e0a7ed26ecbd9">SV_DemoReadAllEntityState</a></div><div class="ttdeci">static void SV_DemoReadAllEntityState(msg_t *msg)</div><div class="ttdoc">Read all entities state (gentity_t or sharedEntity_t-&gt;entityState_t) from a message and store them in...</div><div class="ttdef"><b>Definition:</b> <a href="sv__demo_8c_source.html#l01656">sv_demo.c:1656</a></div></div>
<div class="ttc" id="server_8h_html_a0bc03a0e709716a4965c0324f23b8977"><div class="ttname"><a href="server_8h.html#a0bc03a0e709716a4965c0324f23b8977">sv_maxclients</a></div><div class="ttdeci">cvar_t * sv_maxclients</div><div class="ttdef"><b>Definition:</b> <a href="sv__main_8c_source.html#l00047">sv_main.c:47</a></div></div>
<div class="ttc" id="q__shared_8h_html_a674763dac6c5d9defd5165e2d196b7a4"><div class="ttname"><a href="q__shared_8h.html#a674763dac6c5d9defd5165e2d196b7a4">GENTITYNUM_BITS</a></div><div class="ttdeci">#define GENTITYNUM_BITS</div><div class="ttdoc">put q3ta default back for testing // don&amp;#39;t need to send any more </div><div class="ttdef"><b>Definition:</b> <a href="q__shared_8h_source.html#l00998">q_shared.h:998</a></div></div>
<div class="ttc" id="structclient__s_html_ae3d14ce39525b187f2ecc3fe3cf12b8b"><div class="ttname"><a href="structclient__s.html#ae3d14ce39525b187f2ecc3fe3cf12b8b">client_s::demoClient</a></div><div class="ttdeci">qboolean demoClient</div><div class="ttdoc">is this a demoClient? </div><div class="ttdef"><b>Definition:</b> <a href="server_8h_source.html#l00277">server.h:277</a></div></div>
<div class="ttc" id="sv__demo_8c_html_af2bc2d94afb470315c0786124a2fdc31aa376fd14cf5aa4417a120dae8db81167"><div class="ttname"><a href="sv__demo_8c.html#af2bc2d94afb470315c0786124a2fdc31aa376fd14cf5aa4417a120dae8db81167">demo_entityState</a></div><div class="ttdef"><b>Definition:</b> <a href="sv__demo_8c_source.html#l00061">sv_demo.c:61</a></div></div>
<div class="ttc" id="sv__demo_8c_html_ad9dc1a465b353d71a5dc0696f11ed892"><div class="ttname"><a href="sv__demo_8c.html#ad9dc1a465b353d71a5dc0696f11ed892">SV_DemoReadFrame</a></div><div class="ttdeci">void SV_DemoReadFrame(void)</div><div class="ttdoc">Play a frame from the demo file. </div><div class="ttdef"><b>Definition:</b> <a href="sv__demo_8c_source.html#l01799">sv_demo.c:1799</a></div></div>
<div class="ttc" id="q__shared_8h_html_a0eafe8f648a704333f11e9b825d01896"><div class="ttname"><a href="q__shared_8h.html#a0eafe8f648a704333f11e9b825d01896">MAX_INFO_STRING</a></div><div class="ttdeci">#define MAX_INFO_STRING</div><div class="ttdef"><b>Definition:</b> <a href="q__shared_8h_source.html#l00443">q_shared.h:443</a></div></div>
<div class="ttc" id="structtrajectory__t_html_a35221cbd6034e328a53ba10f6da6e17e"><div class="ttname"><a href="structtrajectory__t.html#a35221cbd6034e328a53ba10f6da6e17e">trajectory_t::trType</a></div><div class="ttdeci">trType_t trType</div><div class="ttdef"><b>Definition:</b> <a href="q__shared_8h_source.html#l01337">q_shared.h:1337</a></div></div>
<div class="ttc" id="msg_8c_html_ad7efeddd101bfd4d073ed261c67ddd1f"><div class="ttname"><a href="msg_8c.html#ad7efeddd101bfd4d073ed261c67ddd1f">MSG_ReadLong</a></div><div class="ttdeci">int MSG_ReadLong(msg_t *msg)</div><div class="ttdoc">MSG_ReadLong. </div><div class="ttdef"><b>Definition:</b> <a href="msg_8c_source.html#l00683">msg.c:683</a></div></div>
<div class="ttc" id="sv__demo_8c_html_af40b5e1ed925afb7b86a9ad0c20bcbe2"><div class="ttname"><a href="sv__demo_8c.html#af40b5e1ed925afb7b86a9ad0c20bcbe2">SV_DemoStopPlayback</a></div><div class="ttdeci">static void SV_DemoStopPlayback(void)</div><div class="ttdoc">Close the demo file and restart the map (can be used both when recording or when playing or at shutdo...</div><div class="ttdef"><b>Definition:</b> <a href="sv__demo_8c_source.html#l00860">sv_demo.c:860</a></div></div>
<div class="ttc" id="structentityState__s_html_a0f67fab8014db00050f0fa306b49e030"><div class="ttname"><a href="structentityState__s.html#a0f67fab8014db00050f0fa306b49e030">entityState_s::pos</a></div><div class="ttdeci">trajectory_t pos</div><div class="ttdoc">for calculating position </div><div class="ttdef"><b>Definition:</b> <a href="q__shared_8h_source.html#l01453">q_shared.h:1453</a></div></div>
<div class="ttc" id="sv__demo_8c_html_a6db2f44e47b43048736f323110f37995"><div class="ttname"><a href="sv__demo_8c.html#a6db2f44e47b43048736f323110f37995">SV_DemoRestartPlayback</a></div><div class="ttdeci">void SV_DemoRestartPlayback(void)</div><div class="ttdoc">Just issue again the demo_play command along with the demo filename (used when the system will automa...</div><div class="ttdef"><b>Definition:</b> <a href="sv__demo_8c_source.html#l00930">sv_demo.c:930</a></div></div>
<div class="ttc" id="structclient__s_html_aea178e2c587a3c7eacdeaa92488a5f0d"><div class="ttname"><a href="structclient__s.html#aea178e2c587a3c7eacdeaa92488a5f0d">client_s::state</a></div><div class="ttdeci">clientState_t state</div><div class="ttdef"><b>Definition:</b> <a href="server_8h_source.html#l00205">server.h:205</a></div></div>
<div class="ttc" id="sv__demo_8c_html_af3e78672f89264c08f7d2dc2a8b43bac"><div class="ttname"><a href="sv__demo_8c.html#af3e78672f89264c08f7d2dc2a8b43bac">savedAllowVote</a></div><div class="ttdeci">static int savedAllowVote</div><div class="ttdef"><b>Definition:</b> <a href="sv__demo_8c_source.html#l00080">sv_demo.c:80</a></div></div>
<div class="ttc" id="server_8h_html"><div class="ttname"><a href="server_8h.html">server.h</a></div><div class="ttdoc">Primary header for server. </div></div>
<div class="ttc" id="sv__demo_8c_html_a97d4db4d6cb8217fdd4b8b641aebcea4"><div class="ttname"><a href="sv__demo_8c.html#a97d4db4d6cb8217fdd4b8b641aebcea4">savedFsGame</a></div><div class="ttdeci">static char * savedFsGame</div><div class="ttdef"><b>Definition:</b> <a href="sv__demo_8c_source.html#l00087">sv_demo.c:87</a></div></div>
<div class="ttc" id="structentityShared__t_html_a806533ac43c862ab4487835a7051ed5a"><div class="ttname"><a href="structentityShared__t.html#a806533ac43c862ab4487835a7051ed5a">entityShared_t::linked</a></div><div class="ttdeci">qboolean linked</div><div class="ttdoc">qfalse if not in any good cluster </div><div class="ttdef"><b>Definition:</b> <a href="g__public_8h_source.html#l00053">g_public.h:53</a></div></div>
<div class="ttc" id="cmd_8c_html_a64f2928056fbc22633bf72cadc92e16a"><div class="ttname"><a href="cmd_8c.html#a64f2928056fbc22633bf72cadc92e16a">Cbuf_AddText</a></div><div class="ttdeci">void Cbuf_AddText(const char *text)</div><div class="ttdoc">Adds command text at the end of the buffer, does NOT add a final \n. </div><div class="ttdef"><b>Definition:</b> <a href="cmd_8c_source.html#l00102">cmd.c:102</a></div></div>
<div class="ttc" id="sv__demo_8c_html_af2bc2d94afb470315c0786124a2fdc31a7a1cab03a80a4741e82f124d9e6fd8cc"><div class="ttname"><a href="sv__demo_8c.html#af2bc2d94afb470315c0786124a2fdc31a7a1cab03a80a4741e82f124d9e6fd8cc">demo_serverCommand</a></div><div class="ttdef"><b>Definition:</b> <a href="sv__demo_8c_source.html#l00058">sv_demo.c:58</a></div></div>
<div class="ttc" id="common_8c_html_a0ab92ecafc08cdd812d6c273f39fc49e"><div class="ttname"><a href="common_8c.html#a0ab92ecafc08cdd812d6c273f39fc49e">Com_RealTime</a></div><div class="ttdeci">int Com_RealTime(qtime_t *qtime)</div><div class="ttdoc">Com_RealTime. </div><div class="ttdef"><b>Definition:</b> <a href="common_8c_source.html#l00893">common.c:893</a></div></div>
<div class="ttc" id="structentityState__s_html_afbe7d9eca166816dad9eb2b44484073f"><div class="ttname"><a href="structentityState__s.html#afbe7d9eca166816dad9eb2b44484073f">entityState_s::eType</a></div><div class="ttdeci">entityType_t eType</div><div class="ttdoc">entityType_t </div><div class="ttdef"><b>Definition:</b> <a href="q__shared_8h_source.html#l01450">q_shared.h:1450</a></div></div>
<div class="ttc" id="qcommon_8h_html_a277f7abca2044f354abe265252cb9252"><div class="ttname"><a href="qcommon_8h.html#a277f7abca2044f354abe265252cb9252">PROTOCOL_VERSION</a></div><div class="ttdeci">#define PROTOCOL_VERSION</div><div class="ttdef"><b>Definition:</b> <a href="qcommon_8h_source.html#l00388">qcommon.h:388</a></div></div>
<div class="ttc" id="qcommon_8h_html_a1654a012cc4b6196cf9e2da097b7b02aa9cf418f084ad1c666a25b35db62f9e55"><div class="ttname"><a href="qcommon_8h.html#a1654a012cc4b6196cf9e2da097b7b02aa9cf418f084ad1c666a25b35db62f9e55">NA_LOOPBACK</a></div><div class="ttdef"><b>Definition:</b> <a href="qcommon_8h_source.html#l00183">qcommon.h:183</a></div></div>
<div class="ttc" id="sv__demo_8c_html_af2bc2d94afb470315c0786124a2fdc31af5d3dcaed9fee578e7a23fdaf39b3485"><div class="ttname"><a href="sv__demo_8c.html#af2bc2d94afb470315c0786124a2fdc31af5d3dcaed9fee578e7a23fdaf39b3485">demo_EOF</a></div><div class="ttdef"><b>Definition:</b> <a href="sv__demo_8c_source.html#l00052">sv_demo.c:52</a></div></div>
<div class="ttc" id="q__shared_8h_html_a711f5c43166bc15a6a6adc8bacb0684a"><div class="ttname"><a href="q__shared_8h.html#a711f5c43166bc15a6a6adc8bacb0684a">MAX_CONFIGSTRINGS</a></div><div class="ttdeci">#define MAX_CONFIGSTRINGS</div><div class="ttdef"><b>Definition:</b> <a href="q__shared_8h_source.html#l01021">q_shared.h:1021</a></div></div>
<div class="ttc" id="sv__demo_8c_html_addf956cd63c8c1f85f1272fc1f2fecba"><div class="ttname"><a href="sv__demo_8c.html#addf956cd63c8c1f85f1272fc1f2fecba">SV_DemoAutoDemoRecord</a></div><div class="ttdeci">void SV_DemoAutoDemoRecord(void)</div><div class="ttdoc">Generates a meaningful demo filename and automatically starts the demo recording. ...</div><div class="ttdef"><b>Definition:</b> <a href="sv__demo_8c_source.html#l00823">sv_demo.c:823</a></div></div>
<div class="ttc" id="q__math_8h_html_a73886d8f4ab1397c17793450d24fe806"><div class="ttname"><a href="q__math_8h.html#a73886d8f4ab1397c17793450d24fe806">Q_IsColorString</a></div><div class="ttdeci">#define Q_IsColorString(p)</div><div class="ttdef"><b>Definition:</b> <a href="q__math_8h_source.html#l00119">q_math.h:119</a></div></div>
<div class="ttc" id="server_8h_html_a8d79a0b5f456061ad33642f11f4b7d17"><div class="ttname"><a href="server_8h.html#a8d79a0b5f456061ad33642f11f4b7d17">sv_democlients</a></div><div class="ttdeci">cvar_t * sv_democlients</div><div class="ttdef"><b>Definition:</b> <a href="sv__main_8c_source.html#l00048">sv_main.c:48</a></div></div>
<div class="ttc" id="server_8h_html_af1f59a32ccea93eed6522ef2a4140bc7"><div class="ttname"><a href="server_8h.html#af1f59a32ccea93eed6522ef2a4140bc7">sv_demoTolerant</a></div><div class="ttdeci">cvar_t * sv_demoTolerant</div><div class="ttdef"><b>Definition:</b> <a href="sv__main_8c_source.html#l00115">sv_main.c:115</a></div></div>
<div class="ttc" id="dl__local_8h_html_a74f39535654af88006aa56dca7615bc5"><div class="ttname"><a href="dl__local_8h.html#a74f39535654af88006aa56dca7615bc5">Q_stricmp</a></div><div class="ttdeci">#define Q_stricmp</div><div class="ttdef"><b>Definition:</b> <a href="dl__local_8h_source.html#l00057">dl_local.h:57</a></div></div>
<div class="ttc" id="structserver__t_html_ab3620e6e41fd6771b4994186079f6b43"><div class="ttname"><a href="structserver__t.html#ab3620e6e41fd6771b4994186079f6b43">server_t::configstrings</a></div><div class="ttdeci">char * configstrings[MAX_CONFIGSTRINGS]</div><div class="ttdef"><b>Definition:</b> <a href="server_8h_source.html#l00108">server.h:108</a></div></div>
<div class="ttc" id="structmsg__t_html"><div class="ttname"><a href="structmsg__t.html">msg_t</a></div><div class="ttdef"><b>Definition:</b> <a href="qcommon_8h_source.html#l00056">qcommon.h:56</a></div></div>
<div class="ttc" id="sv__demo_8c_html_a2aef5c150509941d274951dd9ad0065f"><div class="ttname"><a href="sv__demo_8c.html#a2aef5c150509941d274951dd9ad0065f">savedFPS</a></div><div class="ttdeci">static int savedFPS</div><div class="ttdef"><b>Definition:</b> <a href="sv__demo_8c_source.html#l00076">sv_demo.c:76</a></div></div>
<div class="ttc" id="structqtime__s_html_ab8334f68a3eb928a8611902455880ca3"><div class="ttname"><a href="structqtime__s.html#ab8334f68a3eb928a8611902455880ca3">qtime_s::tm_mon</a></div><div class="ttdeci">int tm_mon</div><div class="ttdoc">months since January - [0,11] </div><div class="ttdef"><b>Definition:</b> <a href="q__shared_8h_source.html#l01615">q_shared.h:1615</a></div></div>
<div class="ttc" id="structqtime__s_html_abd9401c798760d8a96b760e8584a9f35"><div class="ttname"><a href="structqtime__s.html#abd9401c798760d8a96b760e8584a9f35">qtime_s::tm_sec</a></div><div class="ttdeci">int tm_sec</div><div class="ttdoc">seconds after the minute - [0,59] </div><div class="ttdef"><b>Definition:</b> <a href="q__shared_8h_source.html#l01611">q_shared.h:1611</a></div></div>
<div class="ttc" id="server_8h_html_a89d33b2529a2789787b365237a7319d4a3865e2578ba0d5b1078e326f0bf6d101"><div class="ttname"><a href="server_8h.html#a89d33b2529a2789787b365237a7319d4a3865e2578ba0d5b1078e326f0bf6d101">CS_CONNECTED</a></div><div class="ttdoc">has been assigned to a client_t, but no gamestate yet </div><div class="ttdef"><b>Definition:</b> <a href="server_8h_source.html#l00180">server.h:180</a></div></div>
<div class="ttc" id="sv__demo_8c_html_add33d5c852338d8b242e70aa80ccf70d"><div class="ttname"><a href="sv__demo_8c.html#add33d5c852338d8b242e70aa80ccf70d">SV_DemoInit</a></div><div class="ttdeci">void SV_DemoInit(void)</div><div class="ttdoc">SV_DemoInit. </div><div class="ttdef"><b>Definition:</b> <a href="sv__demo_8c_source.html#l02090">sv_demo.c:2090</a></div></div>
<div class="ttc" id="sv__demo_8c_html_a51a1815a96e037da4d5107c9560aafd5"><div class="ttname"><a href="sv__demo_8c.html#a51a1815a96e037da4d5107c9560aafd5">SV_CleanFilename</a></div><div class="ttdeci">static char * SV_CleanFilename(char *string)</div><div class="ttdoc">Attempts to clean invalid characters from a filename that may prevent the demo to be stored on the fi...</div><div class="ttdef"><b>Definition:</b> <a href="sv__demo_8c_source.html#l00357">sv_demo.c:357</a></div></div>
<div class="ttc" id="sv__demo_8c_html_a71ccef0ee78f1fc40c726ca22d0fd6ba"><div class="ttname"><a href="sv__demo_8c.html#a71ccef0ee78f1fc40c726ca22d0fd6ba">SV_DemoStopRecord</a></div><div class="ttdeci">static void SV_DemoStopRecord(void)</div><div class="ttdoc">Stop the recording of a demo. </div><div class="ttdef"><b>Definition:</b> <a href="sv__demo_8c_source.html#l01345">sv_demo.c:1345</a></div></div>
<div class="ttc" id="structclient__s_html"><div class="ttname"><a href="structclient__s.html">client_s</a></div><div class="ttdef"><b>Definition:</b> <a href="server_8h_source.html#l00203">server.h:203</a></div></div>
<div class="ttc" id="sv__demo_8c_html_a6e1988af3068dd6e5579127c4580998f"><div class="ttname"><a href="sv__demo_8c.html#a6e1988af3068dd6e5579127c4580998f">savedGametype</a></div><div class="ttdeci">static int savedGametype</div><div class="ttdef"><b>Definition:</b> <a href="sv__demo_8c_source.html#l00077">sv_demo.c:77</a></div></div>
<div class="ttc" id="server_8h_html_ade5a29e7abfb559177a66c7af35baf0f"><div class="ttname"><a href="server_8h.html#ade5a29e7abfb559177a66c7af35baf0f">SV_SendServerCommand</a></div><div class="ttdeci">void QDECL SV_SendServerCommand(client_t *cl, const char *fmt,...) __attribute__((format(printf</div></div>
<div class="ttc" id="g__local_8h_html_ae6326184cffc99fdda345480ffa7dc26"><div class="ttname"><a href="g__local_8h.html#ae6326184cffc99fdda345480ffa7dc26">sv_fps</a></div><div class="ttdeci">vmCvar_t sv_fps</div><div class="ttdef"><b>Definition:</b> <a href="g__main_8c_source.html#l00353">g_main.c:353</a></div></div>
<div class="ttc" id="q__shared_8h_html_a0c8186d9b9b7880309c27230bbb5e69d"><div class="ttname"><a href="q__shared_8h.html#a0c8186d9b9b7880309c27230bbb5e69d">byte</a></div><div class="ttdeci">unsigned char byte</div><div class="ttdef"><b>Definition:</b> <a href="q__shared_8h_source.html#l00351">q_shared.h:351</a></div></div>
<div class="ttc" id="sv__demo_8c_html_af6045856578984db5b182a7c905938a0"><div class="ttname"><a href="sv__demo_8c.html#af6045856578984db5b182a7c905938a0">SV_DemoReadRefreshEntities</a></div><div class="ttdeci">static void SV_DemoReadRefreshEntities(void)</div><div class="ttdoc">Load into memory all stored demo players states and entities (which effectively overwrites the one th...</div><div class="ttdef"><b>Definition:</b> <a href="sv__demo_8c_source.html#l01752">sv_demo.c:1752</a></div></div>
<div class="ttc" id="msg_8c_html_ae7dd73838db747fb3c9e5d7bc0725471"><div class="ttname"><a href="msg_8c.html#ae7dd73838db747fb3c9e5d7bc0725471">MSG_ReadDeltaPlayerstate</a></div><div class="ttdeci">void MSG_ReadDeltaPlayerstate(msg_t *msg, playerState_t *from, playerState_t *to)</div><div class="ttdoc">MSG_ReadDeltaPlayerstate. </div><div class="ttdef"><b>Definition:</b> <a href="msg_8c_source.html#l02324">msg.c:2324</a></div></div>
<div class="ttc" id="cvar_8c_html_a47803524e8f002b6540d91b8cccc7e0e"><div class="ttname"><a href="cvar_8c.html#a47803524e8f002b6540d91b8cccc7e0e">Cvar_VariableString</a></div><div class="ttdeci">char * Cvar_VariableString(const char *var_name)</div><div class="ttdoc">Cvar_VariableString. </div><div class="ttdef"><b>Definition:</b> <a href="cvar_8c_source.html#l00139">cvar.c:139</a></div></div>
<div class="ttc" id="sv__demo_8c_html_a8fe5acd248eb0ad72f98008fc25dc3bf"><div class="ttname"><a href="sv__demo_8c.html#a8fe5acd248eb0ad72f98008fc25dc3bf">SV_DemoStopAll</a></div><div class="ttdeci">void SV_DemoStopAll(void)</div><div class="ttdoc">SV_DemoStopAll. </div><div class="ttdef"><b>Definition:</b> <a href="sv__demo_8c_source.html#l01945">sv_demo.c:1945</a></div></div>
<div class="ttc" id="sv__demo_8c_html_a1756d9ddc463d7bca9539c8546a7c1b0"><div class="ttname"><a href="sv__demo_8c.html#a1756d9ddc463d7bca9539c8546a7c1b0">buf</a></div><div class="ttdeci">static byte buf[0x400000]</div><div class="ttdef"><b>Definition:</b> <a href="sv__demo_8c_source.html#l00072">sv_demo.c:72</a></div></div>
<div class="ttc" id="q__shared_8h_html_ab53d05683d8387a66f35e1dfc5edafb9a9cca5ee0127e0afe5df67f7fcca468b9"><div class="ttname"><a href="q__shared_8h.html#ab53d05683d8387a66f35e1dfc5edafb9a9cca5ee0127e0afe5df67f7fcca468b9">TR_LINEAR_STOP</a></div><div class="ttdef"><b>Definition:</b> <a href="q__shared_8h_source.html#l01319">q_shared.h:1319</a></div></div>
<div class="ttc" id="qcommon_8h_html_a7be3e8ed0151b858862dac2259654d01"><div class="ttname"><a href="qcommon_8h.html#a7be3e8ed0151b858862dac2259654d01">BASEGAME</a></div><div class="ttdeci">#define BASEGAME</div><div class="ttdef"><b>Definition:</b> <a href="qcommon_8h_source.html#l00743">qcommon.h:743</a></div></div>
<div class="ttc" id="msg_8c_html_ab4fbaf62146cc0af89d6ffc359b588a6"><div class="ttname"><a href="msg_8c.html#ab4fbaf62146cc0af89d6ffc359b588a6">MSG_ReadBits</a></div><div class="ttdeci">int MSG_ReadBits(msg_t *msg, int bits)</div><div class="ttdoc">MSG_ReadBits. </div><div class="ttdef"><b>Definition:</b> <a href="msg_8c_source.html#l00299">msg.c:299</a></div></div>
<div class="ttc" id="q__shared_8h_html_aba8efcfeace840764f26eb63236b996fac64a219bee2ab3ff18669647f94f1419"><div class="ttname"><a href="q__shared_8h.html#aba8efcfeace840764f26eb63236b996fac64a219bee2ab3ff18669647f94f1419">ET_MOVER</a></div><div class="ttdef"><b>Definition:</b> <a href="q__shared_8h_source.html#l01362">q_shared.h:1362</a></div></div>
<div class="ttc" id="sv__demo_8c_html_a96ab40d64e830462b4c50916b4ee960a"><div class="ttname"><a href="sv__demo_8c.html#a96ab40d64e830462b4c50916b4ee960a">savedMaxClients</a></div><div class="ttdeci">static int savedMaxClients</div><div class="ttdef"><b>Definition:</b> <a href="sv__demo_8c_source.html#l00075">sv_demo.c:75</a></div></div>
<div class="ttc" id="structserver__t_html_af6dffe71c8e672577be691d5b32bd8d3"><div class="ttname"><a href="structserver__t.html#af6dffe71c8e672577be691d5b32bd8d3">server_t::demoFile</a></div><div class="ttdeci">fileHandle_t demoFile</div><div class="ttdef"><b>Definition:</b> <a href="server_8h_source.html#l00144">server.h:144</a></div></div>
<div class="ttc" id="msg_8c_html_aa68d315a2d71b5c63ce607ab1aa57e23"><div class="ttname"><a href="msg_8c.html#aa68d315a2d71b5c63ce607ab1aa57e23">MSG_WriteBits</a></div><div class="ttdeci">void MSG_WriteBits(msg_t *msg, int value, int bits)</div><div class="ttdoc">MSG_WriteBits. </div><div class="ttdef"><b>Definition:</b> <a href="msg_8c_source.html#l00194">msg.c:194</a></div></div>
<div class="ttc" id="sv__demo_8c_html_a1d1939204445abada2986c14f21b0ffa"><div class="ttname"><a href="sv__demo_8c.html#a1d1939204445abada2986c14f21b0ffa">SV_CheckConfigString</a></div><div class="ttdeci">static qboolean SV_CheckConfigString(int cs_index, const char *cs_string)</div><div class="ttdoc">Check that the configstring is OK (or if we relay to ClientConfigString) </div><div class="ttdef"><b>Definition:</b> <a href="sv__demo_8c_source.html#l00321">sv_demo.c:321</a></div></div>
<div class="ttc" id="sv__demo_8c_html_aa21691af03d57b54abf4a87f05afc9b6"><div class="ttname"><a href="sv__demo_8c.html#aa21691af03d57b54abf4a87f05afc9b6">savedDoWarmup</a></div><div class="ttdeci">static int savedDoWarmup</div><div class="ttdef"><b>Definition:</b> <a href="sv__demo_8c_source.html#l00079">sv_demo.c:79</a></div></div>
<div class="ttc" id="cvar_8c_html_a950a656c1889d681b4a28c82439031d1"><div class="ttname"><a href="cvar_8c.html#a950a656c1889d681b4a28c82439031d1">Cvar_SetLatched</a></div><div class="ttdeci">void Cvar_SetLatched(const char *var_name, const char *value)</div><div class="ttdoc">Cvar_SetLatched. </div><div class="ttdef"><b>Definition:</b> <a href="cvar_8c_source.html#l00817">cvar.c:817</a></div></div>
<div class="ttc" id="cvar_8c_html_abbb41791f156730b8af8e3e0a7fac820"><div class="ttname"><a href="cvar_8c.html#abbb41791f156730b8af8e3e0a7fac820">Cvar_SetValue</a></div><div class="ttdeci">void Cvar_SetValue(const char *var_name, float value)</div><div class="ttdoc">Cvar_SetValue. </div><div class="ttdef"><b>Definition:</b> <a href="cvar_8c_source.html#l00827">cvar.c:827</a></div></div>
<div class="ttc" id="structcvar__s_html_adb4a4f5cdd70988e14780b79a6e32e0a"><div class="ttname"><a href="structcvar__s.html#adb4a4f5cdd70988e14780b79a6e32e0a">cvar_s::string</a></div><div class="ttdeci">char * string</div><div class="ttdef"><b>Definition:</b> <a href="q__shared_8h_source.html#l00833">q_shared.h:833</a></div></div>
<div class="ttc" id="q__shared_8c_html_a70a2b0d67ad6af400d513cf1136af8dc"><div class="ttname"><a href="q__shared_8c.html#a70a2b0d67ad6af400d513cf1136af8dc">Q_strncpyz</a></div><div class="ttdeci">void Q_strncpyz(char *dest, const char *src, size_t destsize)</div><div class="ttdoc">Safe strncpy that ensures a trailing zero. </div><div class="ttdef"><b>Definition:</b> <a href="q__shared_8c_source.html#l01455">q_shared.c:1455</a></div></div>
<div class="ttc" id="structclient__s_html_adb1abd6e53447ea4e644dd19e0dc5dee"><div class="ttname"><a href="structclient__s.html#adb1abd6e53447ea4e644dd19e0dc5dee">client_s::name</a></div><div class="ttdeci">char name[MAX_NAME_LENGTH]</div><div class="ttdoc">extracted from userinfo, high bits masked </div><div class="ttdef"><b>Definition:</b> <a href="server_8h_source.html#l00227">server.h:227</a></div></div>
<div class="ttc" id="structserver__t_html_aecc2bc627e3d7df7e58c8c39d22c10eb"><div class="ttname"><a href="structserver__t.html#aecc2bc627e3d7df7e58c8c39d22c10eb">server_t::num_entities</a></div><div class="ttdeci">int num_entities</div><div class="ttdoc">current number, &lt;= MAX_GENTITIES </div><div class="ttdef"><b>Definition:</b> <a href="server_8h_source.html#l00117">server.h:117</a></div></div>
<div class="ttc" id="qcommon_8h_html_a79d4501207fd0e4df1373143acaeac6e"><div class="ttname"><a href="qcommon_8h.html#a79d4501207fd0e4df1373143acaeac6e">VM_Call</a></div><div class="ttdeci">#define VM_Call(vm,...)</div><div class="ttdef"><b>Definition:</b> <a href="qcommon_8h_source.html#l00519">qcommon.h:519</a></div></div>
<div class="ttc" id="sv__demo_8c_html_af2bc2d94afb470315c0786124a2fdc31a899deb9b820e7fddef38a0f8b9b02b84"><div class="ttname"><a href="sv__demo_8c.html#af2bc2d94afb470315c0786124a2fdc31a899deb9b820e7fddef38a0f8b9b02b84">demo_clientUserinfo</a></div><div class="ttdef"><b>Definition:</b> <a href="sv__demo_8c_source.html#l00060">sv_demo.c:60</a></div></div>
<div class="ttc" id="q__shared_8h_html_a110846a9664bbd925f955266e60e9136a9a60e3a3b7123e30c470bd5823cde09d"><div class="ttname"><a href="q__shared_8h.html#a110846a9664bbd925f955266e60e9136a9a60e3a3b7123e30c470bd5823cde09d">qtrue</a></div><div class="ttdef"><b>Definition:</b> <a href="q__shared_8h_source.html#l00357">q_shared.h:357</a></div></div>
<div class="ttc" id="q__shared_8h_html_aeaa898bef6b376f572e5e59d943d78b2a532cc227a9fbfa28f3a3f417f5fb1944"><div class="ttname"><a href="q__shared_8h.html#aeaa898bef6b376f572e5e59d943d78b2a532cc227a9fbfa28f3a3f417f5fb1944">DS_WAITINGPLAYBACK</a></div><div class="ttdoc">demo will play after map_restart) </div><div class="ttdef"><b>Definition:</b> <a href="q__shared_8h_source.html#l01654">q_shared.h:1654</a></div></div>
<div class="ttc" id="structqtime__s_html_a05160c537b35b038e828cc3259f119df"><div class="ttname"><a href="structqtime__s.html#a05160c537b35b038e828cc3259f119df">qtime_s::tm_hour</a></div><div class="ttdeci">int tm_hour</div><div class="ttdoc">hours since midnight - [0,23] </div><div class="ttdef"><b>Definition:</b> <a href="q__shared_8h_source.html#l01613">q_shared.h:1613</a></div></div>
<div class="ttc" id="cmd_8c_html_a93726aad83fc281293e890274ae75dde"><div class="ttname"><a href="cmd_8c.html#a93726aad83fc281293e890274ae75dde">Cmd_RemoveCommand</a></div><div class="ttdeci">void Cmd_RemoveCommand(const char *cmd_name)</div><div class="ttdoc">Cmd_RemoveCommand. </div><div class="ttdef"><b>Definition:</b> <a href="cmd_8c_source.html#l00839">cmd.c:839</a></div></div>
<div class="ttc" id="sv__demo_8c_html_af2bc2d94afb470315c0786124a2fdc31"><div class="ttname"><a href="sv__demo_8c.html#af2bc2d94afb470315c0786124a2fdc31">demo_ops_e</a></div><div class="ttdeci">demo_ops_e</div><div class="ttdef"><b>Definition:</b> <a href="sv__demo_8c_source.html#l00049">sv_demo.c:49</a></div></div>
<div class="ttc" id="structentityShared__t_html_a5cef811298c9427e17484f50db8f5387"><div class="ttname"><a href="structentityShared__t.html#a5cef811298c9427e17484f50db8f5387">entityShared_t::linkcount</a></div><div class="ttdeci">int linkcount</div><div class="ttdef"><b>Definition:</b> <a href="g__public_8h_source.html#l00054">g_public.h:54</a></div></div>
<div class="ttc" id="structclient__s_html_a6dac1acddd0a5749f1e66fe59e542ade"><div class="ttname"><a href="structclient__s.html#a6dac1acddd0a5749f1e66fe59e542ade">client_s::netchan</a></div><div class="ttdeci">netchan_t netchan</div><div class="ttdef"><b>Definition:</b> <a href="server_8h_source.html#l00266">server.h:266</a></div></div>
<div class="ttc" id="sv__demo_8c_html_aa45515709ea25cc3192f80c86351dc02"><div class="ttname"><a href="sv__demo_8c.html#aa45515709ea25cc3192f80c86351dc02">SV_DemoClientCommandCapture</a></div><div class="ttdeci">qboolean SV_DemoClientCommandCapture(client_t *client, const char *msg)</div><div class="ttdoc">SV_DemoClientCommandCapture. </div><div class="ttdef"><b>Definition:</b> <a href="sv__demo_8c_source.html#l00462">sv_demo.c:462</a></div></div>
<div class="ttc" id="structentityShared__t_html_aba45f5cd6a771d13ca3665dfd98ce3a1"><div class="ttname"><a href="structentityShared__t.html#aba45f5cd6a771d13ca3665dfd98ce3a1">entityShared_t::svFlags</a></div><div class="ttdeci">int svFlags</div><div class="ttdoc">SVF_NOCLIENT, SVF_BROADCAST, etc. </div><div class="ttdef"><b>Definition:</b> <a href="g__public_8h_source.html#l00056">g_public.h:56</a></div></div>
<div class="ttc" id="files_8c_html_a966590935244c0d031a419129bf844a6"><div class="ttname"><a href="files_8c.html#a966590935244c0d031a419129bf844a6">FS_FileExists</a></div><div class="ttdeci">qboolean FS_FileExists(const char *file)</div><div class="ttdoc">Tests if the file exists in the current gamedir of fs_homepath. </div><div class="ttdef"><b>Definition:</b> <a href="files_8c_source.html#l00831">files.c:831</a></div></div>
<div class="ttc" id="sv__demo_8c_html_a5cbe2abcce3bd42a5391d98791abb056"><div class="ttname"><a href="sv__demo_8c.html#a5cbe2abcce3bd42a5391d98791abb056">SV_DemoStartRecord</a></div><div class="ttdeci">static void SV_DemoStartRecord(void)</div><div class="ttdoc">Start the recording of a demo by saving some headers data (such as the number of clients, mapname, gametype, etc..) </div><div class="ttdef"><b>Definition:</b> <a href="sv__demo_8c_source.html#l01262">sv_demo.c:1262</a></div></div>
<div class="ttc" id="q__shared_8h_html_a110846a9664bbd925f955266e60e9136a0e538a5d43e68d2de4eb96c77855de40"><div class="ttname"><a href="q__shared_8h.html#a110846a9664bbd925f955266e60e9136a0e538a5d43e68d2de4eb96c77855de40">qfalse</a></div><div class="ttdef"><b>Definition:</b> <a href="q__shared_8h_source.html#l00357">q_shared.h:357</a></div></div>
<div class="ttc" id="q__shared_8h_html_aeaa898bef6b376f572e5e59d943d78b2af75400ba282421573f07b01908d9f4a4"><div class="ttname"><a href="q__shared_8h.html#aeaa898bef6b376f572e5e59d943d78b2af75400ba282421573f07b01908d9f4a4">DS_WAITINGSTOP</a></div><div class="ttdoc">demo is stopped but we must move clients over their normal slots </div><div class="ttdef"><b>Definition:</b> <a href="q__shared_8h_source.html#l01656">q_shared.h:1656</a></div></div>
<div class="ttc" id="msg_8c_html_aea0b2ab8f35e176632549e6b4f1bfc5b"><div class="ttname"><a href="msg_8c.html#aea0b2ab8f35e176632549e6b4f1bfc5b">MSG_WriteByte</a></div><div class="ttdeci">void MSG_WriteByte(msg_t *msg, int c)</div><div class="ttdoc">MSG_WriteByte. </div><div class="ttdef"><b>Definition:</b> <a href="msg_8c_source.html#l00432">msg.c:432</a></div></div>
<div class="ttc" id="group__lua__etvars_html_ga3c4270e8cb68ad1ff315b9ec7dbd2ef1"><div class="ttname"><a href="group__lua__etvars.html#ga3c4270e8cb68ad1ff315b9ec7dbd2ef1">CS_PLAYERS</a></div><div class="ttdeci">#define CS_PLAYERS</div><div class="ttdoc">689 (16) </div><div class="ttdef"><b>Definition:</b> <a href="bg__public_8h_source.html#l00413">bg_public.h:413</a></div></div>
<div class="ttc" id="common_8c_html_a5b18ecdac4d5688915148b2570c518fe"><div class="ttname"><a href="common_8c.html#a5b18ecdac4d5688915148b2570c518fe">Field_CompleteFilename</a></div><div class="ttdeci">void Field_CompleteFilename(const char *dir, const char *ext, qboolean stripExt, qboolean allowNonPureFilesOnDisk)</div><div class="ttdoc">Field_CompleteFilename. </div><div class="ttdef"><b>Definition:</b> <a href="common_8c_source.html#l03774">common.c:3774</a></div></div>
<div class="ttc" id="q__shared_8c_html_aad4e641649a5bcf8bb21fbe7a815ee98"><div class="ttname"><a href="q__shared_8c.html#aad4e641649a5bcf8bb21fbe7a815ee98">Com_sprintf</a></div><div class="ttdeci">int QDECL Com_sprintf(char *dest, unsigned int size, const char *fmt,...)</div><div class="ttdoc">Com_sprintf. </div><div class="ttdef"><b>Definition:</b> <a href="q__shared_8c_source.html#l01932">q_shared.c:1932</a></div></div>
<div class="ttc" id="sv__demo_8c_html_ab15813f230fc9470cd6236c2f4c0cba2"><div class="ttname"><a href="sv__demo_8c.html#ab15813f230fc9470cd6236c2f4c0cba2">SV_DemoWriteClientUserinfo</a></div><div class="ttdeci">void SV_DemoWriteClientUserinfo(client_t *client, const char *userinfo)</div><div class="ttdoc">Write a client userinfo to the demo file (client_t fields can almost all be filled from the userinfo ...</div><div class="ttdef"><b>Definition:</b> <a href="sv__demo_8c_source.html#l00592">sv_demo.c:592</a></div></div>
<div class="ttc" id="sv__demo_8c_html_ae69d0c0b6524cde1bb78650a3627b9ad"><div class="ttname"><a href="sv__demo_8c.html#ae69d0c0b6524cde1bb78650a3627b9ad">keepSaved</a></div><div class="ttdeci">static qboolean keepSaved</div><div class="ttdef"><b>Definition:</b> <a href="sv__demo_8c_source.html#l00092">sv_demo.c:92</a></div></div>
<div class="ttc" id="sv__demo_8c_html_a3187d882bdaed21c1191839264f13711"><div class="ttname"><a href="sv__demo_8c.html#a3187d882bdaed21c1191839264f13711">SV_DemoReadClientUserinfo</a></div><div class="ttdeci">static void SV_DemoReadClientUserinfo(msg_t *msg)</div><div class="ttdoc">Read a demo client userinfo string from a message, load it into memory, fills client_t fields by pars...</div><div class="ttdef"><b>Definition:</b> <a href="sv__demo_8c_source.html#l01550">sv_demo.c:1550</a></div></div>
<div class="ttc" id="msg_8c_html_a4bba3ea21116c996f3e630414895b183"><div class="ttname"><a href="msg_8c.html#a4bba3ea21116c996f3e630414895b183">MSG_Init</a></div><div class="ttdeci">void MSG_Init(msg_t *buf, byte *data, int length)</div><div class="ttdoc">MSG_Init. </div><div class="ttdef"><b>Definition:</b> <a href="msg_8c_source.html#l00069">msg.c:69</a></div></div>
<div class="ttc" id="q__shared_8h_html_a0c397a708cec89c74029582574516b30"><div class="ttname"><a href="q__shared_8h.html#a0c397a708cec89c74029582574516b30">MAX_NAME_LENGTH</a></div><div class="ttdeci">#define MAX_NAME_LENGTH</div><div class="ttdoc">max length of a client name </div><div class="ttdef"><b>Definition:</b> <a href="q__shared_8h_source.html#l00460">q_shared.h:460</a></div></div>
<div class="ttc" id="sv__demo_8c_html_a8615b363043f307f54f6462a3fa072cb"><div class="ttname"><a href="sv__demo_8c.html#a8615b363043f307f54f6462a3fa072cb">SV_DemoWriteConfigString</a></div><div class="ttdeci">void SV_DemoWriteConfigString(int cs_index, const char *cs_string)</div><div class="ttdoc">Write a configstring to the demo file. </div><div class="ttdef"><b>Definition:</b> <a href="sv__demo_8c_source.html#l00544">sv_demo.c:544</a></div></div>
<div class="ttc" id="cmd_8c_html_accbf67887d2d8e59ced2e4cca30dc7d0"><div class="ttname"><a href="cmd_8c.html#accbf67887d2d8e59ced2e4cca30dc7d0">Cbuf_ExecuteText</a></div><div class="ttdeci">void Cbuf_ExecuteText(int exec_when, const char *text)</div><div class="ttdoc">Cbuf_ExecuteText. </div><div class="ttdef"><b>Definition:</b> <a href="cmd_8c_source.html#l00155">cmd.c:155</a></div></div>
<div class="ttc" id="dl__local_8h_html_a2f2251d7d64d4c9ec69520b953f68bb9"><div class="ttname"><a href="dl__local_8h.html#a2f2251d7d64d4c9ec69520b953f68bb9">va</a></div><div class="ttdeci">char * va(char *format,...) _attribute((format(printf</div></div>
<div class="ttc" id="sv__demo_8c_html_aa2f17f6a5cd4b5c16c474cf33de888ff"><div class="ttname"><a href="sv__demo_8c.html#aa2f17f6a5cd4b5c16c474cf33de888ff">SV_DemoWriteClientCommand</a></div><div class="ttdeci">static void SV_DemoWriteClientCommand(client_t *client, const char *cmd)</div><div class="ttdoc">Write a client command to the demo file. </div><div class="ttdef"><b>Definition:</b> <a href="sv__demo_8c_source.html#l00439">sv_demo.c:439</a></div></div>
<div class="ttc" id="q__shared_8h_html_af0a604c3447aef4c7fbe9a7a3dcafd6bab6b643787d3f344cdb6c2e9e7699ada6"><div class="ttname"><a href="q__shared_8h.html#af0a604c3447aef4c7fbe9a7a3dcafd6bab6b643787d3f344cdb6c2e9e7699ada6">EXEC_NOW</a></div><div class="ttdef"><b>Definition:</b> <a href="q__shared_8h_source.html#l00486">q_shared.h:486</a></div></div>
<div class="ttc" id="structqtime__s_html_aef644b9b87a78a1e9ce0837e96ac7b21"><div class="ttname"><a href="structqtime__s.html#aef644b9b87a78a1e9ce0837e96ac7b21">qtime_s::tm_year</a></div><div class="ttdeci">int tm_year</div><div class="ttdoc">years since 1900 </div><div class="ttdef"><b>Definition:</b> <a href="q__shared_8h_source.html#l01616">q_shared.h:1616</a></div></div>
<div class="ttc" id="msg_8c_html_a13c7a8df0da3cbc3be9ca3372b11aed5"><div class="ttname"><a href="msg_8c.html#a13c7a8df0da3cbc3be9ca3372b11aed5">MSG_WriteDeltaSharedEntity</a></div><div class="ttdeci">void MSG_WriteDeltaSharedEntity(msg_t *msg, void *from, void *to, qboolean force, int number)</div><div class="ttdoc">MSG_WriteDeltaSharedEntity. </div><div class="ttdef"><b>Definition:</b> <a href="msg_8c_source.html#l01652">msg.c:1652</a></div></div>
<div class="ttc" id="server_8h_html_a52b0f145e2eab712924fdbda3b486b1f"><div class="ttname"><a href="server_8h.html#a52b0f145e2eab712924fdbda3b486b1f">SV_ExecuteClientCommand</a></div><div class="ttdeci">void SV_ExecuteClientCommand(client_t *cl, const char *s, qboolean clientOK, qboolean premaprestart)</div><div class="ttdoc">Also called by bot code. </div><div class="ttdef"><b>Definition:</b> <a href="sv__client_8c_source.html#l01789">sv_client.c:1789</a></div></div>
<div class="ttc" id="sv__demo_8c_html_a5cdd1376828a792eeab1ac9e0f3fb945"><div class="ttname"><a href="sv__demo_8c.html#a5cdd1376828a792eeab1ac9e0f3fb945">SV_GenerateDateTime</a></div><div class="ttdeci">static char * SV_GenerateDateTime(void)</div><div class="ttdoc">Generate a full datetime (local and utc) from now. </div><div class="ttdef"><b>Definition:</b> <a href="sv__demo_8c_source.html#l00390">sv_demo.c:390</a></div></div>
<div class="ttc" id="q__shared_8h_html_aeaa898bef6b376f572e5e59d943d78b2a92cbb6b682e745d51527236bad2a6011"><div class="ttname"><a href="q__shared_8h.html#aeaa898bef6b376f572e5e59d943d78b2a92cbb6b682e745d51527236bad2a6011">DS_PLAYBACK</a></div><div class="ttdoc">a demo is playing </div><div class="ttdef"><b>Definition:</b> <a href="q__shared_8h_source.html#l01655">q_shared.h:1655</a></div></div>
<div class="ttc" id="files_8c_html_a4e635a7a368bbd1ef3dbd99140c69e39"><div class="ttname"><a href="files_8c.html#a4e635a7a368bbd1ef3dbd99140c69e39">FS_Read</a></div><div class="ttdeci">int FS_Read(void *buffer, int len, fileHandle_t f)</div><div class="ttdoc">FS_Read. </div><div class="ttdef"><b>Definition:</b> <a href="files_8c_source.html#l02013">files.c:2013</a></div></div>
<div class="ttc" id="cmd_8c_html_a1734574e90e7819673500355d4758877"><div class="ttname"><a href="cmd_8c.html#a1734574e90e7819673500355d4758877">Cmd_Argv</a></div><div class="ttdeci">char * Cmd_Argv(int arg)</div><div class="ttdoc">Cmd_Argv. </div><div class="ttdef"><b>Definition:</b> <a href="cmd_8c_source.html#l00424">cmd.c:424</a></div></div>
<div class="ttc" id="q__shared_8c_html_af4759dc8f041fd3cdccdaed72ac7f694"><div class="ttname"><a href="q__shared_8c.html#af4759dc8f041fd3cdccdaed72ac7f694">Info_RemoveKey</a></div><div class="ttdeci">void Info_RemoveKey(char *s, const char *key)</div><div class="ttdoc">Info_RemoveKey. </div><div class="ttdef"><b>Definition:</b> <a href="q__shared_8c_source.html#l02201">q_shared.c:2201</a></div></div>
<div class="ttc" id="server_8h_html_a89d33b2529a2789787b365237a7319d4a8d7d62e14bc073c3c05b3cd8de118134"><div class="ttname"><a href="server_8h.html#a89d33b2529a2789787b365237a7319d4a8d7d62e14bc073c3c05b3cd8de118134">CS_ACTIVE</a></div><div class="ttdoc">client is fully in game </div><div class="ttdef"><b>Definition:</b> <a href="server_8h_source.html#l00182">server.h:182</a></div></div>
<div class="ttc" id="structentityState__s_html_a5d4361c5a7fbb819946a271304d950cb"><div class="ttname"><a href="structentityState__s.html#a5d4361c5a7fbb819946a271304d950cb">entityState_s::number</a></div><div class="ttdeci">int number</div><div class="ttdoc">entity index </div><div class="ttdef"><b>Definition:</b> <a href="q__shared_8h_source.html#l01449">q_shared.h:1449</a></div></div>
<div class="ttc" id="q__shared_8c_html_a8952048a805d58e583bfc6530f53ee82"><div class="ttname"><a href="q__shared_8c.html#a8952048a805d58e583bfc6530f53ee82">Info_ValueForKey</a></div><div class="ttdeci">char * Info_ValueForKey(const char *s, const char *key)</div><div class="ttdoc">Searches the string for the given key and returns the associated value, or an empty string...</div><div class="ttdef"><b>Definition:</b> <a href="q__shared_8c_source.html#l02079">q_shared.c:2079</a></div></div>
<div class="ttc" id="sv__demo_8c_html_af2bc2d94afb470315c0786124a2fdc31ade02da1ed2771e05fc653410dabc7ee9"><div class="ttname"><a href="sv__demo_8c.html#af2bc2d94afb470315c0786124a2fdc31ade02da1ed2771e05fc653410dabc7ee9">demo_clientConfigString</a></div><div class="ttdef"><b>Definition:</b> <a href="sv__demo_8c_source.html#l00056">sv_demo.c:56</a></div></div>
<div class="ttc" id="sv__demo_8c_html_ab22110bbf964d536640bb88547523025"><div class="ttname"><a href="sv__demo_8c.html#ab22110bbf964d536640bb88547523025">SV_CheckServerCommand</a></div><div class="ttdeci">static qboolean SV_CheckServerCommand(const char *cmd)</div><div class="ttdoc">Check that the serverCommand is OK to save (or if we drop it because already handled somewhere else o...</div><div class="ttdef"><b>Definition:</b> <a href="sv__demo_8c_source.html#l00236">sv_demo.c:236</a></div></div>
<div class="ttc" id="sv__demo_8c_html_ab12739ae66c61231b78135e511331563"><div class="ttname"><a href="sv__demo_8c.html#ab12739ae66c61231b78135e511331563">SV_Demo_Play_f</a></div><div class="ttdeci">static void SV_Demo_Play_f(void)</div><div class="ttdoc">SV_Demo_Play_f. </div><div class="ttdef"><b>Definition:</b> <a href="sv__demo_8c_source.html#l02019">sv_demo.c:2019</a></div></div>
<div class="ttc" id="sv__demo_8c_html_a175c60213a858535c9f881e5e4186b66"><div class="ttname"><a href="sv__demo_8c.html#a175c60213a858535c9f881e5e4186b66">SV_DemoReadClientConfigString</a></div><div class="ttdeci">static void SV_DemoReadClientConfigString(msg_t *msg)</div><div class="ttdoc">Read a demo client configstring from a message, load it into memory and broadcast changes to gamecode...</div><div class="ttdef"><b>Definition:</b> <a href="sv__demo_8c_source.html#l01452">sv_demo.c:1452</a></div></div>
<div class="ttc" id="cvar_8c_html_a37ba1e5addace2b2298bfbb2f5d52938"><div class="ttname"><a href="cvar_8c.html#a37ba1e5addace2b2298bfbb2f5d52938">Cvar_VariableIntegerValue</a></div><div class="ttdeci">int Cvar_VariableIntegerValue(const char *var_name)</div><div class="ttdoc">Cvar_VariableIntegerValue. </div><div class="ttdef"><b>Definition:</b> <a href="cvar_8c_source.html#l00122">cvar.c:122</a></div></div>
<div class="ttc" id="msg_8c_html_a8d1735f59100643283a0c721bb3a021a"><div class="ttname"><a href="msg_8c.html#a8d1735f59100643283a0c721bb3a021a">MSG_WriteDeltaPlayerstate</a></div><div class="ttdeci">void MSG_WriteDeltaPlayerstate(msg_t *msg, struct playerState_s *from, struct playerState_s *to)</div><div class="ttdoc">MSG_WriteDeltaPlayerstate. </div><div class="ttdef"><b>Definition:</b> <a href="msg_8c_source.html#l01992">msg.c:1992</a></div></div>
<div class="ttc" id="structcvar__s_html_a5f1df4d8bd348465e156d90ff061cf48"><div class="ttname"><a href="structcvar__s.html#a5f1df4d8bd348465e156d90ff061cf48">cvar_s::modified</a></div><div class="ttdeci">qboolean modified</div><div class="ttdoc">set each time the cvar is changed </div><div class="ttdef"><b>Definition:</b> <a href="q__shared_8h_source.html#l00837">q_shared.h:837</a></div></div>
<div class="ttc" id="server_8h_html_aec9788a4410ed7f82b60651c4e23e383"><div class="ttname"><a href="server_8h.html#aec9788a4410ed7f82b60651c4e23e383">SV_SetConfigstring</a></div><div class="ttdeci">void SV_SetConfigstring(int index, const char *val)</div><div class="ttdoc">SV_SetConfigstring. </div><div class="ttdef"><b>Definition:</b> <a href="sv__init_8c_source.html#l00074">sv_init.c:74</a></div></div>
<div class="ttc" id="q__shared_8h_html_aeaa898bef6b376f572e5e59d943d78b2a56f619bf31320371483bd356ba300028"><div class="ttname"><a href="q__shared_8h.html#aeaa898bef6b376f572e5e59d943d78b2a56f619bf31320371483bd356ba300028">DS_RECORDING</a></div><div class="ttdoc">a demo is being recorded </div><div class="ttdef"><b>Definition:</b> <a href="q__shared_8h_source.html#l01658">q_shared.h:1658</a></div></div>
<div class="ttc" id="cmd_8c_html_a25002ad2a0030da75a2030d646bcbc75"><div class="ttname"><a href="cmd_8c.html#a25002ad2a0030da75a2030d646bcbc75">Cmd_TokenizeString</a></div><div class="ttdeci">void Cmd_TokenizeString(const char *text)</div><div class="ttdoc">Cmd_TokenizeString. </div><div class="ttdef"><b>Definition:</b> <a href="cmd_8c_source.html#l00717">cmd.c:717</a></div></div>
<div class="ttc" id="sv__demo_8c_html_a29cb789f1bf3fd818cbd9f621016c9cb"><div class="ttname"><a href="sv__demo_8c.html#a29cb789f1bf3fd818cbd9f621016c9cb">SV_CheckGameCommand</a></div><div class="ttdeci">static qboolean SV_CheckGameCommand(const char *cmd)</div><div class="ttdoc">Check that the gameCommand is OK and that we can save it (or if we drop it for privacy concerns and/o...</div><div class="ttdef"><b>Definition:</b> <a href="sv__demo_8c_source.html#l00289">sv_demo.c:289</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Oct 16 2019 14:19:55 for ET: Legacy by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
